{"version":3,"sources":["consts/routes.ts","components/Header/Header.tsx","components/Header/index.ts","consts/strings.ts","components/Toast/index.ts","components/Toast/Toast.tsx","components/Error/index.ts","components/Error/Error.tsx","components/Landing/LandingPage/index.ts","components/Landing/LandingPage/LandingPage.tsx","components/RulesPage/index.ts","components/RulesPage/RulesPage.tsx","consts/emptyTeam.ts","components/TeamForm/TeamForm.tsx","components/TeamForm/index.ts","components/RegistrationPage/index.ts","components/RegistrationPage/RegistrationPage.tsx","consts/actions.ts","utils/sendRequest.ts","consts/api.ts","actions/app.ts","utils/createFormData.ts","utils/createQueryString.ts","actions/team.ts","utils/createEmptyAction.ts","containers/Registration.ts","components/LoginPage/index.ts","components/LoginPage/LoginPage.tsx","containers/Login.ts","components/ShowAndCopyForm/index.ts","components/ShowAndCopyForm/ShowAndCopyForm.tsx","components/TeamInfoPage/index.ts","models/Submission.ts","components/TeamInfoPage/TeamInfoPage.tsx","containers/TeamInfo.ts","components/DateTime/DateTime.tsx","components/DateTime/index.ts","components/PlayIcon/index.ts","components/PlayIcon/PlayIcon.tsx","components/SubmissionsPage/index.ts","components/SubmissionsPage/SubmissionsPage.tsx","actions/tournament.ts","actions/submissions.ts","containers/Submissions.ts","components/Tabs/index.ts","components/Tabs/Tabs.tsx","components/ScoreboardPage/LightningScoreboard.tsx","components/ScoreboardPage/TotalScoreboard.tsx","components/ScoreboardPage/ScoreboardPage.tsx","components/ScoreboardPage/FinalScoreboard.tsx","components/ScoreboardPage/index.ts","actions/scoreboard.ts","containers/Scoreboard.ts","components/BlogPost/index.ts","components/BlogPost/BlogPost.tsx","components/BlogPage/BlogList.tsx","components/BlogPage/BlogPage.tsx","components/BlogPage/index.ts","components/BlogPostPage/index.ts","models/GameDto.ts","components/BlogPostPage/BlogPostPage.tsx","components/TestingPage/index.ts","components/TestingPage/TestingPage.tsx","containers/Testing.ts","components/GamesPage/GamesPage.tsx","components/GamesPage/index.ts","actions/games.ts","containers/Games.ts","components/App/AppRouter.tsx","utils/eventsListener.ts","components/VisualizerPage/GameLogModels.ts","components/VisualizerPage/GameLogConverter.ts","components/VisualizerPage/ShipsUtils.ts","components/VisualizerPage/Renderer2d.ts","components/VisualizerPage/Renderer3d.ts","components/VisualizerPage/Renderer2dAnd3d.ts","components/VisualizerPage/Visualizer.ts","utils/getQueryParams.ts","components/VisualizerPage/index.ts","components/VisualizerPage/VisualizerPage.tsx","components/App/App.tsx","components/App/index.ts","containers/App.ts","reducers/app.ts","reducers/team.ts","reducers/submissions.ts","reducers/scoreboard.ts","reducers/tournament.ts","reducers/games.ts","reducers/index.ts","index.tsx","components/SubmissionsPage/styles.module.css","components/TestingPage/styles.module.css","components/Header/styles.module.css","components/forms.module.css","components/Tabs/styles.module.css","components/ScoreboardPage/styles.module.css","components/BlogPost/styles.module.css","components/TeamForm/styles.module.css","components/BlogPostPage/styles.module.css","components/Landing/LandingPage/styles.module.css","components/Toast/styles.module.css","components/LoginPage/styles.module.css","components/GamesPage/styles.module.css","components/App/styles.module.css","components/RegistrationPage/styles.module.css","components/BlogPage/styles.module.css","components/TeamInfoPage/styles.module.css","components/ShowAndCopyForm/styles.module.css","components/DateTime/style.module.css"],"names":["ROUTES","blogTabs","gameTabs","scoreboardTabs","unauthLinks","url","content","authLinks","renderLinks","links","map","link","to","className","styles","key","activeClassName","activeLink","Header","props","isLoggedIn","Boolean","team","root","titleLink","subtitle","isTeamLoading","navMenuLinks","renderAuthorizedLinks","GENERAL","Toast","interval","onClose","this","undefined","setTimeout","clearTimeout","message","isError","box","error","React","Component","Error","closeError","errorText","LandingPage","video","target","rel","title","width","height","src","frameBorder","allow","allowFullScreen","section","href","features","features__emoji","role","aria-label","features__title","features__pro","videos","thanks","thanks__title","thanks__script","supporters","supporters__title","supporters__script","RulesPage","emptyTeam","teamName","gitRepositoryUrl","customData_country","customData_peopleAmount","customData_email","countries","countriesJson","TeamForm","onChange","field","e","val","value","setState","teamInfo","state","registerTeam","a","preventDefault","validate","onSubmit","startValue","validations","buttonText","isEditForm","loading","globalForm","form","renderRow","autoFocus","maxLength","type","placeholder","renderCountrySelect","buttonRow","disabled","label","fieldName","required","row","style","name","country","text","test","Object","keys","length","RegistrationPage","disclaimer","register","START","FINISH","json","sendGetRequest","sendRequest","sendPostRequest","body","method","headers","JSON","stringify","sendPostFormRequest","sendPatchFormRequest","params","fetch","then","resp","contentType","get","split","ok","errorJson","Promise","reject","errMessage","status","statusText","serverUrl","teams","registration","currentTeam","submissions","otherTeamsSubmission","events","scoreboard","problemsScoreboard","finalScoreboard","tournaments","currentTournament","games","nonRatingGames","nonRatingGamesRun","logs","createSetErrorAction","payload","createFormData","obj","entries","i","encodeURIComponent","join","createQueryString","createUpdateApiKeyAction","apiKey","createUpdateTeamAction","createLoadTeamStartAction","createLoadTeamFinishAction","data","connect","store","teamLoading","dispatch","action","createEmptyAction","window","localStorage","setItem","LoginPage","login","requestUrl","ShowAndCopyForm","showToast","closeToast","rows","onClick","TeamInfoPage","SubmissionStatus","teamForForm","customData","peopleAmount","email","deployKey","editTeam","getState","formatter","Intl","DateTimeFormat","hour","minute","month","day","hour12","DateTime","dateStr","date","Date","resolvedOptions","timeZone","format","PlayIcon","xmlns","x","y","viewBox","enableBackground","xmlSpace","fillRule","clipRule","fill","color","d","SubmissionsPage","showChangeSubmission","getSubmissions","loadSubmissions","stopEvent","stopPropagation","activateSubmission","s","active","Succeeded","submissionId","prevProps","checkLastSeenSubmission","checkActiveSubmissionChange","help","branch","renderSubmissions","renderHelpMessage","table","colSpan","textAlign","Failed_Build","Failed_Test","Failed_Unknown","isFailed","toLowerCase","indexOf","commitHash","createdAt","succeeded","substring","pre","branchName","commitMessage","statusFailed","buildLogKey","logLink","attackerTestLogKey","defenderTestLogKey","icon","loadedSubmissions","changedSubmissions","id","updateLastSeenSubmission","currentActive","find","prevActive","createLoadCurrentTournamentAction","tournament","createRunNonRatingGameFinishAction","teamSubmissions","Tabs","hash","location","list","tabs","tab","listItem","LightningScoreboard","sortBy","sortDirection","SortDirection","decrease","cellForProblem","problem","problemId","description","startsWith","replace","buttonClass","sortButton","sortDown","sortUp","alignRight","changeSorted","scoreboardTeam","index","teamId","activeTeam","alignCenter","ScoreboardPage","renderTeamName","problems","p","renderScoreCell","score","solvedAt","increase","teamsOrder","sort","b","aScore","bScore","aProblem","bProblem","sortElements","isFrozen","frozenAt","frozenTitle","renderHead","hasProblems","rowSpan","alignLeft","filter","tuple","createDate","lighten","TotalScoreboard","renderTournamentHeadCell","t","openTournament","tournamentId","isOpen","button","openClass","smallRow","startedAt","renderOpenTournamentHeadCell","details","buttonOpenClass","sortDetails","currentTournamentId","submission","platform","isPastOrCurrentTournament","renderTournamentCell","hasItem","rating","conservativeRating","toFixed","mu","sigma","getCurrentTournament","sortedArray","renderTopText","finishedAt","pastAndCurrentTournaments","openTournamentFull","acceptSubmissions","runGames","FinalScoreboard","loadProblemScoreboard","loadTotalScoreboard","loadFinalScoreboard","totalScoreboard","lightningScoreboard","itemCountry","c","shortValue","loadLightningScoreboard","result","BlogPost","author","isInList","intl","timeZoneName","year","header","titleText","renderTitle","linkTarget","escapeHtml","source","BlogList","posts","item","BlogPage","astronomerPosts","orgsPosts","BlogPostPage","GameWinner","postId","match","astronomerPostIndex","findIndex","elem","parseInt","orgsPostIndex","postIndex","currentPost","nextPost","prevPost","footer","footerItem","TestingPage","attacker","defender","renderSubmissionRow","substr","buttons","renderRunButton","chooseDefender","evt","newValue","chooseAttacker","clearSelection","runSelection","runNonRatingGame","loadOtherTeamSubmissions","justStarted","renderUserSubmissions","renderOtherTeamsSubmissions","renderToastContent","renderSuccessToastContent","otherTeams","renderOtherTeamSubmissionRow","chosen","isChecked","toString","iconColor","chooseButton","checked","radio","createToastText","toastButton","createSubmissionText","inMyBots","inOtherBots","otherTeamSubmissions","current","attackerSubmissionId","defenderSubmissionId","RUN_NON_RATING_GAME","roles","GamesPage","nonRating","gameStatus","calcGameResult","gameId","whiteSpace","inProgress","renderLogLinks","ticks","renderStats","ratingGames","loadRatingGames","loadNonRatingGames","renderRatingGames","renderNonRatingGames","renderTableHeader","game","debugLog","logKey","timeout","winner","Nobody","draw","win","lose","AppRouter","exact","path","component","children","forUnauthorized","Registration","Login","forAuthorized","TeamInfo","Submissions","Testing","Games","Scoreboard","EventType","SubmissionChangeType","NonRatingGameChangeType","TeamChangeType","ApiGameType","ApiGameStatus","ApiPlayerStatus","ApiCommandType","ApiPlayerRole","convertPlayer","convertLogItem","planet","convertPlanet","convertTick","radius","safeRadius","tick","ships","createShipAndCommands","ship","convertShip","appliedCommands","SplitShip","matter","fuel","lasers","radiators","engines","BurnFuel","velocity","Detonate","power","powerDecreaseStep","Shoot","damage","damageDecreaseFactor","convertCommands","shipId","position","temperature","criticalTemperature","maxFuelBurnSpeed","ShipComponentType","Renderer2d","ctx","canvas","cellSize","clearRect","showTrajectories","globalAlpha","points","simulate","Path2D","moveTo","toScreenX","toScreenY","sx","sy","lineTo","strokeStyle","shipColor","stroke","laserCommand","getShootRadius","laser","fillStyle","createRect","detonateCommand","r","revShipsAndCommands","shipsAndCommands","nextShipsAndCommands","isAutoPlay","drawCommands","shipAndCommands","drawShip","cmd","drawDetonation","drawLaser","f","pos","gameX","gameY","res","size","left","top","minSize","rect","screenX","screenY","some","fitInScreen","Defender","timePerTick","GetShipComponents","components","AddComponentsWithType","Engine","Radiator","Laser","Fuel","GetPosition","GetDefenderCubesCountOnLayer","GetCoordsOnSideDefender","cubes","usedPoints","Set","indexForFigureWithDuplicates","GetPositionAttackerForFigureWithDuplicateFacesEdges","z","has","add","SetPositionsAttacker","count","push","Vector3","GetAttackerCubesCountOnLayerWithDuplicateFacesEdges","GetCoordsOnSideAttacker","layer","getCubesCountOnLayer","getCoordsOnSide","isCenterCubeOnEvenLayer","cubeIndex","cubesCountOnPreviousLayers","cubesCountOnLayer","indexOnLayer","GetLayerAndIndexOnLayer","coordsOnFace","face","indexOnFace","Math","ceil","isCenterCubeOnLayer","Vector2","side","coordsOnSide","applyAxisAngle","MathUtils","degToRad","round","CoordOnFaceTo3d","AttackerSideColumnsAndRows_CenterOnLayer","AttackerSideColumnsAndRows_CenterNotOnLayer","indexOnSide","column","indexOnColumn","Renderer3d","scene","renderer","camera","bloomComposer","cameraRotationLon","cameraRotationLat","onPointerDownPointerX","onPointerDownPointerY","onStartRotateLon","onStartRotateLat","cameraRotationLonDelta","cameraRotationLatDelta","dampingFactor","rotationSpeed","zoom","zoomDelta","maxZoom","minZoom","zoomDampingFactor","shipIdInView","isGeneralView","lookAt","cameraPosition","prevShipsAndCommands","notDrawShips","shipInViewFlyClockwise","shipsOnScene","detonationsOnScene","laserLinesOnScene","laserShootRadiiOnScene","exhaustsOnScene","shipCubeSize","planetGlow","startTime","lastTickTime","skyTex","planetOpacityTex","shipComponentsMaterials","shipSpriteMaterial","explosionMeshes","mixers","fxaaPass","bind","Scene","WebGLRenderer","antialias","setSize","scrollWidth","scrollHeight","textureLoader","TextureLoader","load","PerspectiveCamera","drawStarsSphere","createLight","initShipComponentsMaterials","SpriteMaterial","sizeAttenuation","opacity","renderScene","RenderPass","bloomPass","UnrealBloomPass","ShaderPass","FXAAShader","EffectComposer","renderToScreen","addPass","addEventListener","onDocumentMouseDown","animate","delta","bump","engine","engineComponentMaterial","MeshPhongMaterial","shininess","bumpMap","specular","bumpScale","radiatorComponentMaterial","clone","laserComponentMaterial","fuelComponentMaterial","material","purpleLight","DirectionalLight","set","whiteLight","AmbientLight","onDocumentMouseMove","onDocumentMouseUp","onDocumentMouseLeave","render","requestAnimationFrame","event","clientX","clientY","removeEventListener","stopAllAction","drawShips","shipsOnSceneNew","shipData","newShipAndComponents","remove","hasOwnProperty","processExplosion","mesh","newComponentsCount","shipCommandList","shipCommands","nextPosition","spentCubes","command","abs","componentsCountForExplosion","explosedComponents","drawShipExplosion","fromGameCoords","geometry","BoxBufferGeometry","transparent","Mesh","scale","multiplyScalar","copy","positionDelta","log","componentPosition","randomPosVec","random","startPos","finalPos","positionKF","VectorKeyframeTrack","scaleKF","opacityKF","NumberKeyframeTrack","colorKF","ColorKeyframeTrack","InterpolateLinear","clip","AnimationClip","mixer","AnimationMixer","clipAction","play","sprite","componentsCount","GetShipComponentsCount","createShip","byTypes","dummy","Object3D","updateMatrix","applyMatrix4","matrix","geometries","mergedGeometry","BufferGeometryUtils","mergeBufferGeometries","Sprite","removeOldObjectsFromScene","sap","drawExhaust","detonation","outerSphere","laserLine","shootRadius","shoot","exhaust","laserMaterial","MeshBasicMaterial","Color","from","CylinderGeometry","distanceTo","glowMaterial","ShaderMaterial","uniforms","glowColor","viewVector","vertexShader","vertexShaderGlow","fragmentShader","fragmentShaderGlow","FrontSide","blending","AdditiveBlending","glowGeom","glowMesh","glow","shootRadiusMaterial","shootRadiusGeometry","SphereGeometry","innerSphere","BackSide","mixerInner","clipActionInner","burnFuelCommand","shipOnScene","sizeCoefficient","heightCoefficient","ConeGeometry","translate","rotateZ","sign","angleTo","normalize","alphaTest","DoubleSide","alphaMap","BoxGeometry","innerPlanetMaterial","innerPlanet","glowCubeGeom","timeFromTick","fraction","min","nextShipDataList","nextShipData","gamePos","gameLookAt","laserData","setY","parameters","rotateOnAxis","previous","shipsKeys","updateShipInViewFlyClockwise","nextShipId","reverse","k","shipDataList","setNextShipInView","shipInView","normal","cross","setCameraNotRotated","max","zoomFactor","cameraToLookAt","sub","cameraDistance","notRotatedLat","radToDeg","asin","notRotatedLon","atan2","cameraLat","cameraLon","latRad","lonRad","cos","sin","up","updateProjectionMatrix","rendererSize","getSize","isFullScreen","document","fullscreenElement","screen","aspect","updateGlow","worldPosition","getWorldPosition","subVectors","coef","setTime","updateShipsIntermediatePositions","updateLaserPositions","updateGlows","updateExplosions","updateExhausts","updateCamera","fixShootRadiiSphereOpacity","updateRenderer","sphere","coords","Renderer2dAnd3d","renderer2d","renderer3d","setTimePerTick","adjustScale","clearSpace","drawShipsAndCommands","drawPlanet","drawSafePlace","drawTrajectories","run","logData","canvasDelta","done","canvas2dElement","getElementById","canvas3dElement","consoleElement","is2d","canvas2d","maybeCtx2d","getContext","canvas3d","maybeCtx3d","hidden","isSucceeded","gameType","players","gameLog","factualTicksLength","lastTick","sac","addLastTicks","autoPlayTimerId","lastMouseDownTime","resizeListener","resize","update","keydown","onMouseDown","onMouseUp","ev","deltaY","setZoomDelta","startAutoplay","innerWidth","innerHeight","code","rewind","stopAutoplay","instruction","getElementsByClassName","classList","switchGeneralView","setPreviousShipInView","requestFullscreen","webkitRequestFullscreen","mozRequestFullscreen","setInterval","autoplayTick","click","now","dir","ticksCount","hasNextTick","prevTick","nextTick","consoleShips","innerHTML","drawEvent","hasPlanet","reversed","dx","dy","maxD","newV","powerDecrease","floor","getQueryParams","reduce","acc","VisualizerPage","runAutoGames","gameIds","promise","resolve","getLog","playerKey","response","gameRequestUrl","gameResponse","parse","runGame","queries","gray","autoGames","attackerName","defenderName","Attacker","getApiKey","urlParams","getItem","App","listener","deleteApiKey","removeItem","hasApiKey","updateApiKey","updateTeam","setError","loadTeam","close","addTeam","addListeners","container","logout","narrowContainer","handler","subscribedEventTypes","closed","connected","sticky","uuid","connection","HubConnectionBuilder","withUrl","withAutomaticReconnect","configureLogging","LogLevel","Information","build","start","console","updateSubscription","stop","eventTypes","send","onclose","on","eventType","subscribe","unsubscribe","listenEvents","Submission","Team","loadScoreboard","NonRatingGame","app","err","defaultStore","appReducer","defaultState","teamReducer","lastSeen","running","submissionsReducer","scoreboardReducer","tournamentReducer","gamesReducer","rootReducer","combineReducers","createStore","applyMiddleware","reduxThunk","ReactDOM","module","exports"],"mappings":"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","file":"static/js/main.5140d962.chunk.js","sourcesContent":["export const ROUTES = {\r\n    rules: '/rules',\r\n    registration: '/registration',\r\n    login: '/login',\r\n    teamInfo: '/team',\r\n    submissions: '/submissions',\r\n    scoreboard: '/scoreboard',\r\n    testing: '/testing',\r\n    games: '/games',\r\n    visualize: '/visualize',\r\n    blog: '/blog',\r\n    post: '/post',\r\n};\r\n\r\nexport const blogTabs = {\r\n    orgs: '#orgs',\r\n    pegovka: '#pegoovka',\r\n}\r\n\r\nexport const gameTabs = {\r\n    rating: '#rating',\r\n    nonRating: '#nonRating',\r\n}\r\n\r\nexport const scoreboardTabs = {\r\n    lightning: '#lightning',\r\n    full: '#full',\r\n    final: '#final',\r\n}\r\n","import React from 'react';\r\nimport { Link, NavLink } from 'react-router-dom';\r\nimport styles from './styles.module.css';\r\nimport { blogTabs, gameTabs, ROUTES, scoreboardTabs } from '../../consts/routes';\r\nimport Team from '../../models/Team';\r\n\r\ntype HeaderProps = {\r\n    team: Team | null;\r\n    isTeamLoading: boolean;\r\n    logout: () => void;\r\n}\r\n\r\nconst unauthLinks = [\r\n    { url: ROUTES.registration, content: 'Sign up' },\r\n    { url: ROUTES.login, content: 'Log in', },\r\n    { url: ROUTES.blog, content: 'Blog' },\r\n    { url: ROUTES.scoreboard + scoreboardTabs.final, content: 'Scoreboard' }\r\n]\r\n\r\nconst authLinks = [\r\n    { url: ROUTES.teamInfo, content: 'Profile' },\r\n    { url: ROUTES.submissions, content: 'Submissions' },\r\n    { url: ROUTES.testing, content: 'Testing' },\r\n    { url: ROUTES.games + gameTabs.rating, content: 'Games' },\r\n    { url: ROUTES.blog + blogTabs.orgs, content: 'Blog' },\r\n    { url: ROUTES.scoreboard + scoreboardTabs.final, content: 'Scoreboard' },\r\n]\r\n\r\nexport default function Header(props: HeaderProps) {\r\n    const isLoggedIn = Boolean(props.team);\r\n    return (\r\n        <header className={ styles.root }>\r\n            <h1>\r\n                <Link to='/' className={ styles.titleLink }>ICFP Programming Contest 2020</Link>\r\n                <div className={ styles.subtitle }>\r\n                    started on July 17, 2020 · ended on July 20, 2020\r\n                </div>\r\n            </h1>\r\n            { !props.isTeamLoading &&\r\n            <>\r\n                { isLoggedIn ? renderAuthorizedLinks(props) : renderUnauthorizedLinks() }\r\n            </>\r\n            }\r\n        </header>\r\n    )\r\n}\r\n\r\n\r\nfunction renderLinks(links: typeof unauthLinks) {\r\n    return <>\r\n        { links.map(link =>\r\n            <NavLink to={ link.url } className={ styles.link } key={ link.url } activeClassName={ styles.activeLink }>\r\n                { link.content }\r\n            </NavLink>\r\n        ) }\r\n    </>\r\n}\r\n\r\nfunction renderUnauthorizedLinks() {\r\n    return (\r\n        <div className={ styles.links }>\r\n            { renderLinks(unauthLinks) }\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction renderAuthorizedLinks(props: HeaderProps) {\r\n    const { team } = props;\r\n    if (!team) return;\r\n    return (\r\n        <div className={styles.navMenuLinks}>\r\n            { renderLinks(authLinks) }\r\n        </div>\r\n    )\r\n}\r\n","import Header from './Header';\r\nexport default Header;\r\n","export const API_KEY = 'apiKey';\r\nexport const GENERAL = 'general';\r\n","import Toast from './Toast';\r\nexport default Toast;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\n\r\nconst interval = 5000\r\n\r\ntype ToastProps = {\r\n    message: string | JSX.Element;\r\n    isError?: boolean;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport default class Toast extends React.Component<ToastProps> {\r\n    interval?: NodeJS.Timeout\r\n\r\n    componentDidMount() {\r\n        const { onClose } = this.props;\r\n\r\n        if (onClose !== undefined) {\r\n            this.interval = setTimeout(onClose, interval)\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.interval) {\r\n            clearTimeout(this.interval);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { message, isError } = this.props;\r\n\r\n        return (\r\n            <div className={ styles.root }>\r\n                <div className={ styles.box + (isError ? ' ' + styles.error : '') }>\r\n                    { message }\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n","import Error from './Error';\r\nexport default Error;\r\n","import React from 'react';\r\nimport Toast from \"../Toast\";\r\n\r\ntype ErrorProps = {\r\n    error: Error | string;\r\n    closeError: () => void;\r\n}\r\n\r\nexport default function Error(props: ErrorProps) {\r\n    const { closeError, error } = props;\r\n    const errorText = typeof error === 'string' ? error : error.message;\r\n    return (\r\n        <Toast message={ errorText } isError onClose={ closeError } />\r\n    )\r\n}\r\n","import LandingPage from './LandingPage';\r\nexport default LandingPage;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport { ROUTES } from \"../../../consts/routes\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nexport default function LandingPage() {\r\n    return (\r\n        <div className={ styles.root }>\r\n            <section className={ styles.video }>\r\n                <div className={ styles.subtitle }>\r\n                    Many thanks to all the participants!<br/>\r\n                    Watch the video and read the <Link to={ROUTES.post + '/2061'}\r\n                                                   target=\"_blank\" rel=\"noopener noreferrer\">wrapping up blog post</Link>\r\n                </div>\r\n                <iframe title=\"title-video\" width=\"666\" height=\"375\" src=\"https://www.youtube.com/embed/Me-0k5XGZWY\" frameBorder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen/>\r\n            </section>\r\n\r\n            <section className={ styles.section }>\r\n                <ul className={ styles.links }>\r\n                    <li>\r\n                        <p>Follow <a href=\"https://twitter.com/icfpcontest2020\" target=\"_blank\" rel=\"noopener noreferrer\">Twitter</a> for updates, talk in <a href=\"https://discord.com/invite/xvMJbas\" target=\"_blank\" rel=\"noopener noreferrer\">Discord</a>.</p>\r\n                    </li>\r\n                    <li>\r\n                        <p>(Also, we had these <Link to={ ROUTES.rules } target=\"_blank\">rules</Link>.)</p>\r\n                    </li>\r\n                </ul>\r\n            </section>\r\n\r\n            <section className={ styles.section }>\r\n                <h2>Something to compete for</h2>\r\n\r\n                <ul className={ styles.features }>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🤪</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>Fun & joy.</div>\r\n                        <div>These are noble feelings to pursue during the contest</div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🎖</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>1st @ lightning division.</div>\r\n                        <div>One team will take the 1st place after 24 hours</div>\r\n                        <div className={ styles.features__pro }>Their tools will be named very suitable for rapid prototyping</div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🏅</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>Judges' prize.</div>\r\n                        <div>One team which will do something outstanding will take the judges' prize</div>\r\n                        <div className={ styles.features__pro }>This team will be named an extremely cool bunch of hackers</div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🥇</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>1st @ full contest.</div>\r\n                        <div>One team will take the 1st place after 72 hours</div>\r\n                        <div className={ styles.features__pro }>Their tools will be named programming tools of choice for discriminating hackers</div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🥈</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>2nd @ full contest.</div>\r\n                        <div>One team will take the 2nd place after 72 hours</div>\r\n                        <div className={ styles.features__pro }>Their tools will be named fine programming tools for many applications</div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">🥉</span>\r\n                        </div>\r\n                        <div className={ styles.features__title }>3rd @ full contest.</div>\r\n                        <div>One team will take the 3rd place after 72 hours</div>\r\n                        <div className={ styles.features__pro }>Their tools will be named not too shabby</div>\r\n                    </li>\r\n                </ul>\r\n            </section>\r\n\r\n            <section className={ styles.section }>\r\n                <h2>Look what has happened at Pegovka Observatory</h2>\r\n\r\n                <ul className={ styles.features }>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">😱🙀</span>\r\n                        </div>\r\n                        <div>\r\n                            Read through a <a href=\"https://pegovka.space\" target=\"_blank\" rel=\"noopener noreferrer\">surprising story</a> of Russian astronomer Ivan Zaitsev\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">👩‍💻👨‍💻</span>\r\n                        </div>\r\n                        <div>\r\n                            Join the <a href=\"https://discord.com/invite/xvMJbas\" target=\"_blank\" rel=\"noopener noreferrer\">collective chat</a> with passionate participants\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.features__emoji }>\r\n                            <span role=\"img\" aria-label=\"\">📈📉</span>\r\n                        </div>\r\n                        <div>\r\n                            Recollect what's already known via the <a href=\"https://message-from-space.readthedocs.io/en/latest/\" target=\"_blank\" rel=\"noopener noreferrer\">Read the Docs</a> page\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n\r\n                <ul className={ styles.videos }>\r\n                    <li>\r\n                        <iframe title=\"first-video\" width=\"300\" height=\"170\" src=\"https://www.youtube.com/embed/EjL-5EuQeCU\" frameBorder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen/>\r\n                    </li>\r\n                    <li>\r\n                        <iframe title=\"second-video\" width=\"300\" height=\"170\" src=\"https://www.youtube.com/embed/j7kVUaZCcMU\" frameBorder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen/>\r\n                    </li>\r\n                    <li>\r\n                        <iframe title=\"title-video\" width=\"300\" height=\"170\" src=\"https://www.youtube.com/embed/PzJ6gfo92oA\" frameBorder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen/>\r\n                    </li>\r\n                </ul>\r\n            </section>\r\n\r\n            <section className={ styles.section }>\r\n                <h2>Special thanks</h2>\r\n\r\n                <ul className={ styles.thanks }>\r\n                    <li>\r\n                        <div className={ styles.thanks__title }>\r\n                            <a href=\"https://www.icfpconference.org\" target=\"_blank\" rel=\"noopener noreferrer\">ICFP</a>\r\n                        </div>\r\n                        <div className={ styles.thanks__script }>\r\n                            for sponsoring ICFP Contest and making it happen for 23 years in a row\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.thanks__title }>\r\n                            <a href=\"https://tech.kontur.ru\" target=\"_blank\" rel=\"noopener noreferrer\">Kontur</a>\r\n                        </div>\r\n                        <div className={ styles.thanks__script }>\r\n                            for sponsoring ICFP Contest 2020 and employing the team of its organizers\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </section>\r\n\r\n            <section className={ styles.section }>\r\n                <h2>Warm wishes to our supporters</h2>\r\n\r\n                <ul className={ styles.supporters }>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://adventofcode.com\" target=\"_blank\" rel=\"noopener noreferrer\">Advent of Code</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its creator <a href=\"https://twitter.com/ericwastl\" target=\"_blank\" rel=\"noopener noreferrer\">Eric&nbsp;Wastl</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://atcoder.jp\" target=\"_blank\" rel=\"noopener noreferrer\">AtCoder</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its founder <a href=\"https://twitter.com/chokudai\" target=\"_blank\" rel=\"noopener noreferrer\">Naohiro&nbsp;Takahashi</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://codeforces.com/?locale=en\" target=\"_blank\" rel=\"noopener noreferrer\">Codeforces</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its founder <a href=\"https://twitter.com/MikeMirzayanov\" target=\"_blank\" rel=\"noopener noreferrer\">Mike&nbsp;Mirzayanov</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://www.codingame.com\" target=\"_blank\" rel=\"noopener noreferrer\">CodinGame</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its community manager <a href=\"https://twitter.com/thibaud_jobert\" target=\"_blank\" rel=\"noopener noreferrer\">Thibaud&nbsp;Jobert</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://devzen.ru\" target=\"_blank\" rel=\"noopener noreferrer\">DevZen Podcast</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its hosts <a href=\"https://twitter.com/SBozhko\" target=\"_blank\" rel=\"noopener noreferrer\">Sveta</a>, <a href=\"https://twitter.com/afiskon\" target=\"_blank\" rel=\"noopener noreferrer\">Aleksander</a>, <a href=\"https://twitter.com/gliush\" target=\"_blank\" rel=\"noopener noreferrer\">Ivan</a>, and&nbsp;<a href=\"https://twitter.com/sum3rman\" target=\"_blank\" rel=\"noopener noreferrer\">Valery</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://it-people.ru\" target=\"_blank\" rel=\"noopener noreferrer\">IT People</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its founder <a href=\"https://www.facebook.com/yulia.gerasimovich\" target=\"_blank\" rel=\"noopener noreferrer\">Yulia&nbsp;Gerasimovich</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            <a href=\"https://jugru.org/en/\" target=\"_blank\" rel=\"noopener noreferrer\">JUG Ru Group</a>\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            and its producer <a href=\"https://twitter.com/23derevo\" target=\"_blank\" rel=\"noopener noreferrer\">Alexey&nbsp;Fyodorov</a>\r\n                        </div>\r\n                    </li>\r\n                    <li>\r\n                        <div className={ styles.supporters__title }>\r\n                            And also:\r\n                        </div>\r\n                        <div className={ styles.supporters__script }>\r\n                            <a href=\"https://twitter.com/ilyasergey\" target=\"_blank\" rel=\"noopener noreferrer\">Ilya&nbsp;Sergey</a>, <a href=\"https://twitter.com/nikitonsky\" target=\"_blank\" rel=\"noopener noreferrer\">Nikita&nbsp;Prokopov</a>, and <a href=\"https://twitter.com/VBragilevsky\" target=\"_blank\" rel=\"noopener noreferrer\">Vitaly&nbsp;Bragilevsky</a>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </section>\r\n        </div>\r\n    )\r\n}\r\n","import RulesPage from './RulesPage';\r\nexport default RulesPage;\r\n","import React from 'react';\r\n\r\nexport default function RulesPage() {\r\n    return (\r\n        <main>\r\n            <h2>Contest Rules</h2>\r\n            <h3>1. Participants</h3>\r\n            <p>\r\n                This is an open contest. Anyone may participate in ICFP Programming Contest 2020 except for its Organizers.\r\n                Employees of the company which Organizers are affiliated with are not eligible for prizes.\r\n            </p>\r\n            <h3>2. Teams</h3>\r\n            <p>\r\n                Contestants are free to organize themselves into teams of any size.\r\n                A contestant may only be a member of a single team.\r\n                Teams may not divide, merge, or collaborate after the start of the contest.\r\n            </p>\r\n            <h3>3. Registration</h3>\r\n            <p>\r\n                No advance registration or entry fee is required.\r\n                Teams must register during the contest to obtain a team-specific private identifier that will be used for submissions and profiles.\r\n                Teams using more than one private identifier during the contest may be disqualified.\r\n            </p>\r\n            <h3>4. Languages & platforms</h3>\r\n            <p>\r\n                Teams are free to use any programming language(s) on any platform(s).\r\n                Some programming languages and platforms may require additional tuning of the submission system.\r\n                Participants are encouraged to check the <a href=\"https://github.com/icfpcontest2020/dockerfiles/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">supported languages and platforms</a> in advance and inform Organizers if their language or platform of choice is missing.\r\n            </p>\r\n            <h3>5. Prizes</h3>\r\n            <p>\r\n                Teams wishing to be considered for prizes must submit source code at the end of the contest.\r\n                The exact details of contest submissions will be announced at the start of the contest.\r\n                Teams may submit multiple times during the contest.\r\n            </p>\r\n            <p>\r\n                The Organizers will distribute US $2,000 in prize money between the teams that will take the 1st, the 2nd, and the 3rd places in the contest (full  72-hour division).\r\n            </p>\r\n            <h3>6. Records</h3>\r\n            <p>\r\n                The Organizers retain the right to monitor, record, and investigate the submissions, other contest-related activities, or lack thereof, of contestants and teams.\r\n                The records are used for the sole purpose of judgment and are discarded once the contest-related events are over.\r\n            </p>\r\n            <h3>7. Fair play</h3>\r\n            <p>\r\n                Contestants are kindly asked not to attempt to attack the contest server.\r\n                That will spoil the fun for the other teams and the Organizers, who worked hard to bring you this experience.\r\n                Violations of these rules, attempts to compromise the integrity of the contest infrastructure, attempts to interfere with other contestants, collusion between the teams, or attempts to contravene the spirit of the contest will lead to disqualification of the involved contestants and/or teams.\r\n            </p>\r\n            <h3>8. Intellectual property</h3>\r\n            <p>\r\n                Contestants retain ownership of all intellectual property rights in and to any submitted solutions, source code, custom tools, and related materials (“Submissions”) that contestants had before submission.\r\n                As a condition of submission, contestants grant the Organizers a non-exclusive, perpetual, irrevocable, worldwide, royalty-free license to use, reproduce, publish, distribute, publicly perform and publicly display the Submissions, allowing the Organizers to test and evaluate the Submissions for purposes of the contest.\r\n            </p>\r\n            <h3>9. Authority</h3>\r\n            <p>All decisions of the Organizers are final.</p>\r\n\r\n            <h2>Changelog</h2>\r\n            <h3>Jul 6, 2020 — 1. Participants</h3>\r\n            <p>\r\n                Organizers deem unfeasible to prevent ~9,000 employees of Kontur, the company which also employs the majority of Organizers, from participation in the contest.\r\n                However, Organizers declare that they kept secret from their coworkers everything which may give them any competitive advantage.\r\n                Therefore, Organizers have removed the limitation for employees of Kontur to participate in the contest.\r\n                At the same time, Organizes have added the rule that employees of Kontur are not eligible for prizes.\r\n            </p>\r\n            <h3>Jul 6, 2020 — 4. Languages & platforms</h3>\r\n            <p>\r\n                Organizers have decided to use a particular kind of <a href=\"https://github.com/icfpcontest2020/dockerfiles/blob/master/README.md\" target=\"_blank\" rel=\"noopener noreferrer\">submission system</a> for this contest which requires teams to use Git and Docker.\r\n                Therefore, Organizers have added the suggestion for teams to check the supported languages and platforms in advance.\r\n            </p>\r\n            <h3>Jul 14, 2020 — 5. Prizes</h3>\r\n            <p>\r\n                Organizers have clarified the amount of prize money awarded to the winning teams.\r\n            </p>\r\n        </main>\r\n    )\r\n}\r\n","const emptyTeam = {\r\n    teamName: '',\r\n    gitRepositoryUrl: '',\r\n    customData_country: 'World',\r\n    customData_peopleAmount: '',\r\n    customData_email: '',\r\n};\r\n\r\nexport default emptyTeam;\r\n","import React, { ChangeEvent, FormEvent, ReactElement } from 'react';\r\nimport styles from './styles.module.css';\r\nimport globalForm from '../forms.module.css';\r\nimport RegistrationTeam from '../../models/RegistrationTeam';\r\nimport countriesJson from '../../consts/countries.json';\r\nimport ICountry from '../../models/Country';\r\nimport Toast from \"../Toast\";\r\n\r\ntype TeamFormProps = {\r\n    startValue: RegistrationTeam;\r\n    loading: boolean;\r\n    isEditForm?: boolean;\r\n    onSubmit: (team: RegistrationTeam) => void;\r\n};\r\n\r\ntype Validations = { [key: string]: string };\r\n\r\ntype TeamFormState = {\r\n    teamInfo: RegistrationTeam;\r\n    validations: Validations;\r\n};\r\n\r\nconst countries = countriesJson as ICountry[]\r\n\r\nexport default class TeamForm extends React.Component<TeamFormProps, TeamFormState> {\r\n    constructor(props: TeamFormProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            teamInfo: { ...props.startValue },\r\n            validations: {},\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { isEditForm, loading } = this.props;\r\n\r\n        let buttonText: string;\r\n\r\n        if (isEditForm) {\r\n            buttonText = loading ? \"Updating...\" : \"Update\";\r\n        } else {\r\n            buttonText = loading ? \"Registering...\" : \"Register\";\r\n        }\r\n\r\n        return (\r\n            <form className={ globalForm.form } onSubmit={ this.registerTeam }>\r\n                { this.renderRow('Team name *', 'teamName', true, {\r\n                    autoFocus: !isEditForm,\r\n                    maxLength: 100,\r\n                }) }\r\n                { this.renderRow('Contact email *', 'customData_email', true, {\r\n                    type: 'email',\r\n                    maxLength: 100,\r\n                }) }\r\n                { this.renderRow('Repository SSH URL *', 'gitRepositoryUrl', true, {\r\n                    maxLength: 1024,\r\n                    placeholder: 'git@example.com:user/repo.git'\r\n                }) }\r\n                { this.renderCountrySelect() }\r\n                { this.renderRow('Team size', 'customData_peopleAmount', false, {\r\n                    type: 'number',\r\n                    maxLength: 100,\r\n                }) }\r\n                <div className={ styles.buttonRow }>\r\n                    <span/>\r\n                    <div>\r\n                        <button type='submit' disabled={ loading }>\r\n                            { buttonText }\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        )\r\n    }\r\n\r\n    renderRow(label: string | ReactElement, fieldName: keyof RegistrationTeam, required = false, props?: Object) {\r\n        const { validations } = this.state\r\n        const isError = fieldName in validations;\r\n\r\n        return (\r\n            <label className={ styles.row }>\r\n                <span>{ label }</span>\r\n                <span style={ { width: '100%' } }>\r\n                    <input className={ isError ? ' ' + styles.error : '' }\r\n                           name={ fieldName }\r\n                           value={ this.state.teamInfo[fieldName] }\r\n                           required={ required }\r\n                           onChange={ this.onChange(fieldName) }\r\n                           { ...props }\r\n                    />\r\n                    { isError && <Toast message={ validations[fieldName] } isError /> }\r\n                </span>\r\n            </label>\r\n        );\r\n    }\r\n\r\n    renderCountrySelect() {\r\n        return (\r\n            <label className={ styles.row }>\r\n                <span>Your country</span>\r\n                <select name='customData_country'\r\n                        value={ this.state.teamInfo['customData_country'] }\r\n                        onChange={ this.onChange('customData_country') }>\r\n                    { countries.map(country =>\r\n                        <option value={ country.value } key={ country.value }>{ country.text }</option>\r\n                    ) }\r\n                </select>\r\n            </label>\r\n        )\r\n    }\r\n\r\n    onChange = (field: keyof RegistrationTeam) => (e: ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n        const val = e.target.value;\r\n        this.setState({\r\n            teamInfo: {\r\n                ...this.state.teamInfo,\r\n                [field]: val,\r\n            }\r\n        })\r\n    }\r\n\r\n    registerTeam = async (e: FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!this.validate()) return;\r\n\r\n        this.props.onSubmit(this.state.teamInfo);\r\n    }\r\n\r\n    validate() {\r\n        const { teamName, gitRepositoryUrl } = this.state.teamInfo;\r\n\r\n        const validations: Validations = {};\r\n        if (!teamName) {\r\n            validations['teamName'] = 'Team Name is required for registration';\r\n        }\r\n\r\n        if (!gitRepositoryUrl) {\r\n            validations['gitRepositoryUrl'] = 'Repository SSH URL is required for registration';\r\n        }\r\n\r\n        if (!/[^@]+@[^@:]+/.test(gitRepositoryUrl)) {\r\n            validations['gitRepositoryUrl'] = 'Make sure the url you enter is a valid SSH URL';\r\n        }\r\n\r\n        this.setState({ validations })\r\n\r\n        return Object.keys(validations).length === 0;\r\n    }\r\n}\r\n","import TeamForm from './TeamForm';\r\nexport default TeamForm;\r\n","import RegistrationPage from './RegistrationPage';\r\nexport default RegistrationPage;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport emptyTeam from '../../consts/emptyTeam';\r\nimport TeamForm from '../TeamForm';\r\nimport RegistrationTeam from '../../models/RegistrationTeam';\r\n\r\n\r\ntype RegistrationPageProps = {\r\n    loading: boolean;\r\n    register: (team: RegistrationTeam) => void;\r\n}\r\n\r\nexport default function RegistrationPage(props: RegistrationPageProps) {\r\n    return (\r\n        <div className={ styles.root }>\r\n            <h2>Team Registration</h2>\r\n            <div className={ styles.disclaimer }>\r\n                <p>As part of registration, we kindly ask to create a private Git repository for your team and provide\r\n                    its SSH URL.</p>\r\n                <p>Don't worry, all information you enter here can be updated later.</p>\r\n            </div>\r\n            <TeamForm startValue={ emptyTeam } onSubmit={ props.register } loading={ props.loading }/>\r\n        </div>\r\n    )\r\n}\r\n","export const SET_ERROR = 'SET_ERROR';\r\n\r\nexport const UPDATE_API_KEY = 'UPDATE_API_KEY';\r\nexport const UPDATE_TEAM = 'UPDATE_TEAM';\r\nexport const LOAD_TEAM = 'LOAD_TEAM';\r\n\r\nexport const LOAD_SUBMISSIONS = 'LOAD_SUBMISSIONS';\r\nexport const UPDATE_LAST_SEEN_SUBMISSION = 'UPDATE_LAST_SEEN_SUBMISSION';\r\nexport const ACTIVATE_SUBMISSION = 'ACTIVATE_SUBMISSION';\r\nexport const LOAD_OTHER_TEAMS_SUBMISSION = 'LOAD_OTHER_TEAMS_SUBMISSION';\r\n\r\nexport const LOAD_PROBLEM_SCOREBOARD = 'LOAD_PROBLEM_SCOREBOARD';\r\nexport const LOAD_TOTAL_SCOREBOARD = 'LOAD_SCOREBOARD';\r\nexport const LOAD_FINAL_SCOREBOARD = 'LOAD_FINAL_SCOREBOARD';\r\n\r\nexport const LOAD_CURRENT_TOURNAMENT = 'LOAD_CURRENT_TOURNAMENT';\r\n\r\nexport const RUN_NON_RATING_GAME = 'RUN_NON_RATING_GAME';\r\nexport const LOAD_RATING_GAMES = 'LOAD_RATING_GAMES';\r\nexport const LOAD_NON_RATING_GAMES = 'LOAD_NON_RATING_GAMES';\r\n\r\nexport const START = \"_START\";\r\nexport const SUCCESS = \"_SUCCESS\";\r\nexport const FAIL = \"_FAIL\";\r\nexport const FINISH = \"_FINISH\";\r\n","const json = 'application/json';\r\nconst form = 'application/x-www-form-urlencoded';\r\n\r\nexport function sendGetRequest(url: string) {\r\n    return sendRequest(url, {});\r\n}\r\n\r\nexport function sendPostRequest(url: string, body: object | null) {\r\n    return sendRequest(url, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': json,\r\n        },\r\n        body: body ? JSON.stringify(body) : undefined,\r\n    })\r\n}\r\n\r\nexport function sendPostFormRequest(url: string, body: string) {\r\n    return sendRequest(url, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': form,\r\n        },\r\n        body: body,\r\n    })\r\n}\r\n\r\nexport function sendPatchFormRequest(url: string, body: string) {\r\n    return sendRequest(url, {\r\n        method: 'PATCH',\r\n        headers: {\r\n            'Content-Type': form,\r\n        },\r\n        body: body,\r\n    })\r\n}\r\n\r\nfunction sendRequest(url: string, params: RequestInit) {\r\n    return fetch(url, params).then(async resp => {\r\n        const contentType = resp.headers.get('Content-Type')?.split(';')[0];\r\n\r\n        if (resp.ok && contentType === json) {\r\n            return resp.json();\r\n        }\r\n\r\n        if (resp.ok) {\r\n            return;\r\n        }\r\n        \r\n        if (contentType === json) {\r\n            const errorJson = await resp.json();\r\n            return Promise.reject(errorJson.message || errorJson.error || JSON.stringify(errorJson));\r\n        }\r\n        \r\n        const errMessage = `Something went wrong. Server answer is ${ resp.status }${ \r\n            resp.statusText ? ':' + resp.statusText : '' }`\r\n        return Promise.reject(errMessage);\r\n    });\r\n}\r\n","const serverUrl = 'https://icfpc2020-api.testkontur.ru';\r\nconst teams = `${serverUrl}/teams`;\r\nexport const registration = `${ teams }/register`;\r\nexport const currentTeam = `${ teams }/current`;\r\n\r\nexport const submissions = `${serverUrl}/submissions`;\r\nexport const submissionActivate = (id: string) =>  `${submissions}/${id}/activate`;\r\nexport const otherTeamsSubmission = `${submissions}/other-teams`;\r\n\r\nexport const events = `${serverUrl}/events/`; \r\n\r\nexport const scoreboard = `${serverUrl}/scoreboard`;\r\nexport const problemsScoreboard = `${scoreboard}/lightning`;\r\nexport const finalScoreboard = `${scoreboard}/essentials`;\r\n\r\nexport const tournaments = `${serverUrl}/tournaments`;\r\nexport const currentTournament = `${tournaments}/current`;\r\n\r\nexport const games = `${serverUrl}/games`;\r\nexport const nonRatingGames = `${games}/non-rating`;\r\nexport const nonRatingGamesRun = `${nonRatingGames}/run`;\r\n\r\nexport const logs = `${serverUrl}/logs`;\r\n","import { SET_ERROR } from '../consts/actions';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport IAppAction from '../models/actions/app';\r\nimport { Dispatch } from 'redux';\r\n\r\nexport const createSetErrorAction = (error: string | Error | null) => ({\r\n    type: SET_ERROR,\r\n    payload: error,\r\n})\r\n\r\nexport function setErrorAction(action: { payload: string | Error | null }):\r\n    ThunkAction<void, IStore, unknown, IAppAction>  {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(createSetErrorAction(action.payload));\r\n    }\r\n}\r\n","export default function createFormData(obj: object) {\r\n    return Object.entries(obj).map(i => `${ i[0] }=${ encodeURIComponent(i[1]) }`).join('&');\r\n}\r\n","export default function createQueryString(obj: object) {\r\n    return Object.entries(obj).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');\r\n}\r\n","import { FINISH, LOAD_TEAM, START, UPDATE_API_KEY, UPDATE_TEAM } from '../consts/actions';\r\nimport { Dispatch } from 'redux';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport ITeamAction from '../models/actions/team';\r\nimport Team from '../models/Team';\r\nimport { sendGetRequest, sendPatchFormRequest, sendPostFormRequest } from '../utils/sendRequest';\r\nimport { currentTeam, registration } from '../consts/api';\r\nimport { createSetErrorAction } from './app';\r\nimport { API_KEY } from '../consts/strings';\r\nimport RegistrationTeam from '../models/RegistrationTeam';\r\nimport createFormData from '../utils/createFormData';\r\nimport createQueryString from '../utils/createQueryString';\r\n\r\nconst createUpdateApiKeyAction = (apiKey: string | null) => ({\r\n    type: UPDATE_API_KEY,\r\n    payload: apiKey,\r\n})\r\n\r\nconst createUpdateTeamAction = (team: Team | null) => ({\r\n    type: UPDATE_TEAM,\r\n    payload: team,\r\n})\r\n\r\nconst createLoadTeamStartAction = () => ({\r\n    type: LOAD_TEAM + START,\r\n})\r\n\r\nconst createLoadTeamFinishAction = () => ({\r\n    type: LOAD_TEAM + FINISH,\r\n})\r\n\r\nexport function updateApiKey(action: { payload: string | null }):\r\n    ThunkAction<void, IStore, unknown, ITeamAction> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(createUpdateApiKeyAction(action.payload));\r\n    }\r\n}\r\n\r\nexport function updateTeam(action: { payload: Team | null }):\r\n    ThunkAction<void, IStore, unknown, ITeamAction> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(createUpdateTeamAction(action.payload))\r\n    }\r\n}\r\n\r\nexport function loadTeam():\r\n    ThunkAction<Promise<any>, IStore, unknown, ITeamAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        dispatch(createLoadTeamStartAction());\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const requestUrl = `${ currentTeam }?${ createQueryString({ apiKey }) }`;\r\n        try {\r\n            const team = await sendGetRequest(requestUrl);\r\n            dispatch(createUpdateTeamAction(team));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        } finally {\r\n            dispatch(createLoadTeamFinishAction());\r\n        }\r\n    }\r\n}\r\n\r\nexport function login(action: { payload: string }):\r\n    ThunkAction<Promise<any>, IStore, unknown, ITeamAction> {\r\n    return async (dispatch: Dispatch) => {\r\n        dispatch(createLoadTeamStartAction());\r\n        const requestUrl = `${ currentTeam }?${ createQueryString({ apiKey: action.payload }) }`\r\n        try {\r\n            const team = await sendGetRequest(requestUrl);\r\n            window.localStorage.setItem(API_KEY, action.payload);\r\n            dispatch(createUpdateApiKeyAction(action.payload));\r\n            dispatch(createUpdateTeamAction(team));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        } finally {\r\n            dispatch(createLoadTeamFinishAction());\r\n        }\r\n    }\r\n}\r\n\r\nexport function register(action: { payload: RegistrationTeam }):\r\n    ThunkAction<Promise<any>, IStore, unknown, ITeamAction> {\r\n    return async (dispatch: Dispatch) => {\r\n        dispatch(createLoadTeamStartAction());\r\n        const body = createFormData(action.payload);\r\n        try {\r\n            const team = await sendPostFormRequest(registration, body);\r\n            window.localStorage.setItem(API_KEY, team.apiKey);\r\n            dispatch(createUpdateApiKeyAction(team.apiKey));\r\n            dispatch(createUpdateTeamAction(team));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        } finally {\r\n            dispatch(createLoadTeamFinishAction());\r\n        }\r\n    }\r\n}\r\n\r\nexport function editTeam(action: { payload: RegistrationTeam }):\r\n    ThunkAction<Promise<any>, IStore, unknown, ITeamAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        dispatch(createLoadTeamStartAction());\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const requestUrl = `${ currentTeam }?${ createQueryString({ apiKey }) }`;\r\n        const body = createFormData(action.payload);\r\n        try {\r\n            const team = await sendPatchFormRequest(requestUrl, body);\r\n            dispatch(createUpdateTeamAction(team));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        } finally {\r\n            dispatch(createLoadTeamFinishAction());\r\n        }\r\n    }\r\n}\r\n","export default function <T>(data: T) {\r\n    return {\r\n        type: '',\r\n        payload: data,\r\n    }\r\n}\r\n","import { connect } from 'react-redux';\r\nimport RegistrationPage from '../components/RegistrationPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { register } from '../actions/team';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\nimport RegistrationTeam from '../models/RegistrationTeam';\r\n\r\nconst mapState = (store: IStore) => {\r\n    return {\r\n        loading: store.team.teamLoading,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        register: (team: RegistrationTeam) => dispatch(register(createEmptyAction(team))),\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(RegistrationPage);\r\n","import LoginPage from './LoginPage';\r\nexport default LoginPage;\r\n","import React, { ChangeEvent, FormEvent } from 'react';\r\nimport styles from './styles.module.css';\r\nimport globalForm from '../forms.module.css';\r\n\r\nexport interface LoginPageProps {\r\n    loading: boolean;\r\n    login: (apiKey: string) => void;\r\n}\r\n\r\ntype LoginPageState = {\r\n    apiKey: string;\r\n}\r\n\r\nexport default class LoginPage extends React.Component<LoginPageProps, LoginPageState> {\r\n    constructor(props: LoginPageProps) {\r\n        super(props);\r\n        this.state = {\r\n            apiKey: '',\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const { loading } = this.props;\r\n        return (\r\n            <div>\r\n                <h2>Log In</h2>\r\n                <form className={ `${ styles.form } ${ globalForm.form }` } onSubmit={ this.onSubmit }>\r\n                    <label className={ styles.row }>\r\n                        <span>API key</span>\r\n                        <input name='apiKey'\r\n                               required\r\n                               autoFocus\r\n                               onChange={ this.onChange }\r\n                        />\r\n                    </label>\r\n                    <label className={ styles.buttonRow }>\r\n                        <span/>\r\n                        <div>\r\n                            <button type='submit' disabled={ loading }>\r\n                                { loading ? \"Logging In...\" : \"Log In\" }\r\n                            </button>\r\n                        </div>\r\n                    </label>\r\n                </form>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    onChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({ apiKey: e.target.value })\r\n    }\r\n\r\n    onSubmit = async (e: FormEvent) => {\r\n        e.preventDefault();\r\n        const { apiKey } = this.state;\r\n        \r\n        this.props.login(apiKey);\r\n    }\r\n}\r\n","import { connect } from 'react-redux';\r\nimport LoginPage from '../components/LoginPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { login } from '../actions/team';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\n\r\nconst mapState = (state: IStore) => {\r\n    return {\r\n        loading: state.team.teamLoading,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        login: (apiKey: string) => dispatch(login(createEmptyAction(apiKey))), \r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(LoginPage);\r\n","import ShowAndCopyForm from './ShowAndCopyForm';\r\nexport default ShowAndCopyForm;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport globalForm from '../forms.module.css';\r\nimport CopyToClipboard from 'react-copy-to-clipboard';\r\nimport Toast from '../Toast';\r\n\r\ninterface ShowAndCopyFormProps {\r\n    name: string;\r\n    value: string;\r\n    rows?: number;\r\n}\r\n\r\ninterface ShowAndCopyFormState {\r\n    showToast: boolean;\r\n}\r\n\r\nexport default class ShowAndCopyForm extends React.Component<ShowAndCopyFormProps, ShowAndCopyFormState> {\r\n    state = {\r\n        showToast: false,\r\n    }\r\n\r\n    render() {\r\n        const { showToast } = this.state;\r\n        const rows = this.props.rows || 1\r\n\r\n        return (\r\n            <form className={ `${ styles.root } ${ globalForm.form }` }>\r\n                { rows === 1 && (\r\n                    <input type=\"text\" disabled value={ this.props.value }/>\r\n                ) }\r\n\r\n                { rows !== 1 && (\r\n                    <textarea disabled rows={ rows } value={ this.props.value }/>\r\n                ) }\r\n\r\n                <div>\r\n                    <CopyToClipboard text={ this.props.value }>\r\n                        <button type='button' onClick={ this.showToast }>Copy { this.props.name }</button>\r\n                    </CopyToClipboard>\r\n                </div>\r\n                { showToast && <Toast message='Copied to clipboard' onClose={ this.closeToast }/> }\r\n            </form>\r\n        )\r\n    }\r\n\r\n    showToast = () => {\r\n        this.setState({ showToast: true });\r\n    }\r\n\r\n    closeToast = () => {\r\n        this.setState({ showToast: false });\r\n    }\r\n}\r\n","import TeamInfoPage from './TeamInfoPage';\r\nexport default TeamInfoPage;\r\n","export default interface Submission {\r\n    submissionId: string;\r\n    createdAt: string;\r\n    commitHash?: string;\r\n    branchName?: string;\r\n    commitMessage?: string;\r\n    buildLogKey?: string;\r\n    attackerTestLogKey?: string;\r\n    defenderTestLogKey?: string;\r\n    status: SubmissionStatus;\r\n    active: boolean;\r\n}\r\n\r\nexport enum SubmissionStatus\r\n{\r\n    Building = 'Building',\r\n    Testing = 'Testing',\r\n    Failed_Build = 'Failed_Build',\r\n    Failed_Test = 'Failed_Test',\r\n    Failed_Unknown = 'Failed_Unknown',\r\n    Succeeded = 'Succeeded',\r\n}\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport Team from '../../models/Team';\r\nimport RegistrationTeam from '../../models/RegistrationTeam';\r\nimport TeamForm from '../TeamForm';\r\nimport ShowAndCopyForm from \"../ShowAndCopyForm\";\r\n\r\ntype TeamInfoPageProps = {\r\n    team: Team | null;\r\n    loading: boolean;\r\n    editTeam: (team: RegistrationTeam) => void;\r\n}\r\n\r\nexport default function TeamInfoPage(props: TeamInfoPageProps) {\r\n    const { team } = props;\r\n\r\n    if (!team) return null;\r\n\r\n    const teamForForm: RegistrationTeam = {\r\n        teamName: team.teamName,\r\n        gitRepositoryUrl: team.gitRepositoryUrl,\r\n        customData_peopleAmount: team.customData.peopleAmount || '',\r\n        customData_country: team.customData.country || '',\r\n        customData_email: team.customData.email || '',\r\n    }\r\n\r\n    return (\r\n        <main className={ styles.root }>\r\n            <h2>Profile: { team.teamName }</h2>\r\n\r\n            <h3>API key</h3>\r\n            <p>Beware not to lose your API key. Use it:</p>\r\n            <ul>\r\n                <li>to log in to the team profile (this page)</li>\r\n                <li>to send requests to Organizers' server</li>\r\n            </ul>\r\n            <br/>\r\n            <ShowAndCopyForm name=\"API key\"\r\n                             value={ team.apiKey }/>\r\n\r\n            <br/><br/>\r\n\r\n            <h3>Deploy key</h3>\r\n            <p>Add it to your repository as per <a href=\"https://github.com/icfpcontest2020/dockerfiles#getting-started\"\r\n                                                   target=\"_blank\" rel=\"noopener noreferrer\">submission rules</a>.</p>\r\n            <ShowAndCopyForm name=\"Deploy key\"\r\n                             value={ team.deployKey }/>\r\n\r\n            <br/><br/>\r\n\r\n            <h3>Team Info</h3>\r\n            <div>\r\n                <TeamForm startValue={ teamForForm }\r\n                          loading={ props.loading }\r\n                          onSubmit={ props.editTeam } isEditForm/>\r\n            </div>\r\n        </main>\r\n    )\r\n}\r\n","import { connect } from 'react-redux';\r\nimport TeamInfoPage from '../components/TeamInfoPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { editTeam } from '../actions/team';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\nimport RegistrationTeam from '../models/RegistrationTeam';\r\n\r\nconst mapState = (store: IStore) => {\r\n    return {\r\n        team: store.team.team,\r\n        loading: store.team.teamLoading,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        editTeam: (team: RegistrationTeam) => dispatch(editTeam(createEmptyAction(team))),\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(TeamInfoPage);\r\n","import React from 'react';\r\nimport styles from './style.module.css';\r\n\r\ntype DateTimeProps = {\r\n    dateStr: string;\r\n}\r\n\r\nexport const formatter = new Intl.DateTimeFormat('en-US', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    month: 'short',\r\n    day: '2-digit',\r\n    hour12: false\r\n})\r\n\r\nexport default function DateTime(props: DateTimeProps) {\r\n    const { dateStr } = props;\r\n    const date = new Date(dateStr);\r\n\r\n    return (\r\n        <span className={ styles.root } title={Intl.DateTimeFormat().resolvedOptions().timeZone}>\r\n            {formatter.format(date)}\r\n        </span>\r\n    )\r\n}\r\n","import DateTime from './DateTime';\r\nexport default DateTime;\r\n","import PlayIcon from './PlayIcon';\r\nexport default PlayIcon;\r\n","import React from 'react';\r\n\r\ninterface PlayIconProps {\r\n    color?: string;\r\n}\r\n\r\nexport default function PlayIcon(props: PlayIconProps) {\r\n    return (\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\"\r\n             x=\"0px\" y=\"0px\" width=\"25px\" height=\"20px\" viewBox=\"20 60 110 90\" enableBackground=\"new 0 0 150 190\"\r\n             xmlSpace=\"preserve\">\r\n            <path fillRule=\"evenodd\" clipRule=\"evenodd\" fill={ props.color || \"#00bfff\" } d=\"M95.693,86.301c-4.998-4.416-10.621-5.84-14.584-3.823\r\n    c-2.53,1.289-4.058,3.9-4.397,7.361l1.697,0.188l2.094,8.631c12.766,0.131,25.108,0.266,33.579,0.337\r\n    c6.308,0.053,10.649,1.572,10.649,10.935c0,9.363,0.229,22.767,0.198,28.352c-0.034,6.369-4.154,8.633-9.891,8.726\r\n    c-3.172,0.051-65.049-0.578-81.744-0.048c-5.542,0.176-8.242-3.824-8.355-10.988c-0.114-7.164,0.158-18.532,0.158-26.877\r\n    c0-8.346,3.366-10.778,10.192-10.778c7.658,0,19.349,0.092,31.781,0.209l2.19-9.509l1.489,0.165\r\n    c0.569-5.47,3.272-9.826,7.636-12.047c6.188-3.15,14.329-1.372,21.244,4.641c6.601,5.737,16.484,4.271,21.189-2.913l4.268,3.754\r\n    C119.143,92.188,104.568,94.142,95.693,86.301z M112.932,137.325c4.271-4.271-2.671-10.989-7.141-6.52\r\n    C101.407,135.189,107.864,142.391,112.932,137.325z M98.204,137.325c4.271-4.271-2.671-10.989-7.141-6.52\r\n    C86.679,135.189,93.137,142.391,98.204,137.325z M94.136,124.476c4.077-0.017,12.968-0.183,16.218-0.112\r\n    c11.747,0.255,10.067-16.551,1.118-16.775c-8.747-0.219-14.666-0.085-18.694-0.015C82.342,107.754,82.887,124.521,94.136,124.476z\r\n    M59.696,121.976l-8.083,0.284v-6.991l-8.083,0.172l-0.161,7.109l-8.094,0.285l0.344,7.223l7.576,0.108l-0.181,7.974h8.599v-7.854\r\n    l8.083,0.116V121.976z M98.204,119.188c-5.067,5.066-11.525-2.135-7.141-6.52C95.533,108.2,102.476,114.917,98.204,119.188z\r\n    M112.932,119.188c-5.067,5.066-11.524-2.135-7.141-6.52C110.261,108.2,117.203,114.917,112.932,119.188z\"/>\r\n        </svg>\r\n    )\r\n}\r\n","import SubmissionsPage from './SubmissionsPage';\r\nexport default SubmissionsPage;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport Team from '../../models/Team';\r\nimport Submission, { SubmissionStatus } from '../../models/Submission';\r\nimport DateTime from '../DateTime';\r\nimport Toast from '../Toast';\r\nimport PlayIcon from '../PlayIcon';\r\n\r\ninterface SubmissionsPageProps {\r\n    team: Team | null;\r\n    submissions: Submission[] | null;\r\n    loadSubmissions: () => void;\r\n    updateLastSeenSubmission: (id: string) => void;\r\n    activateSubmission: (id: string) => void;\r\n}\r\n\r\ninterface SubmissionsPageState {\r\n    showChangeSubmission: boolean;\r\n}\r\n\r\nexport default class SubmissionsPage extends React.Component<SubmissionsPageProps, SubmissionsPageState> {\r\n    state = {\r\n        showChangeSubmission: false,\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (!this.props.submissions) {\r\n            this.getSubmissions();\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<SubmissionsPageProps>) {\r\n        this.checkLastSeenSubmission(prevProps);\r\n        this.checkActiveSubmissionChange(prevProps);\r\n    }\r\n\r\n    render() {\r\n        const { team } = this.props;\r\n        const { showChangeSubmission } = this.state;\r\n\r\n        if (!team) return null\r\n\r\n        return (\r\n            <div>\r\n                <h2>Submissions: { team.teamName }</h2>\r\n\r\n                <p className={ styles.help }>A successful submission should <code\r\n                    className={ styles.branch }>join</code> and <code\r\n                    className={ styles.branch }>start</code> a game on <a\r\n                    href='https://message-from-space.readthedocs.io/en/latest/game.html#join'\r\n                    target='_blank' rel=\"noopener noreferrer\">the alien server</a>.<br/>\r\n                    Note that any starter kit is no longer a successful submission.</p>\r\n\r\n                { this.renderSubmissions() }\r\n\r\n                { this.renderHelpMessage() }\r\n                { showChangeSubmission && <Toast message={ 'Active submission changed' }\r\n                                                 onClose={ this.closeToast }/> }\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderSubmissions() {\r\n        const { submissions } = this.props;\r\n        return (\r\n            <table className={ styles.table }>\r\n                <thead>\r\n                <tr>\r\n                    <th>#</th>\r\n                    <th>Commit Message</th>\r\n                    <th>Created At</th>\r\n                    <th>Status</th>\r\n                    <th>Build</th>\r\n                    <th>Test</th>\r\n                    <th>In Rating Games</th>\r\n                </tr>\r\n                </thead>\r\n                <tbody>\r\n                { submissions && submissions.length === 0 && (\r\n                    <tr>\r\n                        <td colSpan={ 7 } style={ { textAlign: \"center\" } }>\r\n                            <p>No submissions yet.</p>\r\n                        </td>\r\n                    </tr>\r\n                ) }\r\n                { submissions && submissions.map(s => this.renderRow(s)) }\r\n                </tbody>\r\n            </table>\r\n        )\r\n    }\r\n\r\n    renderRow(s: Submission) {\r\n        const { team } = this.props;\r\n        const statusTexts: { [key: string]: string } = {\r\n            [SubmissionStatus.Failed_Build]: 'Build failed',\r\n            [SubmissionStatus.Failed_Test]: 'Test failed',\r\n            [SubmissionStatus.Failed_Unknown]: 'Failed',\r\n            [SubmissionStatus.Succeeded]: 'Test passed',\r\n        }\r\n\r\n        const status = statusTexts[s.status] || s.status\r\n        const isFailed = status.toLowerCase().indexOf('failed') !== -1\r\n\r\n        return (\r\n            <tr key={ s.commitHash + s.createdAt }\r\n                className={ s.status !== SubmissionStatus.Succeeded ? '' : styles.succeeded }\r\n                onClick={ this.activateSubmission(s) }>\r\n                <td>{ s.commitHash?.substring(0, 6) }</td>\r\n                <td><span className={ styles.pre }>\r\n                    { s.branchName && <span className={ styles.branch }>[{ s.branchName }] </span> }\r\n                    { s.commitMessage }</span></td>\r\n                <td><DateTime dateStr={ s.createdAt }/></td>\r\n                <td className={ isFailed ? styles.statusFailed : '' }>{ status }</td>\r\n                <td>\r\n                    { s.buildLogKey && team &&\r\n                    <a target='_blank'\r\n                       rel=\"noopener nofollow noreferrer\"\r\n                       className={ styles.logLink }\r\n                       onClick={ this.stopEvent }\r\n                       href={ `https://icfpc2020-api.testkontur.ru/logs/?logKey=${ encodeURIComponent(s.buildLogKey) }&apiKey=${ team.apiKey }` }>\r\n                        Log\r\n                    </a> }\r\n                </td>\r\n                <td>\r\n                    { s.attackerTestLogKey && team &&\r\n                    <div><a target='_blank'\r\n                       rel=\"noopener nofollow noreferrer\"\r\n                       className={ styles.logLink }\r\n                       onClick={ this.stopEvent }\r\n                       href={ `https://icfpc2020-api.testkontur.ru/logs/?logKey=${ encodeURIComponent(s.attackerTestLogKey) }&apiKey=${ team.apiKey }` }>\r\n                        Attacker Log\r\n                    </a></div> }\r\n                    { s.defenderTestLogKey && team &&\r\n                    <div><a target='_blank'\r\n                       rel=\"noopener nofollow noreferrer\"\r\n                       className={ styles.logLink }\r\n                       onClick={ this.stopEvent }\r\n                       href={ `https://icfpc2020-api.testkontur.ru/logs/?logKey=${ encodeURIComponent(s.defenderTestLogKey) }&apiKey=${ team.apiKey }` }>\r\n                       Defender Log\r\n                    </a></div> }\r\n                </td>\r\n                <td>{ s.active ? <PlayIcon/> : <button className={ styles.icon }><PlayIcon/> play</button> }</td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderHelpMessage() {\r\n        return (\r\n            <div className={ styles.help }>\r\n                <p>Please note that the <code className={ styles.branch }>[submission]</code> branch is required.</p>\r\n                <p>If you need assistance,\r\n                    please read the <a href=\"https://github.com/icfpcontest2020/dockerfiles/blob/master/README.md\"\r\n                                       target=\"_blank\" rel=\"noopener noreferrer\">submission rules</a>,\r\n                    then file an <a\r\n                        href=\"https://github.com/icfpcontest2020/dockerfiles/issues/new?labels=submissions&template=submissions.md&title=Submissions%3A+\"\r\n                        target=\"_blank\" rel=\"noopener noreferrer\">issue</a>.\r\n                </p>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    getSubmissions = () => {\r\n        this.props.loadSubmissions();\r\n    }\r\n\r\n    stopEvent = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n    }\r\n\r\n    closeToast = () => {\r\n        this.setState({ showChangeSubmission: false })\r\n    }\r\n\r\n    activateSubmission = (s: Submission) => () => {\r\n        if (s.active || s.status !== SubmissionStatus.Succeeded) return;\r\n\r\n        this.props.activateSubmission(s.submissionId);\r\n    }\r\n\r\n    checkLastSeenSubmission(prevProps: Readonly<SubmissionsPageProps>) {\r\n        const hasSubmissions = this.props.submissions && this.props.submissions.length > 0;\r\n\r\n        if (!hasSubmissions) return;\r\n        const submissions = this.props.submissions as Array<Submission>;\r\n\r\n        const loadedSubmissions = !prevProps.submissions && Boolean(this.props.submissions);\r\n        const changedSubmissions = prevProps.submissions &&\r\n            prevProps.submissions[0]?.submissionId !== submissions[0]?.submissionId;\r\n\r\n        if (loadedSubmissions || changedSubmissions) {\r\n            const id = submissions[0]?.submissionId;\r\n\r\n            this.props.updateLastSeenSubmission(id);\r\n        }\r\n    }\r\n\r\n    checkActiveSubmissionChange(prevProps: Readonly<SubmissionsPageProps>) {\r\n        if (!this.props.submissions || !prevProps.submissions) {\r\n            return;\r\n        }\r\n        const currentActive = this.props.submissions.find(s => s.active);\r\n        const prevActive = prevProps.submissions.find(s => s.active);\r\n\r\n        if (currentActive && currentActive.submissionId !== prevActive?.submissionId) {\r\n            this.setState({ showChangeSubmission: true });\r\n        }\r\n    }\r\n}\r\n","import { LOAD_CURRENT_TOURNAMENT } from '../consts/actions';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport IAppAction from '../models/actions/app';\r\nimport { Dispatch } from 'redux';\r\nimport TournamentDto from '../models/TournamentDto';\r\nimport { createSetErrorAction } from './app';\r\nimport { sendGetRequest } from '../utils/sendRequest';\r\nimport { currentTournament } from '../consts/api';\r\n\r\nexport const createLoadCurrentTournamentAction = (tournament: TournamentDto) => ({\r\n    type: LOAD_CURRENT_TOURNAMENT,\r\n    payload: tournament,\r\n})\r\n\r\nexport function loadCurrentTournament():\r\n    ThunkAction<Promise<any>, IStore, unknown, IAppAction>  {\r\n    return async (dispatch: Dispatch) => {\r\n        try {\r\n            const result = await sendGetRequest(currentTournament);\r\n            dispatch(createLoadCurrentTournamentAction(result));\r\n            return result;\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e));\r\n        }\r\n    }\r\n}\r\n","import {\r\n    ACTIVATE_SUBMISSION, FINISH,\r\n    LOAD_OTHER_TEAMS_SUBMISSION,\r\n    LOAD_SUBMISSIONS, RUN_NON_RATING_GAME, START, SUCCESS,\r\n    UPDATE_LAST_SEEN_SUBMISSION\r\n} from '../consts/actions';\r\nimport Submission from '../models/Submission';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport { Dispatch } from 'redux';\r\nimport ISubmissionsAction from '../models/actions/submissions';\r\nimport { sendGetRequest, sendPostRequest } from '../utils/sendRequest';\r\nimport {\r\n    currentTournament,\r\n    nonRatingGamesRun,\r\n    otherTeamsSubmission,\r\n    submissionActivate,\r\n    submissions\r\n} from '../consts/api';\r\nimport { createSetErrorAction } from './app';\r\nimport createQueryString from '../utils/createQueryString';\r\nimport TeamSubmissionDto from '../models/TeamSubmissionDto';\r\nimport { createLoadCurrentTournamentAction } from './tournament';\r\nimport TournamentDto from '../models/TournamentDto';\r\n\r\nconst createLoadSubmissionsAction = (submissions: Submission[]) => ({\r\n    type: LOAD_SUBMISSIONS,\r\n    payload: submissions,\r\n})\r\nconst createUpdateLastSeenSubmissionAction = (submissionId: string | null) => ({\r\n    type: UPDATE_LAST_SEEN_SUBMISSION,\r\n    payload: submissionId,\r\n})\r\n\r\nconst createActivateSubmissionAction = (submissionId: string) => ({\r\n    type: ACTIVATE_SUBMISSION,\r\n    payload: submissionId,\r\n})\r\n\r\nconst createLoadOtherTeamsSubmissionAction = (submissions: TeamSubmissionDto) => ({\r\n    type: LOAD_OTHER_TEAMS_SUBMISSION,\r\n    payload: submissions,\r\n})\r\n\r\nconst createRunNonRatingGameStartAction = () => ({\r\n    type: RUN_NON_RATING_GAME + START,\r\n})\r\nconst createRunNonRatingGameSuccessAction = () => ({\r\n    type: RUN_NON_RATING_GAME + SUCCESS,\r\n})\r\nconst createRunNonRatingGameFinishAction = () => ({\r\n    type: RUN_NON_RATING_GAME + FINISH,\r\n})\r\n\r\nexport function loadSubmissions():\r\n    ThunkAction<Promise<any>, IStore, unknown, ISubmissionsAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const requestUrl = `${ submissions }?${ createQueryString({ apiKey }) }`\r\n        try {\r\n            const teamSubmissions = await sendGetRequest(requestUrl);\r\n            dispatch(createLoadSubmissionsAction(teamSubmissions));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function updateLastSeenSubmission(action: { payload: string | null }):\r\n    ThunkAction<void, IStore, unknown, ISubmissionsAction> {\r\n    return (dispatch: Dispatch) => {\r\n        dispatch(createUpdateLastSeenSubmissionAction(action.payload));\r\n    }\r\n}\r\n\r\nexport function activateSubmission(action: { payload: string }):\r\n    ThunkAction<Promise<any>, IStore, unknown, ISubmissionsAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const requestUrl = `${ submissionActivate(action.payload) }?${ createQueryString({ apiKey }) }`\r\n\r\n        try {\r\n            await sendPostRequest(requestUrl, null);\r\n            dispatch(createActivateSubmissionAction(action.payload));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function loadOtherTeamSubmissions():\r\n    ThunkAction<Promise<any>, IStore, unknown, ISubmissionsAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const tournament = store.tournament.current\r\n        \r\n        try {\r\n            let tournamentId;\r\n            \r\n            if (!tournament) {\r\n                const result: TournamentDto = await sendGetRequest(currentTournament);\r\n                dispatch(createLoadCurrentTournamentAction(result));\r\n                tournamentId = result.tournamentId;\r\n            } else {\r\n                tournamentId = tournament.tournamentId;\r\n            }\r\n            \r\n            \r\n            const requestUrl = `${ otherTeamsSubmission }?${ createQueryString({ apiKey, tournamentId }) }`;\r\n            const result = await sendGetRequest(requestUrl);\r\n            dispatch(createLoadOtherTeamsSubmissionAction(result));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function runNonRatingGame(action: { payload: {attacker: string, defender: string} }):\r\n    ThunkAction<Promise<any>, IStore, unknown, ISubmissionsAction> {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        dispatch(createRunNonRatingGameStartAction());\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const requestUrl = `${ nonRatingGamesRun }?${ createQueryString({ \r\n            apiKey,\r\n            attackerSubmissionId: action.payload.attacker,\r\n            defenderSubmissionId: action.payload.defender,\r\n        }) }`\r\n        \r\n        try {\r\n            await sendPostRequest(requestUrl, null);\r\n            dispatch(createRunNonRatingGameSuccessAction());\r\n            \r\n            setTimeout(() => dispatch(createRunNonRatingGameFinishAction()), 3000)\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n            dispatch(createRunNonRatingGameFinishAction())\r\n        }\r\n    }\r\n}\r\n","import { connect } from 'react-redux';\r\nimport SubmissionsPage from '../components/SubmissionsPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { activateSubmission, loadSubmissions, updateLastSeenSubmission } from '../actions/submissions';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\n\r\nconst mapState = (store: IStore) => {\r\n    return {\r\n        team: store.team.team,\r\n        submissions: store.submissions.submissions,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        loadSubmissions: () => dispatch(loadSubmissions()),\r\n        updateLastSeenSubmission: (id: string) => dispatch(updateLastSeenSubmission(createEmptyAction(id))),\r\n        activateSubmission: (id: string) => dispatch(activateSubmission(createEmptyAction(id))),\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(SubmissionsPage);\r\n","import Tabs from './Tabs';\r\nexport default Tabs;\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport { RouteComponentProps, Link } from 'react-router-dom';\r\n\r\ninterface TabsProps {\r\n    tabs: {\r\n        hash: string;\r\n        text: string;\r\n    }[];\r\n    location: RouteComponentProps['location'];\r\n}\r\n\r\nexport default function Tabs(props: TabsProps) {\r\n    const hash = props.location.hash;\r\n    return (\r\n        <nav className={ styles.root }>\r\n            <ul className={ styles.list }>\r\n                { props.tabs.map(tab =>\r\n                    <li className={ styles.listItem } key={ tab.text }>\r\n                        <Link to={ tab.hash }\r\n                              className={ styles.link + (hash === tab.hash ? ' ' + styles.active : '') }\r\n                        >{ tab.text }</Link>\r\n                    </li>\r\n                ) }\r\n            </ul>\r\n        </nav>\r\n    )\r\n}\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport ScoreboardPage, { SortDirection } from './ScoreboardPage';\r\nimport Team from '../../models/Team';\r\nimport { ILightningScoreboard, ILightningScoreboardTeam, IProblemDescription } from '../../models/Scoreboard';\r\nimport DateTime from '../DateTime';\r\nimport { GENERAL } from '../../consts/strings';\r\n\r\ninterface LightningScoreboardProps {\r\n    team: Team | null;\r\n    scoreboard: ILightningScoreboard;\r\n}\r\n\r\n\r\ninterface LightningScoreboardState {\r\n    sortBy: string;\r\n    sortDirection: SortDirection;\r\n}\r\n\r\nexport default class LightningScoreboard extends React.Component<LightningScoreboardProps, LightningScoreboardState> {\r\n    state = {\r\n        sortBy: GENERAL,\r\n        sortDirection: SortDirection.decrease,\r\n    }\r\n\r\n    render() {\r\n        const { sortBy, sortDirection } = this.state;\r\n        const { scoreboard, team } = this.props;\r\n        \r\n        const teamsOrder = [...scoreboard.teams].sort(sortElements(sortBy, sortDirection));\r\n        const isFrozen = !!scoreboard.frozenAt && new Date(scoreboard.frozenAt) <= new Date(); \r\n        \r\n        return (\r\n            <>\r\n                <h2>Scoreboard{ team && ': ' + team.teamName } {isFrozen &&\r\n                <span className={styles.frozenTitle}> (frozen at <DateTime dateStr={scoreboard.frozenAt as string}/>)</span>}</h2>\r\n                <table className={ styles.table }>\r\n                    { this.renderHead(teamsOrder) }\r\n                    <tbody>\r\n                    { teamsOrder && teamsOrder.map(this.renderRow) }\r\n                    </tbody>\r\n                </table>\r\n            </>\r\n        )\r\n    }\r\n\r\n    renderHead(teamsOrder: ILightningScoreboardTeam[]) {\r\n        const { scoreboard, team } = this.props;\r\n        const { sortBy, sortDirection } = this.state;\r\n        const hasProblems = scoreboard.problems.length > 0;\r\n        const rowSpan = hasProblems ? 2 : 1;\r\n\r\n        const buttonClass = `${ styles.sortButton } ${ sortBy === GENERAL\r\n            ? sortDirection === SortDirection.decrease ? styles.sortDown : styles.sortUp\r\n            : '' }`\r\n\r\n        return (\r\n            <thead>\r\n\r\n            <tr>\r\n                <th style={ { width: 40 } } rowSpan={ rowSpan }>#</th>\r\n                <th rowSpan={ rowSpan } className={ styles.alignLeft }>Team Name</th>\r\n                { hasProblems &&\r\n                <th colSpan={ scoreboard.problems.length }>Problems</th>\r\n                }\r\n                <th style={ { width: 70 } }\r\n                    className={ styles.score }\r\n                    rowSpan={ rowSpan }>\r\n                    <button className={ buttonClass }\r\n                            onClick={ this.changeSorted(GENERAL) }>\r\n                        Score\r\n                    </button>\r\n                </th>\r\n                <th rowSpan={ rowSpan } className={ styles.alignRight }>Solved at</th>\r\n            </tr>\r\n            { hasProblems &&\r\n            <tr>\r\n                { scoreboard.problems.map(this.cellForProblem) }\r\n            </tr>\r\n            }\r\n            { teamsOrder && teamsOrder\r\n                .map((team, i) => ({ team, i }))\r\n                .filter(tuple => tuple.team.team.teamId === team?.teamId && tuple.i > 5)\r\n                .map(tuple => this.renderRow(tuple.team, tuple.i))\r\n            }\r\n            </thead>\r\n        )\r\n    }\r\n\r\n    cellForProblem = (problem: IProblemDescription) => {\r\n        const { sortBy, sortDirection } = this.state;\r\n        let text = problem.problemId;\r\n        let description = problem.description;\r\n        if (text === 'request') {\r\n            text = 'R';\r\n        }\r\n        if (text === 'submission') {\r\n            text = 'T';\r\n            description = 'Made submission passed the test'\r\n        }\r\n        if (text.startsWith('tutorial')) {\r\n            text = text.replace('tutorial:', '');\r\n        }\r\n        const buttonClass = `${ styles.sortButton } ${ sortBy === problem.problemId\r\n            ? sortDirection === SortDirection.decrease ? styles.sortDown : styles.sortUp\r\n            : '' }`\r\n\r\n        return (\r\n            <th key={ problem.problemId }\r\n                className={ styles.alignRight }\r\n                title={ description }>\r\n                <button onClick={ this.changeSorted(problem.problemId) }\r\n                        className={ buttonClass }>\r\n                    { text }\r\n                </button>\r\n            </th>\r\n        )\r\n    }\r\n\r\n    renderRow = (scoreboardTeam: ILightningScoreboardTeam, index: number) => {\r\n        const { team, scoreboard } = this.props;\r\n\r\n        const teamInfo = scoreboardTeam.team;\r\n        return (\r\n            <tr key={ index } className={ team?.teamId === teamInfo.teamId ? styles.activeTeam : '' }>\r\n                <td className={ styles.alignCenter }>{ index + 1 }</td>\r\n                { ScoreboardPage.renderTeamName(teamInfo) }\r\n                { scoreboard.problems.map(p => this.renderScoreCell(p, scoreboardTeam)) }\r\n                <td className={ styles.score }>{ scoreboardTeam.score }</td>\r\n                <td className={ styles.alignRight }><DateTime dateStr={ scoreboardTeam.solvedAt }/>\r\n                </td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderScoreCell(p: IProblemDescription, scoreboardTeam: ILightningScoreboardTeam) {\r\n        return (\r\n            <td key={ p.problemId }\r\n                className={ styles.alignRight }\r\n                title={ p.problemId in scoreboardTeam.problems\r\n                    ? `Solved at ${ ScoreboardPage.createDate(scoreboardTeam.problems[p.problemId].solvedAt) }`\r\n                    : undefined }>\r\n                { p.problemId in scoreboardTeam.problems\r\n                    ? scoreboardTeam.problems[p.problemId].score\r\n                    : <span className={ styles.lighten }>—</span> }\r\n            </td>\r\n        )\r\n    }\r\n\r\n    changeSorted = (sortBy: string) => () => {\r\n        if (sortBy === this.state.sortBy) {\r\n            const sortDirection = this.state.sortDirection === SortDirection.decrease\r\n                ? SortDirection.increase\r\n                : SortDirection.decrease\r\n            this.setState({ sortDirection })\r\n            return;\r\n        }\r\n        this.setState({ sortBy, sortDirection: SortDirection.decrease })\r\n    }\r\n\r\n}\r\n\r\nfunction sortElements(sortBy: string, sortDirection: SortDirection) {\r\n    return (a: ILightningScoreboardTeam, b: ILightningScoreboardTeam) => {\r\n        let aScore, bScore;\r\n        if (sortBy === GENERAL) {\r\n            aScore = { score: a.score, solvedAt: a.solvedAt };\r\n            bScore = { score: b.score, solvedAt: b.solvedAt };\r\n        } else {\r\n            const aProblem = a.problems[sortBy];\r\n            const bProblem = b.problems[sortBy];\r\n            aScore = aProblem || { score: 0, solvedAt: new Date(0) }\r\n            bScore = bProblem || { score: 0, solvedAt: new Date(0) }\r\n        }\r\n\r\n        if (sortDirection === SortDirection.decrease) {\r\n            if (aScore.score > bScore.score) return -1;\r\n            if (aScore.score < bScore.score) return 1;\r\n            if (aScore.solvedAt < bScore.solvedAt) return -1;\r\n            if (aScore.solvedAt > bScore.solvedAt) return 1;\r\n            return 0;\r\n        }\r\n\r\n        if (aScore.score < bScore.score) return -1;\r\n        if (aScore.score > bScore.score) return 1;\r\n        if (aScore.solvedAt > bScore.solvedAt) return -1;\r\n        if (aScore.solvedAt < bScore.solvedAt) return 1;\r\n        return 0;\r\n    }\r\n}\r\n\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport ScoreboardPage from './ScoreboardPage';\r\nimport Team from '../../models/Team';\r\nimport { ITotalScoreboard, ITotalScoreboardTeam } from '../../models/Scoreboard';\r\nimport { GENERAL } from '../../consts/strings';\r\nimport DateTime from '../DateTime';\r\nimport TournamentDto from '../../models/TournamentDto';\r\n\r\ninterface FullScoreboardProps {\r\n    team: Team | null;\r\n    scoreboard: ITotalScoreboard;\r\n}\r\n\r\ninterface FullScoreboardState {\r\n    sortBy: string | number;\r\n    openTournament: number | null;\r\n    currentTournament?: TournamentDto | null;\r\n}\r\n\r\nexport default class TotalScoreboard extends React.Component<FullScoreboardProps, FullScoreboardState> {\r\n    constructor(props: FullScoreboardProps) {\r\n        super(props);\r\n\r\n        const currentTournament = TotalScoreboard.getCurrentTournament(props.scoreboard.tournaments);\r\n\r\n        this.state = {\r\n            sortBy: GENERAL,\r\n            openTournament: currentTournament?.tournamentId || null,\r\n            currentTournament,\r\n        }\r\n    }\r\n\r\n    static getCurrentTournament(tournaments: TournamentDto[]) {\r\n        return tournaments.find(i => i.acceptSubmissions && i.runGames);\r\n    }\r\n\r\n    render() {\r\n        const { scoreboard, team } = this.props;\r\n        const { sortBy } = this.state;\r\n\r\n        const isFrozen = !!scoreboard.frozenAt && new Date(scoreboard.frozenAt) <= new Date();\r\n\r\n        const sortedArray = [...scoreboard.teams].sort(sortElements(sortBy));\r\n        return (\r\n            <>\r\n                <h2>Scoreboard{ team && ': ' + team.teamName } { isFrozen &&\r\n                <span className={ styles.frozenTitle }> (frozen at <DateTime dateStr={ scoreboard.frozenAt as string }/>)</span> }</h2>\r\n                { this.renderTopText() }\r\n                <table className={ styles.table }>\r\n                    { this.renderHead(sortedArray) }\r\n                    <tbody>\r\n                    { sortedArray.map(this.renderRow) }\r\n                    </tbody>\r\n                </table>\r\n            </>\r\n        )\r\n    }\r\n\r\n    renderTopText() {\r\n        const { currentTournament } = this.state;\r\n\r\n        return (\r\n            <>\r\n                <p className={ styles.help }>Ratings are calculated\r\n                    using <a href='https://en.wikipedia.org/wiki/TrueSkill'\r\n                             target='_blank' rel=\"noopener noreferrer\">TrueSkill ranking system</a>.\r\n                    Read more about stages and scoring in <a\r\n                        href='https://message-from-space.readthedocs.io/en/latest/game.html#scoring'\r\n                        target='_blank' rel='noopener noreferrer'>our documentation</a>.\r\n                </p>\r\n                { currentTournament && <p className={ styles.help }>\r\n                    Current stage #{ currentTournament?.tournamentId } ends <DateTime\r\n                    dateStr={ currentTournament?.finishedAt || '' }/></p> }\r\n            </>\r\n        )\r\n    }\r\n\r\n    renderHead(teamsOrder: ITotalScoreboardTeam[]) {\r\n        const { scoreboard, team } = this.props;\r\n        const { sortBy, openTournament } = this.state;\r\n\r\n        const { tournaments } = scoreboard;\r\n        const pastAndCurrentTournaments = tournaments.filter(isPastOrCurrentTournament);\r\n        const buttonClass = `${ styles.sortButton } ${ sortBy === GENERAL ? styles.sortDown : '' }`\r\n\r\n        const openTournamentFull = tournaments.find(i => i.tournamentId === openTournament);\r\n        return (\r\n            <thead>\r\n            <tr>\r\n                <th style={ { width: 40 } } rowSpan={ 3 }>#</th>\r\n                <th rowSpan={ 3 } className={ styles.alignLeft }>Team Name</th>\r\n                <th rowSpan={ 3 } className={ styles.alignLeft }>Platform</th>\r\n                <th colSpan={ pastAndCurrentTournaments.length + (openTournamentFull ? 3 : 0) }>Stages</th>\r\n                <th style={ { width: 70 } } className={ styles.score } rowSpan={ 3 }>\r\n                    <button onClick={ this.changeSorted(GENERAL) }\r\n                            className={ buttonClass }>\r\n                        Total Score\r\n                    </button>\r\n                </th>\r\n            </tr>\r\n\r\n            <tr>\r\n                { pastAndCurrentTournaments.map(this.renderTournamentHeadCell) }\r\n            </tr>\r\n            <tr>\r\n                { openTournamentFull && this.renderOpenTournamentHeadCell(openTournamentFull) }\r\n            </tr>\r\n            { teamsOrder && teamsOrder\r\n                .map((team, i) => ({ team, i }))\r\n                .filter(tuple => tuple.team.team.teamId === team?.teamId && tuple.i > 5)\r\n                .map(tuple => this.renderRow(tuple.team, tuple.i))\r\n            }\r\n            </thead>\r\n        )\r\n    }\r\n\r\n    renderTournamentHeadCell = (t: TournamentDto) => {\r\n        const { sortBy, openTournament } = this.state;\r\n        const buttonClass = `${ styles.sortButton } ${ sortBy === t.tournamentId ? styles.sortDown : '' }`\r\n        const isOpen = openTournament === t.tournamentId;\r\n\r\n        const button = (\r\n            <button onClick={ this.changeSorted(t.tournamentId) }\r\n                    className={ buttonClass }>\r\n                { t.tournamentId }\r\n            </button>\r\n        )\r\n\r\n        const openClass = `${ styles.smallRow }`\r\n        return (\r\n            <td key={ t.tournamentId }\r\n                rowSpan={ isOpen ? 1 : 2 }\r\n                colSpan={ isOpen ? 4 : 1 }\r\n                className={ isOpen ? openClass : styles.alignRight }\r\n                title={ t.startedAt ? `Started at ${ ScoreboardPage.createDate(t.startedAt) }` : undefined }>\r\n                { isOpen ? t.tournamentId : button }\r\n            </td>\r\n        )\r\n\r\n    }\r\n    renderOpenTournamentHeadCell = (t: TournamentDto) => {\r\n        const { sortBy } = this.state;\r\n        const buttonClass = `${ styles.sortButton } ${ sortBy === t.tournamentId ? styles.sortDown : '' }`\r\n        const openClass = `${ styles.alignRight } ${ styles.details }`\r\n        const buttonOpenClass = `${ styles.alignRight } ${ styles.details } ${ styles.sortDetails }`;\r\n\r\n        return [\r\n            <td key={ 'rating' } className={ openClass }>Rating</td>,\r\n            <td key={ 'mu' } className={ openClass }>μ</td>,\r\n            <td key={ 'sigma' } className={ openClass }>σ</td>,\r\n\r\n            <td key={ t.tournamentId }\r\n                className={ buttonOpenClass }\r\n                title={ t.startedAt ? `Started at ${ ScoreboardPage.createDate(t.startedAt) }` : undefined }>\r\n                <button onClick={ this.changeSorted(t.tournamentId) }\r\n                        className={ buttonClass }>\r\n                    { 'Score' }\r\n                </button>\r\n            </td>,\r\n        ]\r\n    }\r\n\r\n    renderRow = (scoreboardTeam: ITotalScoreboardTeam, index: number) => {\r\n        const { scoreboard } = this.props;\r\n        const { currentTournament } = this.state;\r\n        const currentTeam = this.props.team;\r\n        const teamInfo = scoreboardTeam.team\r\n\r\n        const currentTournamentId = currentTournament?.tournamentId;\r\n        return (\r\n            <tr key={ scoreboardTeam.team.teamId }\r\n                className={ currentTeam?.teamId === teamInfo.teamId ? styles.activeTeam : '' }>\r\n                <td className={ styles.alignRight }>{ index + 1 }</td>\r\n                { ScoreboardPage.renderTeamName(teamInfo, index + 1) }\r\n                <td>{ currentTournamentId && scoreboardTeam.tournaments[currentTournamentId]?.submission.platform }</td>\r\n                { scoreboard.tournaments\r\n                    .filter(isPastOrCurrentTournament)\r\n                    .map(t => this.renderTournamentCell(t, scoreboardTeam)) }\r\n                <td className={ styles.score }>{ scoreboardTeam.score }</td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderTournamentCell = (t: TournamentDto, scoreboardTeam: ITotalScoreboardTeam) => {\r\n        const { openTournament } = this.state;\r\n        const isOpen = openTournament === t.tournamentId;\r\n\r\n        const hasItem = t.tournamentId in scoreboardTeam.tournaments;\r\n\r\n        const openClass = `${ styles.alignRight } ${ styles.details }`;\r\n        const buttonOpenClass = `${ styles.alignRight } ${ styles.details } ${ styles.sortDetails }`;\r\n\r\n        return [\r\n            isOpen && (<td key={ 'rating' } className={ openClass }>\r\n                { hasItem && scoreboardTeam.tournaments[t.tournamentId].rating.conservativeRating.toFixed(2) }\r\n            </td>),\r\n            isOpen && (<td key={ 'mu' } className={ openClass }>\r\n                { hasItem && scoreboardTeam.tournaments[t.tournamentId].rating.mu.toFixed(2) }\r\n            </td>),\r\n            isOpen && (<td key={ 'sigma' } className={ openClass }>\r\n                { hasItem && scoreboardTeam.tournaments[t.tournamentId].rating.sigma.toFixed(2) }\r\n            </td>),\r\n\r\n            <td key={ t.tournamentId } className={ isOpen ? buttonOpenClass : styles.alignRight }>{ hasItem\r\n                ? scoreboardTeam.tournaments[t.tournamentId].score\r\n                : <span className={ styles.lighten }>—</span>\r\n            }</td>\r\n        ];\r\n    }\r\n\r\n    changeSorted = (sortBy: string | number) => () => {\r\n        if (sortBy === this.state.sortBy) {\r\n            return;\r\n        }\r\n        this.setState({ sortBy, openTournament: typeof sortBy === 'string' ? this.state.openTournament : sortBy })\r\n    }\r\n}\r\n\r\nfunction isPastOrCurrentTournament(t: TournamentDto) {\r\n    if (t.acceptSubmissions && t.runGames) {\r\n        return true;\r\n    }\r\n    if (!t.acceptSubmissions) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\nfunction sortElements(sortBy: string | number) {\r\n    return (a: ITotalScoreboardTeam, b: ITotalScoreboardTeam) => {\r\n        const aProblem = sortBy === GENERAL ? a.score : a.tournaments[sortBy];\r\n        const bProblem = sortBy === GENERAL ? b.score : b.tournaments[sortBy];\r\n\r\n        if (!aProblem && !bProblem) return 0;\r\n        if (!aProblem && bProblem) return 1;\r\n        if (aProblem && !bProblem) return -1;\r\n\r\n        let aScore = typeof aProblem === 'number' ? aProblem : aProblem.rating.conservativeRating || 0;\r\n        let bScore = typeof bProblem === 'number' ? bProblem : bProblem.rating.conservativeRating || 0;\r\n\r\n        if (aScore > bScore) return -1;\r\n        if (aScore < bScore) return 1;\r\n        return 0;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport './flag-icons.css';\r\nimport Team from '../../models/Team';\r\nimport { ITotalScoreboard, ILightningScoreboard, IFinalScoreboard } from '../../models/Scoreboard';\r\nimport countriesJson from '../../consts/countries.json';\r\nimport ICountry from '../../models/Country';\r\nimport { formatter } from \"../DateTime/DateTime\";\r\nimport { scoreboardTabs } from '../../consts/routes';\r\nimport Tabs from '../Tabs';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport TeamDto from '../../models/TeamDto';\r\nimport LightningScoreboard from './LightningScoreboard';\r\nimport TotalScoreboard from './TotalScoreboard';\r\nimport FinalScoreboard from './FinalScoreboard';\r\n\r\ninterface ScoreboardPageProps {\r\n    team: Team | null;\r\n    location: RouteComponentProps['location'];\r\n    lightningScoreboard: ILightningScoreboard | null;\r\n    totalScoreboard: ITotalScoreboard | null;\r\n    finalScoreboard: IFinalScoreboard | null;\r\n    loadProblemScoreboard: () => void;\r\n    loadTotalScoreboard: () => void;\r\n    loadFinalScoreboard: () => void;\r\n}\r\n\r\nexport enum SortDirection {\r\n    increase = 'increase',\r\n    decrease = 'decrease',\r\n}\r\n\r\nconst tabs = [\r\n    { text: 'Lightning', hash: scoreboardTabs.lightning },\r\n    { text: 'Full Round', hash: scoreboardTabs.full },\r\n    { text: 'Pre-Final', hash: scoreboardTabs.final },\r\n]\r\n\r\n\r\nconst countries = countriesJson as ICountry[];\r\n\r\nexport default class ScoreboardPage extends React.Component<ScoreboardPageProps> {\r\n    componentDidMount() {\r\n        this.props.loadProblemScoreboard();\r\n        this.props.loadTotalScoreboard();\r\n        this.props.loadFinalScoreboard();\r\n    }\r\n\r\n    render() {\r\n        const { location, totalScoreboard, lightningScoreboard, finalScoreboard } = this.props;\r\n        const hash = location.hash;\r\n        return (\r\n            <div>\r\n                <Tabs tabs={ tabs } location={ location }/>\r\n                { hash === scoreboardTabs.lightning && lightningScoreboard &&\r\n                <LightningScoreboard team={ this.props.team } scoreboard={ lightningScoreboard }/> }\r\n                { (!hash || hash === scoreboardTabs.full) && totalScoreboard &&\r\n                <TotalScoreboard team={ this.props.team } scoreboard={ totalScoreboard }/> }\r\n                { hash === scoreboardTabs.final && finalScoreboard &&\r\n                <FinalScoreboard team={ this.props.team } scoreboard={ finalScoreboard }/> }\r\n            </div>\r\n        )\r\n    }\r\n\r\n    static renderTeamName(team: TeamDto, index: number = -1) {\r\n        const itemCountry = team.customData.country;\r\n        const country = countries.find(c => c.value === itemCountry);\r\n        const name = team.teamName === 'The Cat is #1!!' && index !== -1 ? 'The Cat is #1!!'.replace('1', `${ index }`) : team.teamName\r\n        return (\r\n            <td><span\r\n                className={ `flag-icons ${ country?.shortValue }` }\r\n                title={ country?.text }\r\n            />&nbsp;{ name }</td>\r\n        )\r\n    }\r\n\r\n\r\n    static createDate(dateStr: string) {\r\n        const date = new Date(dateStr);\r\n        return formatter.format(date);\r\n    }\r\n\r\n}\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport ScoreboardPage from './ScoreboardPage';\r\nimport Team from '../../models/Team';\r\nimport {\r\n    IFinalScoreboard, IFinalScoreboardTeam,\r\n} from '../../models/Scoreboard';\r\n\r\n\r\ninterface FinalScoreboardProps {\r\n    team: Team | null;\r\n    scoreboard: IFinalScoreboard;\r\n}\r\n\r\nexport default class FinalScoreboard extends React.Component<FinalScoreboardProps> {\r\n    render() {\r\n        const { scoreboard, team } = this.props;\r\n\r\n        return (\r\n            <>\r\n                <h2>Scoreboard{ team && ': ' + team.teamName }</h2>\r\n                <table className={ styles.table }>\r\n                    { this.renderHead() }\r\n                    <tbody>\r\n                    { scoreboard.teams && scoreboard.teams.map(this.renderRow) }\r\n                    </tbody>\r\n                </table>\r\n            </>\r\n        )\r\n    }\r\n\r\n    renderHead() {\r\n        const { scoreboard, team } = this.props;\r\n\r\n        return (\r\n            <thead>\r\n\r\n            <tr>\r\n                <th style={ { width: 40 } }>#</th>\r\n                <th className={ styles.alignLeft }>Team Name</th>\r\n                <th>Platform</th>\r\n                <th style={ { width: 70 } }\r\n                    className={ styles.score }>\r\n                    Score\r\n                </th>\r\n            </tr>\r\n            { scoreboard.teams && scoreboard.teams\r\n                .map((team, i) => ({ team, i }))\r\n                .filter(tuple => tuple.team.team.teamId === team?.teamId && tuple.i > 5)\r\n                .map(tuple => this.renderRow(tuple.team, tuple.i))\r\n            }\r\n            </thead>\r\n        )\r\n    }\r\n\r\n    renderRow = (scoreboardTeam: IFinalScoreboardTeam, index: number) => {\r\n        const { team } = this.props;\r\n\r\n        const teamInfo = scoreboardTeam.team;\r\n        return (\r\n            <tr key={ index } className={ team?.teamId === teamInfo.teamId ? styles.activeTeam : '' }>\r\n                <td className={ styles.alignCenter }>{ index < 20 ? '?' : index + 1 }</td>\r\n                { ScoreboardPage.renderTeamName(teamInfo) }\r\n                <td>{ scoreboardTeam.submission.platform }</td>\r\n                <td className={ styles.score }>{ typeof scoreboardTeam.score === 'number' ? scoreboardTeam.score : '?' }</td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n}\r\n","import ScoreboardPage from './ScoreboardPage';\r\nexport default ScoreboardPage;\r\n","import { LOAD_FINAL_SCOREBOARD, LOAD_PROBLEM_SCOREBOARD, LOAD_TOTAL_SCOREBOARD } from '../consts/actions';\r\nimport IScoreboardAction from '../models/actions/scoreboard';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport { Dispatch } from 'redux';\r\nimport { createSetErrorAction } from './app';\r\nimport { sendGetRequest } from '../utils/sendRequest';\r\nimport { finalScoreboard, problemsScoreboard, scoreboard } from '../consts/api';\r\nimport {\r\n    ILightningScoreboard,\r\n    ITotalScoreboard\r\n} from '../models/Scoreboard';\r\n\r\nconst createLoadLightningScoreboardAction = (scoreboard: ILightningScoreboard) => ({\r\n    type: LOAD_PROBLEM_SCOREBOARD,\r\n    payload: scoreboard,\r\n})\r\n\r\nconst createLoadTotalScoreboardAction = (scoreboard: ITotalScoreboard) => ({\r\n    type: LOAD_TOTAL_SCOREBOARD,\r\n    payload: scoreboard,\r\n})\r\n\r\nconst createLoadFinalScoreboardAction = (scoreboard: ITotalScoreboard) => ({\r\n    type: LOAD_FINAL_SCOREBOARD,\r\n    payload: scoreboard,\r\n})\r\n\r\n\r\nexport function loadLightningScoreboard():\r\n    ThunkAction<Promise<any>, IStore, unknown, IScoreboardAction> {\r\n    return async (dispatch: Dispatch) => {\r\n        try {\r\n            const result: ILightningScoreboard = await sendGetRequest(problemsScoreboard)\r\n            \r\n            dispatch(createLoadLightningScoreboardAction(result))\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function loadTotalScoreboard():\r\n    ThunkAction<Promise<any>, IStore, unknown, IScoreboardAction> {\r\n    return async (dispatch: Dispatch) => {\r\n        try {\r\n            const result: ITotalScoreboard = await sendGetRequest(scoreboard)\r\n\r\n            dispatch(createLoadTotalScoreboardAction(result))\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function loadFinalScoreboard():\r\n    ThunkAction<Promise<any>, IStore, unknown, IScoreboardAction> {\r\n    return async (dispatch: Dispatch) => {\r\n        try {\r\n            const result: ITotalScoreboard = await sendGetRequest(finalScoreboard)\r\n\r\n            dispatch(createLoadFinalScoreboardAction(result))\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\n","import { connect } from 'react-redux';\r\nimport ScoreboardPage from '../components/ScoreboardPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { loadFinalScoreboard, loadLightningScoreboard, loadTotalScoreboard } from '../actions/scoreboard';\r\n\r\nconst mapState = (store: IStore) => {\r\n    return {\r\n        team: store.team.team,\r\n        lightningScoreboard: store.scoreboard.lightningScoreboard,\r\n        totalScoreboard: store.scoreboard.totalScoreboard,\r\n        finalScoreboard: store.scoreboard.finalScoreboard,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        loadProblemScoreboard: () => dispatch(loadLightningScoreboard()),\r\n        loadTotalScoreboard: () => dispatch(loadTotalScoreboard()),\r\n        loadFinalScoreboard: () => dispatch(loadFinalScoreboard()),\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(ScoreboardPage);\r\n","import BlogPost from './BlogPost';\r\nexport default BlogPost;\r\n","import React from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport styles from './styles.module.css';\r\nimport { Link } from 'react-router-dom';\r\nimport { ROUTES } from '../../consts/routes';\r\n\r\ntype BlogPostProps = {\r\n    id: number,\r\n    title: string,\r\n    date: string,\r\n    author: string,\r\n    text: string,\r\n    isInList: boolean\r\n}\r\n\r\nexport default function BlogPost(props: BlogPostProps) {\r\n    const { title, date, author, text, isInList, id } = props;\r\n    const intl = new Intl.DateTimeFormat('en-GB', {\r\n        timeZoneName: 'short',\r\n        hour: 'numeric',\r\n        minute: '2-digit',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        year: 'numeric',\r\n    })\r\n\r\n\r\n    return (\r\n        <article className={ styles.root + ' container' }>\r\n            <header className={ styles.header }>\r\n                { renderTitle(isInList, title, id) }\r\n                <div className={ styles.subtitle }>\r\n                    <time>{ intl.format(new Date(date)) }</time>\r\n                    , by { author }\r\n                </div>\r\n            </header>\r\n            <ReactMarkdown linkTarget='_blank' escapeHtml={false} source={ text }/>\r\n        </article>\r\n    )\r\n}\r\n\r\nfunction renderTitle(isInList: boolean, titleText: string, id: number) {\r\n    if (!isInList) {\r\n        return <h2 className={ styles.title }>{ titleText }</h2>\r\n    }\r\n\r\n    return <h3 className={ styles.title }><Link to={ `${ ROUTES.post }/${ id }` }>{ titleText }</Link></h3>\r\n}\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport IBlogPost from '../../models/IBlogPost';\r\nimport BlogPost from '../BlogPost';\r\n\r\ninterface BlogListProps {\r\n    posts: IBlogPost[];\r\n}\r\n\r\nexport default function BlogList(props: BlogListProps) {\r\n    return (\r\n        <main className={styles.root}>\r\n            { props.posts.map(item =>\r\n                <div className={ styles.listItem } key={ item.id }>\r\n                    <BlogPost { ...item } isInList/>\r\n                </div>\r\n            ) }\r\n        </main>\r\n    )\r\n}\r\n","import React from 'react';\r\nimport { blogTabs } from '../../consts/routes';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport Tabs from '../Tabs';\r\nimport BlogList from './BlogList';\r\nimport astronomerPosts from '../../astronomerPosts.json';\r\nimport orgsPosts from '../../orgsPosts.json';\r\n\r\ninterface BlogPageProps {\r\n    location: RouteComponentProps['location'];\r\n}\r\n\r\nconst tabs = [\r\n    { text: 'Contest Updates', hash: blogTabs.orgs },\r\n    { text: 'Pegovka', hash: blogTabs.pegovka },\r\n]\r\n\r\nexport default function BlogPage(props: BlogPageProps) {\r\n    const { location } = props;\r\n    const hash = location.hash;\r\n    return (\r\n        <div>\r\n            <Tabs tabs={ tabs } location={ location }/>\r\n            <BlogList posts={hash === blogTabs.pegovka ? astronomerPosts : orgsPosts} />\r\n        </div>\r\n    )\r\n}\r\n","import BlogPage from './BlogPage';\r\nexport default BlogPage;\r\n","import BlogPostPage from './BlogPostPage';\r\nexport default BlogPostPage;\r\n","import TeamDto from './TeamDto';\r\n\r\nexport default interface GameDto {\r\n    gameId: string;\r\n    tournamentId?: number;\r\n    tournamentRoundId?: number;\r\n    createdAt?: string;\r\n    finishedAt?: string;\r\n    ticks?: number;\r\n    attacker: PlayerDto;\r\n    defender: PlayerDto;\r\n    winner?: GameWinner;\r\n}\r\n\r\nexport interface PlayerDto {\r\n    submissionId: string;\r\n    team: TeamDto;\r\n    debugLog?: string;\r\n    playerKey?: string;\r\n    timeout?: boolean;\r\n}\r\n\r\nexport enum GameWinner {\r\n    Nobody = 'Nobody',\r\n    Attacker = 'Attacker',\r\n    Defender = 'Defender',\r\n}\r\n","import React from 'react';\r\nimport astronomerPosts from '../../astronomerPosts.json';\r\nimport orgsPosts from '../../orgsPosts.json';\r\nimport BlogPost from '../BlogPost';\r\nimport styles from './styles.module.css';\r\nimport { Link } from 'react-router-dom';\r\nimport { ROUTES } from '../../consts/routes';\r\n\r\ntype BlogPostPageProps = {\r\n    match: {\r\n        params: {\r\n            postId: string;\r\n        }\r\n    }\r\n}\r\n\r\nexport default function BlogPostPage(props: BlogPostPageProps) {\r\n    const { postId } = props.match.params;\r\n    const astronomerPostIndex = astronomerPosts.findIndex(elem => elem.id === parseInt(postId, 10));\r\n    const orgsPostIndex = orgsPosts.findIndex(elem => elem.id === parseInt(postId, 10));\r\n    \r\n    if (astronomerPostIndex === -1 && orgsPostIndex === -1) {\r\n        return (\r\n            <p>404: Post Not Found</p>\r\n        )\r\n    }\r\n    \r\n    const postIndex = astronomerPostIndex !== -1 ? astronomerPostIndex : orgsPostIndex;\r\n    const posts = astronomerPostIndex !== -1 ? astronomerPosts : orgsPosts;\r\n\r\n    const currentPost = posts[postIndex];\r\n    const nextPost = postIndex > 0 && posts[postIndex - 1];\r\n    const prevPost = postIndex < posts.length - 1 && posts[postIndex + 1];\r\n\r\n    return (\r\n        <div className={ styles.root }>\r\n            <BlogPost { ...currentPost } isInList={ false }/>\r\n            <footer className={ styles.footer + ' container' }>\r\n                <div className={ styles.footerItem }>\r\n                    { prevPost &&\r\n                    <>Prev: <Link to={ `${ ROUTES.post }/${ prevPost.id }` }>{ prevPost.title }</Link></>\r\n                    }\r\n                </div>\r\n                <div className={ styles.footerItem }>\r\n                    { nextPost &&\r\n                    <>Next: <Link to={ `${ ROUTES.post }/${ nextPost.id }` }>{ nextPost.title }</Link></>\r\n                    }\r\n                </div>\r\n            </footer>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\n","import TestingPage from './TestingPage';\r\nexport default TestingPage;\r\n","import React, { ChangeEvent } from 'react';\r\nimport styles from './styles.module.css';\r\nimport Submission, { SubmissionStatus } from '../../models/Submission';\r\nimport TeamSubmissionDto from '../../models/TeamSubmissionDto';\r\nimport Team from '../../models/Team';\r\nimport PlayIcon from '../PlayIcon';\r\nimport Toast from '../Toast';\r\nimport { Link } from 'react-router-dom';\r\nimport { gameTabs, ROUTES } from '../../consts/routes';\r\n\r\ninterface TestingPageProps {\r\n    team: Team | null;\r\n    submissions: Submission[] | null;\r\n    otherTeams: TeamSubmissionDto[] | null;\r\n    justStarted: boolean;\r\n    loadSubmissions: () => void;\r\n    loadOtherTeamSubmissions: () => void;\r\n    runNonRatingGame: (obj: { attacker: string, defender: string }) => void;\r\n}\r\n\r\ninterface TestingPageState {\r\n    attacker: string | null;\r\n    defender: string | null;\r\n}\r\n\r\nexport default class TestingPage extends React.Component<TestingPageProps, TestingPageState> {\r\n    state: TestingPageState = {\r\n        attacker: null,\r\n        defender: null,\r\n    }\r\n\r\n    componentDidMount() {\r\n        const { submissions, loadSubmissions, loadOtherTeamSubmissions } = this.props;\r\n        if (!submissions) {\r\n            loadSubmissions();\r\n        }\r\n        loadOtherTeamSubmissions();\r\n    }\r\n\r\n    render() {\r\n        const { justStarted } = this.props;\r\n        const { attacker, defender } = this.state;\r\n        return (\r\n            <div className={ styles.root }>\r\n                { this.renderUserSubmissions() }\r\n                { this.renderOtherTeamsSubmissions() }\r\n                { (attacker || defender) && <Toast message={ this.renderToastContent() }/> }\r\n                { (justStarted && !attacker && !defender) && <Toast message={ this.renderSuccessToastContent() }/> }\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderUserSubmissions() {\r\n        const { submissions } = this.props;\r\n        return (\r\n            <div>\r\n                <h3>Your submissions</h3>\r\n                <table className={ styles.table }>\r\n                    <thead>\r\n                    <tr>\r\n                        <th>Id</th>\r\n                        <th>Hash</th>\r\n                        <th>Commit message</th>\r\n                        <th>Choose</th>\r\n                    </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    { submissions?.filter(s => s.status === SubmissionStatus.Succeeded)\r\n                        .map(this.renderSubmissionRow) }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderSubmissionRow = (s: Submission) => {\r\n        return (\r\n            <tr key={ s.commitHash + s.createdAt }>\r\n                <td>{ s.submissionId }</td>\r\n                <td>{ s.commitHash?.substr(0, 6) }</td>\r\n                <td className={ styles.pre }>{ s.commitMessage }</td>\r\n                <td className={ styles.buttons }>\r\n                    { this.renderRunButton(s.submissionId, 'attacker') }\r\n                    { this.renderRunButton(s.submissionId, 'defender') }\r\n                </td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderOtherTeamsSubmissions() {\r\n        const { otherTeams } = this.props;\r\n        return (\r\n            <div>\r\n                <h3>Other</h3>\r\n                <table className={ styles.table }>\r\n                    <thead>\r\n                    <tr>\r\n                        <th>#</th>\r\n                        <th>Team name</th>\r\n                        <th>Choose</th>\r\n                    </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    { otherTeams?.map((s, i) => this.renderOtherTeamSubmissionRow(s, i, this.props.team)) }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderOtherTeamSubmissionRow(s: TeamSubmissionDto, index: number, team: Team | null) {\r\n        if (team && team.teamId === s.team.teamId) {\r\n            return null;\r\n        }\r\n        return (\r\n            <tr key={ s.team.teamId }>\r\n                <td>{ index + 1 }</td>\r\n                <td>{ s.team.teamName }</td>\r\n                <td className={ styles.buttons }>\r\n                    { this.renderRunButton(s.submissionId, 'attacker') }\r\n                    { this.renderRunButton(s.submissionId, 'defender') }\r\n                </td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderRunButton(id: string, role: 'attacker' | 'defender') {\r\n        const chosen = this.state[role];\r\n        const isChecked = id.toString() === chosen;\r\n        const iconColor = role === 'attacker' ? 'orange' : 'teal';\r\n        return (\r\n            <label className={ styles.chooseButton } title={ `play as ${ role }` }>\r\n                <input type=\"radio\"\r\n                       name={ role }\r\n                       value={ id }\r\n                       onChange={ role === 'attacker' ? this.chooseAttacker : this.chooseDefender }\r\n                       checked={ isChecked }\r\n                       className={ styles.radio }/>\r\n                <PlayIcon color={ (!chosen || isChecked) ? iconColor : 'grey' }/>\r\n            </label>\r\n        )\r\n    }\r\n\r\n    renderToastContent() {\r\n        const { attacker, defender } = this.state;\r\n        return (\r\n            <div>\r\n                { this.createToastText() }\r\n                <button className={ styles.toastButton } onClick={ this.clearSelection }>cancel</button>\r\n                { attacker && defender &&\r\n                <button className={ styles.toastButton } onClick={ this.runSelection }>run</button>\r\n                }\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderSuccessToastContent() {\r\n        return (\r\n            <div>\r\n                Non Rating game is running. It will be <Link to={ ROUTES.games + gameTabs.nonRating }>here</Link>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    chooseDefender = (evt: ChangeEvent<HTMLInputElement>) => {\r\n        const newValue = evt.target.value;\r\n        this.setState({ defender: newValue })\r\n    }\r\n\r\n    chooseAttacker = (evt: ChangeEvent<HTMLInputElement>) => {\r\n        const newValue = evt.target.value;\r\n        this.setState({ attacker: newValue })\r\n    }\r\n\r\n    createToastText() {\r\n        const { attacker, defender } = this.state;\r\n        let text = 'You choose ';\r\n\r\n        if (attacker) {\r\n            text += `${ this.createSubmissionText(attacker) } as attacker`;\r\n        }\r\n        if (attacker && defender) {\r\n            text += ' and ';\r\n        }\r\n\r\n        if (defender) {\r\n            text += `${ this.createSubmissionText(defender) } as defender`;\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    createSubmissionText(id: string) {\r\n        const { submissions, otherTeams } = this.props;\r\n\r\n        const inMyBots = submissions?.find(i => i.submissionId.toString() === id);\r\n        const inOtherBots = otherTeams?.find(i => i.submissionId.toString() === id);\r\n\r\n        if (inMyBots) {\r\n            return `your submission #${ id }`\r\n        }\r\n        if (inOtherBots) {\r\n            return `team ${ inOtherBots.team.teamName }#${ id } submission`\r\n        }\r\n        return `submission #${ id }`;\r\n    }\r\n\r\n    clearSelection = () => {\r\n        this.setState({\r\n            defender: null,\r\n            attacker: null,\r\n        })\r\n    }\r\n\r\n    runSelection = () => {\r\n        const { attacker, defender } = this.state;\r\n\r\n        if (!attacker || !defender) {\r\n            return;\r\n        }\r\n\r\n        this.props.runNonRatingGame({ attacker, defender });\r\n        this.setState({ attacker: null, defender: null })\r\n    }\r\n}\r\n","import { connect } from 'react-redux';\r\nimport TestingPage from '../components/TestingPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { loadOtherTeamSubmissions, loadSubmissions, runNonRatingGame } from '../actions/submissions';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\n\r\n\r\nconst mapState = (store: IStore) => {\r\n    return {\r\n        team: store.team.team,\r\n        submissions: store.submissions.submissions,\r\n        otherTeams: store.submissions.otherTeamSubmissions,\r\n        justStarted: store.submissions.justStarted,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        loadSubmissions: () => dispatch(loadSubmissions()),\r\n        loadOtherTeamSubmissions: () => dispatch(loadOtherTeamSubmissions()),\r\n        runNonRatingGame: (obj:{attacker: string, defender: string}) => dispatch(runNonRatingGame(createEmptyAction(obj)))\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(TestingPage);\r\n","import React from 'react';\r\nimport styles from './styles.module.css';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport { gameTabs, ROUTES } from '../../consts/routes';\r\nimport Tabs from '../Tabs';\r\nimport GameDto, { GameWinner } from '../../models/GameDto';\r\nimport Team from '../../models/Team';\r\nimport { logs } from '../../consts/api';\r\nimport createQueryString from '../../utils/createQueryString';\r\nimport DateTime from '../DateTime';\r\n\r\ninterface GamesPageProps {\r\n    team: Team | null;\r\n    location: RouteComponentProps['location'];\r\n    ratingGames?: GameDto[] | null;\r\n    nonRatingGames?: GameDto[] | null;\r\n    loadRatingGames: () => void;\r\n    loadNonRatingGames: () => void;\r\n}\r\n\r\nconst tabs = [\r\n    { text: 'Rating', hash: gameTabs.rating },\r\n    { text: 'Non-Rating', hash: gameTabs.nonRating },\r\n];\r\n\r\nenum roles {\r\n    attacker = 'attacker',\r\n    defender = 'defender',\r\n}\r\n\r\nenum result {\r\n    inProgress = 'In progress',\r\n    win = 'Win',\r\n    lose = 'Lose',\r\n    draw = 'Draw',\r\n}\r\n\r\nexport default class GamesPage extends React.Component<GamesPageProps> {\r\n    componentDidMount() {\r\n        if (!this.props.ratingGames) {\r\n            this.props.loadRatingGames();\r\n        }\r\n        if (!this.props.nonRatingGames) {\r\n            this.props.loadNonRatingGames();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const hash = this.props.location.hash;\r\n        return (\r\n            <div>\r\n                <Tabs tabs={ tabs } location={ this.props.location }/>\r\n                { (!hash || hash === gameTabs.rating) && this.renderRatingGames() }\r\n                { hash === gameTabs.nonRating && this.renderNonRatingGames() }\r\n            </div>\r\n        )\r\n    }\r\n\r\n    renderRatingGames() {\r\n        const { ratingGames } = this.props;\r\n        return (\r\n            <table className={ styles.table }>\r\n                { this.renderTableHeader() }\r\n                <tbody>\r\n                { ratingGames && ratingGames.map(i => this.renderRow(i)) }\r\n                </tbody>\r\n            </table>\r\n        )\r\n    }\r\n\r\n\r\n    renderNonRatingGames() {\r\n        const { nonRatingGames } = this.props;\r\n        return (\r\n            <table className={ styles.table }>\r\n                { this.renderTableHeader() }\r\n                <tbody>\r\n                { nonRatingGames && nonRatingGames.map(i => this.renderRow(i, true)) }\r\n                </tbody>\r\n            </table>\r\n        )\r\n    }\r\n\r\n    renderTableHeader() {\r\n        return (\r\n            <thead>\r\n            <tr>\r\n                <th>Result</th>\r\n                <th>Attacker</th>\r\n                <th>Defender</th>\r\n                <th>Logs</th>\r\n                <th>Viz</th>\r\n                <th>Stats</th>\r\n            </tr>\r\n            </thead>\r\n        )\r\n    }\r\n\r\n    renderRow = (item: GameDto, nonRating = false) => {\r\n        const { team } = this.props;\r\n        const gameStatus = this.calcGameResult(item);\r\n\r\n        return (\r\n            <tr key={ item.gameId }>\r\n                <td className={ gameStatus ? styles[gameStatus] : undefined } style={ { whiteSpace: \"nowrap\" } }>{ gameStatus }</td>\r\n                <td>{ item.attacker.team.teamName }\r\n                    { nonRating && team?.teamId === item.attacker.team.teamId\r\n                        ? ' #' + item.attacker.submissionId :\r\n                        ''\r\n                    }</td>\r\n                <td>{ item.defender.team.teamName }\r\n                    { nonRating && team?.teamId === item.defender.team.teamId\r\n                        ? ' #' + item.defender.submissionId\r\n                        : '' }</td>\r\n                <td>{ gameStatus === result.inProgress ? null : this.renderLogLinks(item) }</td>\r\n                <td>{ gameStatus !== result.inProgress && item.ticks !== undefined && item.ticks >= 0 &&\r\n                <a href={ `/#${ROUTES.visualize}?game=${ item.gameId }` }\r\n                   rel=\"noopener noreferrer\"\r\n                   target='_blank'>Watch</a> }</td>\r\n                <td>{ this.renderStats(item) }</td>\r\n            </tr>\r\n        )\r\n    }\r\n\r\n    renderLogLinks(game: GameDto) {\r\n        const { team } = this.props;\r\n        return (\r\n            <>\r\n                { game.attacker.debugLog &&\r\n                <div>\r\n                    <a href={ `${ logs }?${ createQueryString({\r\n                        logKey: game.attacker.debugLog,\r\n                        apiKey: team?.apiKey\r\n                    }) }` }\r\n                       rel=\"noopener noreferrer\" target=\"_blank\">\r\n                        attacker debug log</a>\r\n                </div>\r\n                }\r\n                { game.defender.debugLog &&\r\n                <div>\r\n                    <a href={ `${ logs }?${ createQueryString({\r\n                        logKey: game.defender.debugLog,\r\n                        apiKey: team?.apiKey\r\n                    }) }` }\r\n                       rel=\"noopener noreferrer\" target=\"_blank\">\r\n                        defender debug log</a>\r\n                </div>\r\n                }\r\n            </>\r\n\r\n        )\r\n    }\r\n\r\n    renderStats(game: GameDto) {\r\n        return (\r\n            <>\r\n                { game.createdAt && <div style={ { whiteSpace: \"nowrap\" } }>Start: <DateTime dateStr={ game.createdAt }/></div> }\r\n                { game.finishedAt && <div style={ { whiteSpace: \"nowrap\" } }>Finish: <DateTime dateStr={ game.finishedAt }/></div> }\r\n                { !!game.ticks && <div style={ { whiteSpace: \"nowrap\" } }>Duration: { game.ticks || 0 } { game.ticks !== 1 ? 'ticks' : 'tick' }</div> }\r\n                { game.defender.timeout && <div style={ { whiteSpace: \"nowrap\" } }>Defender timeout</div> }\r\n                { game.attacker.timeout && <div style={ { whiteSpace: \"nowrap\" } }>Attacker timeout</div> }\r\n            </>\r\n        )\r\n    }\r\n\r\n    calcGameResult(game: GameDto) {\r\n        const { team } = this.props;\r\n        if (!team) {\r\n            return null;\r\n        }\r\n\r\n        if (!game.winner) {\r\n            return result.inProgress;\r\n        }\r\n\r\n        if (game.winner === GameWinner.Nobody) {\r\n            return result.draw;\r\n        }\r\n\r\n        let role = null;\r\n\r\n        if (game.attacker.team.teamId === team.teamId) {\r\n            role = roles.attacker;\r\n        }\r\n        if (game.defender.team.teamId === team.teamId) {\r\n            role = roles.defender;\r\n        }\r\n\r\n        if (!role || game.attacker.team.teamId === game.defender.team.teamId) {\r\n            return game.winner + ' wins';\r\n        }\r\n\r\n        if (game.winner.toLowerCase() === role) {\r\n            return result.win;\r\n        }\r\n\r\n        return result.lose;\r\n    }\r\n}\r\n","import GamesPage from './GamesPage';\r\nexport default GamesPage;\r\n","import { LOAD_NON_RATING_GAMES, LOAD_RATING_GAMES } from '../consts/actions';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport IAppAction from '../models/actions/app';\r\nimport { Dispatch } from 'redux';\r\nimport GamesListDto from '../models/GamesListDto';\r\nimport { currentTournament, games, nonRatingGames } from '../consts/api';\r\nimport createQueryString from '../utils/createQueryString';\r\nimport { sendGetRequest } from '../utils/sendRequest';\r\nimport { createSetErrorAction } from './app';\r\nimport TournamentDto from '../models/TournamentDto';\r\nimport { createLoadCurrentTournamentAction } from './tournament';\r\n\r\nexport const createLoadRatingGamesAction = (games: GamesListDto) => ({\r\n    type: LOAD_RATING_GAMES,\r\n    payload: games,\r\n})\r\n\r\nexport const createLoadNonRatingGamesAction = (games: GamesListDto) => ({\r\n    type: LOAD_NON_RATING_GAMES,\r\n    payload: games,\r\n})\r\n\r\nexport function loadRatingGames():\r\n    ThunkAction<Promise<any>, IStore, unknown, IAppAction>  {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const tournament = store.tournament.current\r\n\r\n        try {\r\n            let tournamentId;\r\n\r\n            if (!tournament) {\r\n                const result: TournamentDto = await sendGetRequest(currentTournament);\r\n                dispatch(createLoadCurrentTournamentAction(result));\r\n                tournamentId = result.tournamentId;\r\n            } else {\r\n                tournamentId = tournament.tournamentId;\r\n            }\r\n\r\n            const requestUrl = `${ games }?${ createQueryString({ apiKey, tournamentId }) }`\r\n            const result = await sendGetRequest(requestUrl);\r\n            dispatch(createLoadRatingGamesAction(result));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n\r\nexport function loadNonRatingGames():\r\n    ThunkAction<Promise<any>, IStore, unknown, IAppAction>  {\r\n    return async (dispatch: Dispatch, getState: () => IStore) => {\r\n        const store = getState();\r\n        const apiKey = store.team.apiKey;\r\n        const tournament = store.tournament.current\r\n\r\n        try {\r\n            let tournamentId;\r\n\r\n            if (!tournament) {\r\n                const result: TournamentDto = await sendGetRequest(currentTournament);\r\n                dispatch(createLoadCurrentTournamentAction(result));\r\n                tournamentId = result.tournamentId;\r\n            } else {\r\n                tournamentId = tournament.tournamentId;\r\n            }\r\n\r\n            const requestUrl = `${ nonRatingGames }?${ createQueryString({ apiKey, tournamentId }) }`\r\n            const result = await sendGetRequest(requestUrl);\r\n            dispatch(createLoadNonRatingGamesAction(result));\r\n        } catch (e) {\r\n            dispatch(createSetErrorAction(e))\r\n        }\r\n    }\r\n}\r\n","import { connect } from 'react-redux';\r\nimport GamesPage from '../components/GamesPage';\r\nimport IStore from '../models/store';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport { AnyAction } from 'redux';\r\nimport { loadNonRatingGames, loadRatingGames } from '../actions/games';\r\n\r\nconst mapState = (state: IStore) => {\r\n    return {\r\n        team: state.team.team,\r\n        ratingGames: state.games.rating?.games,\r\n        nonRatingGames: state.games.nonRating?.games,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        loadRatingGames: () => dispatch(loadRatingGames()),\r\n        loadNonRatingGames: () => dispatch(loadNonRatingGames())\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapState, mapDispatch)(GamesPage);\r\n","import React, { ReactComponentElement } from 'react';\r\nimport { Route, Switch, Redirect } from 'react-router-dom';\r\nimport LandingPage from '../Landing/LandingPage';\r\nimport { ROUTES } from '../../consts/routes';\r\nimport RulesPage from '../RulesPage';\r\nimport RegistrationPage from '../../containers/Registration';\r\nimport LoginPage from '../../containers/Login';\r\nimport Team from '../../models/Team';\r\nimport TeamInfoPage from '../../containers/TeamInfo';\r\nimport SubmissionsPage from '../../containers/Submissions';\r\nimport ScoreboardPage from '../../containers/Scoreboard';\r\nimport BlogPage from '../BlogPage';\r\nimport BlogPostPage from '../BlogPostPage';\r\nimport TestingPage from '../../containers/Testing';\r\nimport GamesPage from '../../containers/Games';\r\n\r\ntype AppRouterProps = {\r\n    team: Team | null;\r\n    isTeamLoading: boolean;\r\n}\r\n\r\nexport default function AppRouter(props: AppRouterProps) {\r\n    const { team, isTeamLoading } = props;\r\n    return (\r\n        <Switch>\r\n            <Route exact path='/' component={ LandingPage }/>\r\n            <Route path={ ROUTES.rules } component={ RulesPage }/>\r\n            <Route path={ ROUTES.registration } children={ () => {\r\n                const component = <RegistrationPage/>;\r\n                return forUnauthorized(team, component)\r\n            } }/>\r\n            <Route path={ ROUTES.login } children={ () => {\r\n                const component = <LoginPage/>;\r\n                return forUnauthorized(team, component)\r\n            } }/>\r\n            <Route path={ ROUTES.teamInfo } children={ () => {\r\n                const component = <TeamInfoPage/>;\r\n                return forAuthorized(team, isTeamLoading, component);\r\n            } }/>\r\n            <Route path={ ROUTES.submissions } children={ () => {\r\n                const component = <SubmissionsPage/>;\r\n                return forAuthorized(team, isTeamLoading, component);\r\n            } }/>\r\n            <Route path={ ROUTES.scoreboard } component={ ScoreboardPage }/>\r\n            <Route path={ ROUTES.blog } component={ BlogPage }/>\r\n            <Route path={ `${ROUTES.post}/:postId` } component={ BlogPostPage }/>\r\n            <Route path={ ROUTES.testing } children={ () => {\r\n                const component = <TestingPage/>;\r\n                return forAuthorized(team, isTeamLoading, component);\r\n            } }/>\r\n\r\n            <Route path={ ROUTES.games } children={ ({ location }) => {\r\n                const component = <GamesPage location={ location }/>;\r\n                return forAuthorized(team, isTeamLoading, component);\r\n            } }/>\r\n\r\n            <Route path={ ROUTES.scoreboard } children={ ({ location }) =>\r\n                <ScoreboardPage location={ location }/>\r\n            }/>\r\n        </Switch>\r\n    )\r\n}\r\n\r\nfunction forUnauthorized(team: Team | null, component: ReactComponentElement<any>) {\r\n    if (team) {\r\n        return <Redirect to={ ROUTES.teamInfo }/>\r\n    }\r\n    return component;\r\n}\r\n\r\n\r\nfunction forAuthorized(team: Team | null, loading: boolean, component: ReactComponentElement<any>) {\r\n    if (!team && !loading) {\r\n        return <Redirect to={ ROUTES.login }/>\r\n    }\r\n\r\n    if (!team) {\r\n        return null;\r\n    }\r\n\r\n    return component;\r\n}\r\n","import {HubConnectionBuilder, LogLevel} from \"@microsoft/signalr\";\r\nimport {events} from \"../consts/api\";\r\nimport {uuid} from \"uuidv4\";\r\nimport createQueryString from './createQueryString';\r\n\r\nexport interface IListener {\r\n    close: () => void;\r\n    subscribe: (eventType: EventType) => void;\r\n    unsubscribe: (eventType: EventType) => void;\r\n}\r\n\r\nexport enum EventType {\r\n    Submission = 'Submission',\r\n    Scoreboard = 'Scoreboard',\r\n    LightningScoreboard = 'LightningScoreboard',\r\n    NonRatingGame = 'NonRatingGame',\r\n    Team = 'Team',\r\n}\r\n\r\nexport enum SubmissionChangeType {\r\n    Added = 'Added',\r\n    BuildStatusChanged = 'BuildStatusChanged',\r\n    Activated = 'Activated',\r\n    TestStatusChanged = 'TestStatusChanged',\r\n}\r\n\r\nexport enum NonRatingGameChangeType {\r\n    Added = 'Added',\r\n    Finished = 'Finished',\r\n}\r\n\r\nexport enum TeamChangeType {\r\n    Updated = 'Updated',\r\n    Activated = 'Activated',\r\n    Deactivated = 'Deactivated'\r\n}\r\n\r\nexport interface ISubmissionChangedEventData {\r\n    submissionId: number;\r\n    changeType: SubmissionChangeType;\r\n}\r\n\r\nexport interface INonRatingGameChangedEventData {\r\n    gameId: string;\r\n    changeType: NonRatingGameChangeType;\r\n}\r\n\r\nexport interface ITeamChangedEventData {\r\n    changeType: TeamChangeType;\r\n}\r\n\r\nexport interface IScoreboardChangedEventData {\r\n    tournamentId: number;\r\n}\r\n\r\nexport interface ILightningScoreboardChangedEventData {\r\n    problemId: string;\r\n    teamId: string;\r\n}\r\n\r\nexport default function listenEvents(apiKey: string, handler: (eventType: EventType, payload: any) => void): IListener {\r\n\r\n    let subscribedEventTypes: { [key: string]: boolean } = {};\r\n    let closed = false;\r\n    let connected = false;\r\n    const requestUrl = `${events}?${createQueryString({sticky: uuid(), apiKey: apiKey})}`\r\n\r\n    const connection = new HubConnectionBuilder()\r\n        .withUrl(requestUrl)\r\n        .withAutomaticReconnect()\r\n        .configureLogging(LogLevel.Information)\r\n        .build();\r\n\r\n    connection.onclose(async () => {\r\n        console.log(\"closed\");\r\n        connected = false;\r\n        if (!closed)\r\n            setTimeout(() => start(), 10000);\r\n    });\r\n\r\n    connection.on(\"onEvent\", (eventType, payload) => {\r\n        if (closed)\r\n            return;\r\n        console.log(eventType, payload);\r\n        handler(eventType, payload);\r\n    });\r\n\r\n    async function start() {\r\n        if (closed)\r\n            return;\r\n\r\n        try {\r\n            await connection.start();\r\n            connected = true;\r\n            console.log(\"connected\");\r\n        } catch (err) {\r\n            console.log(\"failed to start\", err);\r\n            setTimeout(() => start(), 10000);\r\n            return;\r\n        }\r\n\r\n        await updateSubscription();\r\n    }\r\n\r\n    async function stop() {\r\n        try {\r\n            await connection.stop();\r\n        } catch (err) {\r\n            console.log(\"failed to stop\", err);\r\n        }\r\n    }\r\n\r\n    async function updateSubscription() {\r\n        try {\r\n            let eventTypes = Object.entries(subscribedEventTypes).filter(x => x[1]).map(x => x[0]);\r\n            if (eventTypes.length)\r\n                await connection.send(\"subscribe\", eventTypes.join(\",\"));\r\n            else\r\n                await connection.send(\"subscribe\", 0);\r\n            console.log(\"subscribed\", eventTypes);\r\n        } catch (err) {\r\n            console.log(\"failed to subscribe\", err);\r\n            await stop();\r\n        }\r\n    }\r\n\r\n    start();\r\n\r\n    return {\r\n        close: function () {\r\n            closed = true;\r\n            stop();\r\n        },\r\n        subscribe: function (eventType: EventType) {\r\n            subscribedEventTypes[eventType] = true;\r\n            if (connected)\r\n                updateSubscription();\r\n        },\r\n        unsubscribe: async function (eventType: EventType) {\r\n            subscribedEventTypes[eventType] = false;\r\n            if (connected)\r\n                updateSubscription();\r\n        }\r\n    };\r\n}\r\n","export type ILogData = [0 | 1, ApiGameType, ApiGameStatus, number, number[][], any[]];\r\n\r\nexport interface IGameLogs {\r\n    isSucceeded: 0 | 1;\r\n    gameType: ApiGameType;\r\n    gameStatus: ApiGameStatus;\r\n    ticks: number;\r\n    players: IPlayer[];\r\n    gameLog?: ApiGameLog\r\n}\r\n\r\nexport enum ApiGameType {\r\n    AttackDefense = 0,\r\n    Tutorial_Fly = 1,\r\n    Tutorial_Detonate = 2,\r\n    Tutorial_Burn = 3,\r\n    Tutorial_BurnWithOverheat = 4,\r\n    Tutorial_Radiators = 5,\r\n    Tutorial_ShootOne = 6,\r\n    Tutorial_ShootZeroTempTarget = 7,\r\n    Tutorial_ShootAttackers = 8,\r\n    Tutorial_FlyAndShootTarget = 9,\r\n    Tutorial_Split = 10,\r\n    Tutorial_Planet = 11,\r\n    Tutorial_ShootSatellite = 12,\r\n    Tutorial_KillDefenderBoss = 13,\r\n}\r\n\r\nexport enum ApiGameStatus {\r\n    New = 0,\r\n    Joined = 1,\r\n    InProgress = 2,\r\n    Finished = 3\r\n}\r\n\r\nexport interface IPlayer {\r\n    role: ApiPlayerRole;\r\n    score: number;\r\n    status: ApiPlayerStatus;\r\n}\r\n\r\nexport enum ApiPlayerStatus {\r\n    NotJoined = 0,\r\n    Thinking = 1,\r\n    ReadyToGo = 2,\r\n    Won = 3,\r\n    Lost = 4,\r\n    Tied = 5,\r\n}\r\n\r\nexport interface ApiGameLog {\r\n    planet?: IPlanet;\r\n    ticks: ITick[];\r\n}\r\n\r\nexport interface IPlanet {\r\n    radius: number;\r\n    safeRadius: number;\r\n}\r\n\r\nexport interface ITick {\r\n    tick: number;\r\n    ships: IShipAndCommands[];\r\n}\r\n\r\nexport interface IShipAndCommands {\r\n    ship: IShip;\r\n    appliedCommands: ICommand[];\r\n}\r\n\r\nexport interface IShip {\r\n    role: ApiPlayerRole;\r\n    shipId: number;\r\n    position: V;\r\n    velocity: V;\r\n    matter: IMatter;\r\n    temperature: number;\r\n    criticalTemperature: number;\r\n    maxFuelBurnSpeed: number;\r\n}\r\n\r\nexport interface V {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport interface IMatter {\r\n    fuel: number;\r\n    lasers: number;\r\n    radiators: number;\r\n    engines: number;\r\n}\r\n\r\nexport type ICommand = IDetonateCommand | ILaserCommand | IBurnFuelCommand | ISplitCommand;\r\n\r\nexport interface IDetonateCommand {\r\n    type: ApiCommandType.Detonate;\r\n    power: number;\r\n    powerDecreaseStep: number;\r\n}\r\n\r\nexport interface ILaserCommand {\r\n    type: ApiCommandType.Shoot;\r\n    target: V;\r\n    power: number;\r\n    damage: number;\r\n    damageDecreaseFactor: number;\r\n}\r\n\r\nexport interface IBurnFuelCommand {\r\n    type: ApiCommandType.BurnFuel;\r\n    velocity: V;\r\n}\r\n\r\nexport interface ISplitCommand {\r\n    type: ApiCommandType.SplitShip;\r\n    matter: IMatter;\r\n}\r\n\r\nexport enum ApiCommandType {\r\n    BurnFuel = 0,\r\n    Detonate = 1,\r\n    Shoot = 2,\r\n    SplitShip = 3\r\n}\r\n\r\nexport enum ApiPlayerRole {\r\n    Attacker = 0,\r\n    Defender = 1,\r\n}","import {\r\n    ILogData,\r\n    IGameLogs,\r\n    ApiGameLog,\r\n    IPlanet,\r\n    IPlayer,\r\n    ITick,\r\n    ICommand,\r\n    IShip,\r\n    ApiCommandType,\r\n    IShipAndCommands\r\n} from \"./GameLogModels\";\r\n\r\nexport default function convertGameLog(data: ILogData): IGameLogs {\r\n    return {\r\n        isSucceeded: data[0],\r\n        gameType: data[1],\r\n        gameStatus: data[2],\r\n        ticks: data[3],\r\n        players: data[4].map(convertPlayer),\r\n        gameLog: data[5] && data[5][0] !== 0\r\n            ? convertLogItem(data[5])\r\n            : undefined,\r\n    };\r\n}\r\n\r\nfunction convertPlayer(data: number[]): IPlayer {\r\n    return {\r\n        role: data[0],\r\n        score: data[1],\r\n        status: data[2],\r\n    }\r\n}\r\n\r\nfunction convertLogItem(data: any[]): ApiGameLog {\r\n    return {\r\n        planet: data[0] && data[0][1] ? convertPlanet(data[0]) : undefined,\r\n        ticks: data[1].map(convertTick),\r\n    }\r\n}\r\n\r\nfunction convertPlanet(data: number[]): IPlanet {\r\n    return {\r\n        radius: data[0],\r\n        safeRadius: data[1],\r\n    }\r\n}\r\n\r\nfunction convertTick(data: any[]): ITick {\r\n    return {\r\n        tick: data[0],\r\n        ships: data[1].map(createShipAndCommands)\r\n    };\r\n}\r\n\r\nfunction createShipAndCommands(data: any[]): IShipAndCommands {\r\n    return {\r\n        ship: convertShip(data[0]),\r\n        appliedCommands: data[1].map((i: any[]) => convertCommands(i)),\r\n    }\r\n}\r\n\r\nfunction convertShip(data: any[]): IShip {\r\n    return {\r\n        role: data[0],\r\n        shipId: data[1],\r\n        position: { x: data[2][0], y: data[2][1] },\r\n        velocity: { x: data[3][0], y: data[3][1] },\r\n        matter: {\r\n            fuel: data[4][0],\r\n            lasers: data[4][1],\r\n            radiators: data[4][2],\r\n            engines: data[4][3],\r\n        },\r\n        temperature: data[5],\r\n        criticalTemperature: data[6],\r\n        maxFuelBurnSpeed: data[7],\r\n    };\r\n}\r\n\r\nfunction convertCommands(data: any): ICommand | null {\r\n    const type: ApiCommandType = data[0];\r\n    let res: ICommand;\r\n    switch (type) {\r\n        case ApiCommandType.SplitShip:\r\n            return { type, matter: {\r\n                    fuel: data[1][0],\r\n                    lasers: data[1][1],\r\n                    radiators: data[1][2],\r\n                    engines: data[1][3],\r\n                }};\r\n        case ApiCommandType.BurnFuel:\r\n            return {\r\n                type,\r\n                velocity: {x: data[1][0], y: data[1][1]}\r\n            }\r\n        case ApiCommandType.Detonate:\r\n            return {\r\n                type,\r\n                power: data[1],\r\n                powerDecreaseStep: data[2],\r\n            }\r\n        case ApiCommandType.Shoot:\r\n            return {\r\n                type,\r\n                target: {x: data[1][0], y: data[1][1]},\r\n                power: data[2],\r\n                damage: data[3],\r\n                damageDecreaseFactor: data[4],\r\n            }\r\n        default:\r\n            return null;\r\n    }\r\n}","import {ApiPlayerRole, IShip} from \"./GameLogModels\";\r\nimport {MathUtils, Vector2, Vector3} from \"three\";\r\n\r\nexport enum ShipComponentType {\r\n    Engine = 0,\r\n    Radiator = 1,\r\n    Laser = 2,\r\n    Fuel = 3,\r\n}\r\n\r\nexport interface IShipComponent {\r\n    position: Vector3;\r\n    type: ShipComponentType;\r\n}\r\n\r\nexport function GetShipComponentsCount(ship: IShip): number {\r\n    const matter = ship.matter;\r\n    return matter.engines + matter.radiators + matter.lasers + matter.fuel;\r\n}\r\n\r\n// max 512 components in ship\r\nexport function GetShipComponents(ship: IShip): IShipComponent[] {\r\n    const role = ship.role;\r\n    const matter = ship.matter;\r\n    const components : IShipComponent[] = [];\r\n    AddComponentsWithType(components, matter.engines, ShipComponentType.Engine);\r\n    AddComponentsWithType(components, matter.radiators, ShipComponentType.Radiator);\r\n    AddComponentsWithType(components, matter.lasers, ShipComponentType.Laser);\r\n    AddComponentsWithType(components, matter.fuel, ShipComponentType.Fuel);\r\n    if (role === ApiPlayerRole.Defender) {\r\n        for (let i=0; i<components.length; i++)\r\n            SetPositionDefender(components[i], i + 1);\r\n    } else\r\n        SetPositionsAttacker(components);\r\n    return components;\r\n}\r\n\r\nfunction AddComponentsWithType(components: IShipComponent[], count: number, matter: ShipComponentType) {\r\n    for (let i=0; i<count; i++)\r\n        components.push({ position: new Vector3(), type: matter });\r\n}\r\n\r\nfunction SetPositionsAttacker(cubes: IShipComponent[]) {\r\n    const usedPoints = new Set();\r\n    let indexForFigureWithDuplicates = 2;\r\n    for (let i=1; i<cubes.length; i++) {\r\n        let pos: Vector3;\r\n        let key: string;\r\n        while(true) {\r\n            pos = GetPositionAttackerForFigureWithDuplicateFacesEdges(indexForFigureWithDuplicates);\r\n            key = `${pos.x} ${pos.y} ${pos.z}`;\r\n            indexForFigureWithDuplicates++;\r\n            if (!usedPoints.has(key))\r\n                break;\r\n        }\r\n        cubes[i].position = pos;\r\n        usedPoints.add(key);\r\n    }\r\n}\r\n\r\nfunction GetPositionAttackerForFigureWithDuplicateFacesEdges(index: number): Vector3 {\r\n   return GetPosition(index, GetAttackerCubesCountOnLayerWithDuplicateFacesEdges, GetCoordsOnSideAttacker, false);\r\n}\r\n\r\nfunction GetAttackerCubesCountOnLayerWithDuplicateFacesEdges(layer: number): number {\r\n    if (layer === 1)\r\n        return 1;\r\n    return 6 * layer * layer;\r\n}\r\n\r\nfunction GetAttackerCubesCountOnLayer(layer: number): number {\r\n    if (layer === 1)\r\n        return 1;\r\n    return (layer - 1) * 4 * layer + (layer - 2) * (layer - 2) * 2;\r\n    // Периметр грани умножили на длину грани. Осталось закрасить центр по двум сторонам.\r\n}\r\n\r\nfunction SetPositionDefender(cube: IShipComponent, index: number) {\r\n    cube.position = GetPosition(index, GetDefenderCubesCountOnLayer, GetCoordsOnSideDefender, true);\r\n}\r\n\r\nfunction GetPosition(index: number,\r\n                     getCubesCountOnLayer: (layer: number) => number,\r\n                     getCoordsOnSide : (isCenterCubeOnLayer: boolean, indexOnSide: number) => Vector2,\r\n                     isCenterCubeOnEvenLayer : boolean)\r\n        : Vector3\r\n{\r\n    const {layer, indexOnLayer} = GetLayerAndIndexOnLayer(index, getCubesCountOnLayer);\r\n    if (layer === 1)\r\n        return new Vector3();\r\n    const face = (indexOnLayer - 1) % 6 + 1; // 6 граней: передняя, левая, правая, верхняя, нижняя, задняя\r\n    const indexOnFace = Math.ceil(indexOnLayer / 6);\r\n    const isCenterCubeOnLayer = layer % 2 === (isCenterCubeOnEvenLayer ? 0 : 1);\r\n    let coordsOnFace: Vector2;\r\n    if (isCenterCubeOnLayer && indexOnFace === 1) {\r\n        coordsOnFace = new Vector2(0, 0);\r\n    }\r\n    else {\r\n        // сторона грани: лево-верх, право-низ, верх-право, низ-лево. Угловой куб берется по направлению первого слова\r\n        const side = (indexOnFace - 1 - (isCenterCubeOnLayer ? 1 : 0)) % 4 + 1;\r\n        const indexOnSide = Math.ceil((indexOnFace - (isCenterCubeOnLayer ? 1 : 0)) / 4);\r\n        const coordsOnSide = getCoordsOnSide(isCenterCubeOnLayer, indexOnSide);\r\n        coordsOnFace =\r\n            side === 1 ? coordsOnSide :\r\n                side === 3 ? new Vector2(coordsOnSide.y, -coordsOnSide.x) : // rotate 90%\r\n                    side === 2 ? new Vector2(-coordsOnSide.x, -coordsOnSide.y) :\r\n                        new Vector2(-coordsOnSide.y, coordsOnSide.x);\r\n    }\r\n    return CoordOnFaceTo3d(coordsOnFace, layer, face);\r\n}\r\n\r\nconst AttackerSideColumnsAndRows_CenterOnLayer = [[1, 1], [1, 2], [2, 1], [2, 2], [1, 3],\r\n    [2, 3], [3, 1], [3, 2], [1, 4], [3, 3], [2, 4], [3, 4]];\r\nconst AttackerSideColumnsAndRows_CenterNotOnLayer = [[1, 1], [2, 1], [1, 2], [2, 2], [3, 1], [3, 2], [2, 3], [3, 3]];\r\nfunction GetCoordsOnSideAttacker(isCenterCubeOnLayer: boolean, indexOnSide: number) : Vector2 {\r\n    // Колонки вертикальны, столбцы горизонтальны. Координаты считаются от центра фигуры.\r\n    if (isCenterCubeOnLayer) {\r\n        const [column, row] = AttackerSideColumnsAndRows_CenterOnLayer[indexOnSide - 1];\r\n        return new Vector2(-2 * column, 2 * (row - 1));\r\n    }\r\n    const [column, row] = AttackerSideColumnsAndRows_CenterNotOnLayer[indexOnSide - 1];\r\n    return new Vector2(-2 * column + 1, 2 * row - 1);\r\n}\r\n\r\nfunction GetCoordsOnSideDefender(isCenterCubeOnLayer: boolean, indexOnSide: number) : Vector2  {\r\n    // индексы на стороне идут от углового по часовой стрелке. Сначала колонка ближе к центру.\r\n    const column =\r\n        isCenterCubeOnLayer\r\n            ? (indexOnSide > 2 ? 2 : 1)\r\n            : (indexOnSide > 4 ? 3 : (indexOnSide > 1 ? 2 : 1));\r\n    const indexOnColumn =\r\n        isCenterCubeOnLayer\r\n            ? (column === 1 ? indexOnSide : indexOnSide - 2)\r\n            : (column === 1 ? indexOnSide : (column === 2 ? indexOnSide - 1 : indexOnSide - 4));\r\n    const coordsOnSide = new Vector2(\r\n        -column * 2 + (isCenterCubeOnLayer ? 0 : 1) + (indexOnColumn - 1),\r\n        indexOnColumn - 1);\r\n    return coordsOnSide;\r\n}\r\n\r\nfunction CoordOnFaceTo3d(coordsOnFace: Vector2, layer: number, face: number) : Vector3 {\r\n    let result = new Vector3(coordsOnFace.x, layer - 1, coordsOnFace.y);\r\n    if (face === 2) {\r\n        result = result.applyAxisAngle(new Vector3(0, 0, 1), MathUtils.degToRad(180)); // counterclockwise\r\n        result = new Vector3(result.x, result.y, -result.z);\r\n    }\r\n    if (face === 3) {\r\n        result = result.applyAxisAngle(new Vector3(0, 0, 1), MathUtils.degToRad(90));\r\n        result = result.applyAxisAngle(new Vector3(1, 0, 0), MathUtils.degToRad(-90));\r\n        result = new Vector3(-result.x, result.y, result.z);\r\n        result = new Vector3(-result.x, result.y, -result.z);\r\n    }\r\n    if (face === 4) {\r\n        result = result.applyAxisAngle(new Vector3(0, 0, 1), MathUtils.degToRad(-90));\r\n        result = result.applyAxisAngle(new Vector3(1, 0, 0), MathUtils.degToRad(90));\r\n    }\r\n    else if (face === 5) {\r\n        result = result.applyAxisAngle(new Vector3(1, 0, 0), MathUtils.degToRad(90));\r\n    }\r\n    else if (face === 6) {\r\n        result = result.applyAxisAngle(new Vector3(1, 0, 0), MathUtils.degToRad(-90));\r\n        result = new Vector3(-result.x, result.y, result.z);\r\n    }\r\n    result = new Vector3(Math.round(result.x), Math.round(result.y), Math.round(result.z))\r\n    return result;\r\n}\r\n\r\nfunction GetDefenderCubesCountOnLayer(layer: number): number {\r\n    if (layer === 1)\r\n        return 1;\r\n    return 6 * (layer - 1) * (layer - 1); // 6 граней\r\n}\r\n\r\n// index from 1\r\nfunction GetLayerAndIndexOnLayer(cubeIndex: number, getCubesCountOnLayer: (layer: number) => number)\r\n    : {layer: number, indexOnLayer: number} {\r\n    let layer = 1;\r\n    let cubesCountOnPreviousLayers = 0;\r\n    while (true) {\r\n        const cubesCountOnLayer = getCubesCountOnLayer(layer)\r\n        if (cubesCountOnPreviousLayers + cubesCountOnLayer >= cubeIndex)\r\n            break;\r\n        layer++;\r\n        cubesCountOnPreviousLayers += cubesCountOnLayer;\r\n    }\r\n    return {layer: layer, indexOnLayer: cubeIndex - cubesCountOnPreviousLayers}\r\n}","import {\r\n    ApiCommandType,\r\n    ApiPlayerRole,\r\n    IDetonateCommand,\r\n    ILaserCommand,\r\n    IShip,\r\n    IShipAndCommands,\r\n    V\r\n} from \"./GameLogModels\";\r\nimport IRenderer from \"./IRenderer\";\r\nimport {simulate} from \"./Visualizer\";\r\n\r\nexport default class Renderer2d implements IRenderer\r\n{\r\n    ctx: CanvasRenderingContext2D;\r\n    canvas: HTMLCanvasElement;\r\n    cellSize: number;\r\n\r\n    constructor(ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement) {\r\n        this.ctx = ctx;\r\n        this.canvas = canvas;\r\n        this.cellSize = 10;\r\n    }\r\n\r\n    clearSpace() {\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    drawTrajectories(ships: IShipAndCommands[], showTrajectories: boolean) {\r\n        if (!showTrajectories)\r\n            return;\r\n        this.ctx.globalAlpha = 0.5;\r\n        for (let s of ships) {\r\n            const points = simulate(s.ship, 15);\r\n            const path = new Path2D();\r\n            path.moveTo(this.toScreenX(s.ship.position.x + 0.5), this.toScreenY(s.ship.position.y + 0.5));\r\n            for (let p of points) {\r\n                let sx = this.toScreenX(p.x + 0.5);\r\n                let sy = this.toScreenY(p.y + 0.5);\r\n                path.lineTo(sx, sy);\r\n            }\r\n            this.ctx.strokeStyle = this.shipColor(s.ship);\r\n            this.ctx.stroke(path);\r\n        }\r\n        this.ctx.globalAlpha = 1;\r\n    }\r\n\r\n    drawLaser(ship: IShip, laserCommand: ILaserCommand, getShootRadius: (power: number, powerDecrease: number) => number) {\r\n        const target = laserCommand.target;\r\n        const damage = laserCommand.damage;\r\n        const damageDecreaseFactor = laserCommand.damageDecreaseFactor;\r\n        const laser = new Path2D();\r\n        laser.moveTo(this.toScreenX(ship.position.x + 0.5), this.toScreenY(ship.position.y + 0.5));\r\n        laser.lineTo(this.toScreenX(target.x + 0.5), this.toScreenY(target.y + 0.5));\r\n        this.ctx.fillStyle = \"white\";\r\n        this.ctx.fill(this.createRect(target.x, target.y, getShootRadius(damage, damageDecreaseFactor)));\r\n        this.ctx.strokeStyle = \"yellow\";\r\n        this.ctx.stroke(laser);\r\n    }\r\n\r\n    drawDetonation(ship: IShip, detonateCommand: IDetonateCommand) {\r\n        const power = detonateCommand.power;\r\n        const powerDecrease = detonateCommand.powerDecreaseStep;\r\n        const r = power / powerDecrease - 1;\r\n        this.ctx.fillStyle = \"magenta\";\r\n        this.ctx.fill(this.createRect(ship.position.x, ship.position.y, r));\r\n    }\r\n\r\n    drawShipsAndCommands(revShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         shipsAndCommands: IShipAndCommands[],\r\n                         nextShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         isAutoPlay: boolean, getShootRadius: (power: number, powerDecrease: number) => number)\r\n    {\r\n        this.drawCommands(shipsAndCommands, getShootRadius);\r\n        for (const shipAndCommands of shipsAndCommands)\r\n            this.drawShip(shipAndCommands.ship);\r\n    }\r\n\r\n    drawCommands(ships: IShipAndCommands[], getShootRadius: (power: number, powerDecrease: number) => number) {\r\n        for (let ship of ships)\r\n            for (let cmd of ship.appliedCommands) {\r\n                if (cmd.type === ApiCommandType.Detonate) this.drawDetonation(ship.ship, cmd);\r\n                else if (cmd.type === ApiCommandType.Shoot) this.drawLaser(ship.ship, cmd, getShootRadius);\r\n            }\r\n    }\r\n\r\n    drawPlanet(radius: number) {\r\n        this.ctx.fillStyle = \"white\";\r\n        this.ctx.fill(this.createRect(0, 0, radius));\r\n    }\r\n\r\n    drawSafePlace(radius: number) {\r\n        this.ctx.fillStyle = \"rgb(0,0,0)\";\r\n        this.ctx.fill(this.createRect(0, 0, radius));\r\n    }\r\n\r\n    drawShip(ship: IShip) {\r\n        const pos = ship.position;\r\n        this.ctx.fillStyle = this.shipColor(ship);\r\n        this.ctx.fill(this.createRect(pos.x, pos.y));\r\n    }\r\n\r\n    createRect(gameX: number, gameY: number, radius = 0) {\r\n        const res = new Path2D();\r\n        let size = (2 * radius + 1) * this.cellSize;\r\n        let left = this.toScreenX(gameX - radius);\r\n        let top = this.toScreenY(gameY - radius);\r\n        const minSize = 4;\r\n        if (size < minSize) {\r\n            left -= (minSize - size) / 2;\r\n            top -= (minSize - size) / 2;\r\n            size = minSize;\r\n        }\r\n        res.rect(left, top, size, size);\r\n        return res;\r\n    }\r\n\r\n    toScreenX(gameX: number) {\r\n        const originX = this.canvas.width / 2 - this.cellSize / 2;\r\n        return originX + gameX * this.cellSize;\r\n    }\r\n\r\n    toScreenY(gameY: number) {\r\n        const originY = this.canvas.height / 2 - this.cellSize / 2;\r\n        return originY + gameY * this.cellSize;\r\n    }\r\n\r\n    fitInScreen(pos: V) {\r\n        const screenX = this.toScreenX(pos.x);\r\n        const screenY = this.toScreenY(pos.y);\r\n        return screenX > 0 && screenX < this.canvas.width && screenY > 0 && screenY < this.canvas.height;\r\n    }\r\n\r\n    adjustScale(ships: IShipAndCommands[]) {\r\n        while (this.cellSize > 0.4 && ships.some(s => !this.fitInScreen(s.ship.position)))\r\n            this.cellSize /= 1.2;\r\n    }\r\n\r\n    shipColor(ship: IShip) {\r\n        return ship.role === ApiPlayerRole.Defender ? 'teal' : 'orange';\r\n    }\r\n\r\n    setTimePerTick(timePerTick: number): void {\r\n    }\r\n}\r\n","import IRenderer from \"./IRenderer\";\r\nimport {\r\n    ApiCommandType, ApiPlayerRole,\r\n    IBurnFuelCommand,\r\n    IDetonateCommand,\r\n    ILaserCommand,\r\n    IShip,\r\n    IShipAndCommands,\r\n    ISplitCommand,\r\n    V\r\n} from \"./GameLogModels\";\r\nimport {GetShipComponents, GetShipComponentsCount, IShipComponent, ShipComponentType} from \"./ShipsUtils\";\r\nimport {\r\n    AdditiveBlending,\r\n    AmbientLight,\r\n    AnimationClip,\r\n    AnimationMixer,\r\n    BackSide,\r\n    BoxBufferGeometry,\r\n    BoxGeometry,\r\n    Color,\r\n    ColorKeyframeTrack, ConeGeometry,\r\n    CylinderGeometry,\r\n    DirectionalLight,\r\n    DoubleSide,\r\n    FrontSide,\r\n    InterpolateLinear,\r\n    MathUtils,\r\n    Mesh,\r\n    MeshBasicMaterial,\r\n    MeshPhongMaterial,\r\n    NumberKeyframeTrack,\r\n    Object3D,\r\n    PerspectiveCamera,\r\n    Scene,\r\n    ShaderMaterial,\r\n    SphereGeometry, Sprite, SpriteMaterial,\r\n    TextureLoader,\r\n    Vector2,\r\n    Vector3,\r\n    VectorKeyframeTrack,\r\n    WebGLRenderer\r\n} from \"three\";\r\nimport {Texture} from \"three/src/textures/Texture\";\r\nimport {EffectComposer} from \"three/examples/jsm/postprocessing/EffectComposer\";\r\nimport {RenderPass} from \"three/examples/jsm/postprocessing/RenderPass\";\r\nimport {UnrealBloomPass} from \"three/examples/jsm/postprocessing/UnrealBloomPass\";\r\nimport {BufferGeometryUtils} from \"three/examples/jsm/utils/BufferGeometryUtils\";\r\nimport {ShaderPass} from \"three/examples/jsm/postprocessing/ShaderPass\";\r\nimport {FXAAShader} from \"three/examples/jsm/shaders/FXAAShader\";\r\n\r\nexport default class Renderer3d implements IRenderer {\r\n    private readonly ctx: WebGLRenderingContext;\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly simulate: (ship: IShip, ticks: number, hasPlanet: boolean) => V[];\r\n    private readonly scene: Scene;\r\n    private readonly renderer: WebGLRenderer;\r\n    private readonly camera: PerspectiveCamera;\r\n    private bloomComposer: EffectComposer;\r\n\r\n    cameraRotationLon: number = 0; // широта\r\n    cameraRotationLat: number = 0; // долгота\r\n    private onPointerDownPointerX: number  = 0;\r\n    private onPointerDownPointerY: number  = 0;\r\n    private onStartRotateLon: number = 0;\r\n    private onStartRotateLat: number = 0;\r\n    private cameraRotationLonDelta: number = 0;\r\n    private cameraRotationLatDelta: number = 0;\r\n    private dampingFactor = 0.05;\r\n    private rotationSpeed = 0.008;\r\n\r\n    private zoom: number = 1;\r\n    private zoomDelta: number = 0;\r\n    private maxZoom = 30;\r\n    private minZoom = 0.4;\r\n    private zoomDampingFactor = 0.02;\r\n\r\n    private shipIdInView: number | undefined;\r\n    isGeneralView: boolean = true;\r\n    private lookAt: Vector3 = new Vector3();\r\n    private cameraPosition: Vector3 = new Vector3();\r\n\r\n    private prevShipsAndCommands: IShipAndCommands[] | undefined;\r\n    private shipsAndCommands: IShipAndCommands[] = [];\r\n    private nextShipsAndCommands: IShipAndCommands[] | undefined;\r\n    notDrawShips: boolean = true;\r\n    private shipInViewFlyClockwise: boolean = false;\r\n    private isAutoPlay = false;\r\n\r\n    private shipsOnScene: { [id: number] : {mesh: Mesh, sprite: Sprite, components: IShipComponent[]} } = [];\r\n    private detonationsOnScene: { outerSphere: Mesh, innerSphere: Mesh }[] = [];\r\n    private laserLinesOnScene: { laser: Mesh, glow: Mesh, target: Vector3, shipId: number}[] = [];\r\n    private laserShootRadiiOnScene: { shoot: Object3D, innerSphere: Mesh, glow: Mesh }[] = [];\r\n    private exhaustsOnScene: { mesh: Mesh, glow: Mesh, shipId: number }[] = [];\r\n    private readonly shipCubeSize = 1 / 7 / 0.7;\r\n\r\n    private planet: Mesh | undefined;\r\n    private planetGlow: Mesh | undefined;\r\n\r\n    private timePerTick: number;\r\n    private startTime: number = +new Date();\r\n    private lastTickTime: number = 0;\r\n\r\n    private readonly skyTex: Texture;\r\n    private readonly planetOpacityTex: Texture;\r\n    private shipComponentsMaterials: {component: ShipComponentType, material: MeshPhongMaterial}[] = [];\r\n    private readonly shipSpriteMaterial: SpriteMaterial;\r\n\r\n    private explosionMeshes: Mesh[] = [];\r\n    private mixers: AnimationMixer[] = [];\r\n\r\n    private readonly fxaaPass: ShaderPass;\r\n\r\n    constructor(ctx: WebGLRenderingContext, canvas: HTMLCanvasElement, timePerTick: number,\r\n                simulate: (ship: IShip, ticks: number, hasPlanet: boolean) => V[]) {\r\n        this.bind();\r\n\r\n        this.ctx = ctx;\r\n        this.canvas = canvas;\r\n        this.simulate = simulate;\r\n        this.timePerTick = timePerTick;\r\n        this.scene = new Scene();\r\n        this.renderer = new WebGLRenderer( { canvas: this.canvas, antialias: false } );\r\n        this.renderer.setSize(canvas.scrollWidth, canvas.scrollHeight);\r\n\r\n        const textureLoader = new TextureLoader();\r\n        this.skyTex = textureLoader.load(\"images/Galaxy2.jpg\");\r\n        this.planetOpacityTex = textureLoader.load(\"images/Planet.png\");\r\n\r\n        this.camera = new PerspectiveCamera(50, canvas.scrollWidth / canvas.scrollHeight, 1, 10000);\r\n\r\n        this.drawStarsSphere();\r\n        this.createLight();\r\n        this.initShipComponentsMaterials(textureLoader);\r\n        this.shipSpriteMaterial = new SpriteMaterial({ color: 0xffffff, sizeAttenuation: false, opacity: 0.7 } );\r\n\r\n        const renderScene = new RenderPass(this.scene, this.camera);\r\n        const bloomPass = new UnrealBloomPass(\r\n            new Vector2(this.canvas.width, this.canvas.height),\r\n            0.8, 0.6, 0.3);\r\n        this.fxaaPass = new ShaderPass(FXAAShader);\r\n\r\n        this.bloomComposer = new EffectComposer(this.renderer);\r\n        this.bloomComposer.renderToScreen = true;\r\n        this.bloomComposer.addPass(renderScene);\r\n        this.bloomComposer.addPass(bloomPass);\r\n        this.bloomComposer.addPass(this.fxaaPass);\r\n\r\n        this.canvas.addEventListener('mousedown', this.onDocumentMouseDown, false);\r\n        this.animate();\r\n    }\r\n\r\n    setZoomDelta(delta: number) {\r\n        this.zoomDelta += delta\r\n    }\r\n\r\n    private initShipComponentsMaterials(textureLoader: TextureLoader) {\r\n        const bump = textureLoader.load(\"images/Pixel Bump.png\");\r\n        const engine = textureLoader.load(\"images/Engine2.png\");\r\n        const fuel = textureLoader.load(\"images/Fuel.png\");\r\n        const lasers = textureLoader.load(\"images/Lazers.png\");\r\n        const radiators = textureLoader.load(\"images/Radiators.png\");\r\n        const engineComponentMaterial = new MeshPhongMaterial({\r\n            map: engine,\r\n            shininess: 100,\r\n            bumpMap: bump,\r\n            specular: 0.5,\r\n            bumpScale: 0.007\r\n        });\r\n        const radiatorComponentMaterial = engineComponentMaterial.clone();\r\n        radiatorComponentMaterial.map = radiators;\r\n        radiatorComponentMaterial.bumpMap = bump;\r\n        const laserComponentMaterial = engineComponentMaterial.clone();\r\n        laserComponentMaterial.map = lasers;\r\n        laserComponentMaterial.bumpMap = bump;\r\n        const fuelComponentMaterial = engineComponentMaterial.clone();\r\n        fuelComponentMaterial.map = fuel;\r\n        fuelComponentMaterial.bumpMap = bump;\r\n        this.shipComponentsMaterials = [\r\n            {component: ShipComponentType.Engine, material: engineComponentMaterial},\r\n            {component: ShipComponentType.Radiator, material: radiatorComponentMaterial},\r\n            {component: ShipComponentType.Laser, material: laserComponentMaterial},\r\n            {component: ShipComponentType.Fuel, material: fuelComponentMaterial}\r\n        ];\r\n    }\r\n\r\n    private createLight() {\r\n        const purpleLight = new DirectionalLight(0x7C4D94, 1);\r\n        purpleLight.position.set(-0.8, 1, 0.1);\r\n        purpleLight.target.position.set(0, 0, 0)\r\n        this.scene.add(purpleLight);\r\n        this.scene.add(purpleLight.target);\r\n\r\n        const whiteLight = new DirectionalLight(0xffffff, 0.7);\r\n        whiteLight.position.set(1, -1, 0);\r\n        whiteLight.target.position.set(0, 0.1, 0);\r\n        this.scene.add(whiteLight);\r\n        this.scene.add(whiteLight.target);\r\n\r\n        this.scene.add(new AmbientLight(0x36394a, 1));\r\n    }\r\n\r\n    private bind() {\r\n        this.onDocumentMouseMove = this.onDocumentMouseMove.bind(this);\r\n        this.onDocumentMouseUp = this.onDocumentMouseUp.bind(this);\r\n        this.onDocumentMouseLeave = this.onDocumentMouseLeave.bind(this);\r\n        this.onDocumentMouseDown = this.onDocumentMouseDown.bind(this);\r\n        this.animate = this.animate.bind(this);\r\n    }\r\n\r\n    private animate() {\r\n        this.render();\r\n        requestAnimationFrame(this.animate);\r\n    }\r\n\r\n    private onDocumentMouseDown(event: MouseEvent) {\r\n        event.preventDefault();\r\n        this.onPointerDownPointerX = event.clientX;\r\n        this.onPointerDownPointerY = event.clientY;\r\n        this.onStartRotateLon = this.cameraRotationLon;\r\n        this.onStartRotateLat = this.cameraRotationLat;\r\n        this.canvas.addEventListener('mousemove', this.onDocumentMouseMove, false);\r\n        this.canvas.addEventListener('mouseup',  this.onDocumentMouseUp, false);\r\n        this.canvas.addEventListener('mouseleave',  this.onDocumentMouseLeave, false);\r\n    }\r\n\r\n    private onDocumentMouseMove(event: MouseEvent) {\r\n        this.cameraRotationLonDelta += (this.onPointerDownPointerX - event.clientX) * this.rotationSpeed;\r\n        this.cameraRotationLatDelta += - (this.onPointerDownPointerY - event.clientY) * this.rotationSpeed;\r\n        this.onStartRotateLon += this.cameraRotationLonDelta;\r\n        this.onStartRotateLat += this.cameraRotationLatDelta;\r\n    }\r\n\r\n    private onDocumentMouseLeave() {\r\n        this.onDocumentMouseUp();\r\n    }\r\n\r\n    private onDocumentMouseUp() {\r\n        this.canvas.removeEventListener('mousemove', this.onDocumentMouseMove, false);\r\n        this.canvas.removeEventListener('mouseup', this.onDocumentMouseUp, false);\r\n        this.canvas.removeEventListener('mouseleave', this.onDocumentMouseLeave, false);\r\n    }\r\n\r\n    adjustScale(ships: IShipAndCommands[]) {\r\n    }\r\n\r\n    clearSpace(): void {\r\n    }\r\n\r\n    drawShipsAndCommands(prevShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         shipsAndCommands: IShipAndCommands[],\r\n                         nextShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         isAutoPlay: boolean,\r\n                         getShootRadius: (power: number, powerDecrease: number) => number) {\r\n        for (let i=0; i<this.mixers.length; i++) {\r\n            this.mixers[i].stopAllAction();\r\n        }\r\n        this.mixers = [];\r\n        this.lastTickTime = +new Date() - this.startTime;\r\n        this.prevShipsAndCommands = prevShipsAndCommands;\r\n        this.shipsAndCommands = shipsAndCommands;\r\n        this.nextShipsAndCommands = nextShipsAndCommands;\r\n        this.isAutoPlay = isAutoPlay;\r\n        this.drawShips(shipsAndCommands);\r\n        this.drawCommands(getShootRadius);\r\n    }\r\n\r\n    private drawShips(shipsAndCommands: IShipAndCommands[]) {\r\n        const shipsOnSceneNew: { [id: number]: {mesh: Mesh, sprite: Sprite, components: IShipComponent[]} } = {}\r\n        for (const shipAndCommands of shipsAndCommands) {\r\n            const shipData = shipAndCommands.ship;\r\n            const newShipAndComponents = this.notDrawShips ? undefined : this.drawShip(shipData);\r\n            if (newShipAndComponents !== undefined)\r\n                shipsOnSceneNew[shipData.shipId] = newShipAndComponents;\r\n        }\r\n        for (let i=0; i<this.explosionMeshes.length; i++) {\r\n            this.scene.remove(this.explosionMeshes[i]);\r\n        }\r\n        this.explosionMeshes = [];\r\n        for (const id in this.shipsOnScene) {\r\n            if ((this.shipsOnScene.hasOwnProperty(id) && !shipsOnSceneNew.hasOwnProperty(id))\r\n                || (this.shipsOnScene.hasOwnProperty(id) && shipsOnSceneNew.hasOwnProperty(id)\r\n                    && this.shipsOnScene[id].components.length !== shipsOnSceneNew[id].components.length))\r\n            {\r\n                this.processExplosion(shipsOnSceneNew, +id, shipsAndCommands);\r\n                this.scene.remove(this.shipsOnScene[id].mesh);\r\n            }\r\n        }\r\n        this.shipsOnScene = shipsOnSceneNew;\r\n    }\r\n\r\n    // if critical temperature too\r\n    private processExplosion(shipsOnSceneNew: { [p: number]: { mesh: Mesh; components: IShipComponent[] } },\r\n                             id: number, shipsAndCommands: IShipAndCommands[]) {\r\n        const newComponentsCount = shipsOnSceneNew.hasOwnProperty(id) ? shipsOnSceneNew[id].components.length : 0;\r\n        const shipCommandList = shipsAndCommands.filter(s => s.ship.shipId === +id);\r\n        const shipCommands = shipCommandList.length > 0 ? shipCommandList[0].appliedCommands : undefined;\r\n        const nextPosition = shipCommandList.length === 0 ? undefined : this.simulate(shipCommandList[0].ship, 1, true)[0];\r\n        let spentCubes = 0;\r\n        if (shipCommands !== undefined) {\r\n            for (let i = 0; i < shipCommands.length; i++) {\r\n                const command = shipCommands[i];\r\n                if (command.type === ApiCommandType.BurnFuel) {\r\n                    const velocity = (command as IBurnFuelCommand).velocity;\r\n                    spentCubes += Math.abs(velocity.x) + Math.abs(velocity.y);\r\n                } else if (command.type === ApiCommandType.SplitShip) {\r\n                    const matter = (command as ISplitCommand).matter;\r\n                    spentCubes += matter.fuel + matter.lasers + matter.radiators + matter.engines;\r\n                }\r\n            }\r\n        }\r\n        const componentsCountForExplosion = this.shipsOnScene[id].components.length - newComponentsCount - spentCubes;\r\n        const position = shipsOnSceneNew.hasOwnProperty(id) ? shipsOnSceneNew[id].mesh.position : this.shipsOnScene[id].mesh.position;\r\n        if (componentsCountForExplosion > 0) {\r\n            const explosedComponents: IShipComponent[] = [];\r\n            for (let i = newComponentsCount; i < newComponentsCount + componentsCountForExplosion; i++) {\r\n                explosedComponents.push(this.shipsOnScene[id].components[i]);\r\n            }\r\n            this.drawShipExplosion(position, fromGameCoords(nextPosition === undefined ? position : nextPosition), explosedComponents);\r\n        }\r\n    }\r\n\r\n    private drawShipExplosion(position: Vector3, nextPosition: Vector3, explosedComponents: IShipComponent[]) {\r\n        const count = explosedComponents.length;\r\n        for (let i = 0; i < count; i++) {\r\n            const component = explosedComponents[i];\r\n            const geometry = new BoxBufferGeometry(1, 1, 1);\r\n            const material = this.shipComponentsMaterials[+component.type].material.clone();\r\n            material.transparent = true;\r\n            const mesh = new Mesh(geometry, material);\r\n            mesh.scale.multiplyScalar(this.shipCubeSize);\r\n            mesh.position.copy(position);\r\n            const positionDelta = Math.log(count);\r\n            const componentPosition = component.position.clone().multiplyScalar(this.shipCubeSize / 2);\r\n            const randomPosVec = new Vector3(componentPosition.x * (1 + Math.random() * positionDelta), componentPosition.y * (1 + Math.random() * positionDelta), (Math.random() - 0.5) * positionDelta);\r\n            const startPos = position.clone().add(componentPosition);\r\n            const finalPos = nextPosition.clone().add(randomPosVec);\r\n            const positionKF = new VectorKeyframeTrack('.position', [0, 1],\r\n                [startPos.x, startPos.y, startPos.z, finalPos.x, finalPos.y, finalPos.z]);\r\n            const scaleKF = new VectorKeyframeTrack('.scale', [0, 1], [this.shipCubeSize, this.shipCubeSize, this.shipCubeSize, this.shipCubeSize * 0.2, this.shipCubeSize * 0.2, this.shipCubeSize * 0.2]);\r\n            const opacityKF = new NumberKeyframeTrack( '.material.opacity', [0, 1], [1, 0]);\r\n            const colorKF = new ColorKeyframeTrack( '.material.color', [ 0, 0.5, 1 ], [ 1, 1, 1, 1, 0, 0, 1, 0, 0], InterpolateLinear );\r\n            const clip = new AnimationClip('Action', 1, [scaleKF, positionKF, opacityKF, colorKF]);\r\n            const mixer = new AnimationMixer(mesh);\r\n            const clipAction = mixer.clipAction(clip);\r\n            this.explosionMeshes.push(mesh);\r\n            this.mixers.push(mixer);\r\n            clipAction.play();\r\n            this.scene.add(mesh);\r\n        }\r\n    }\r\n\r\n    private drawShip(shipData: IShip): {mesh: Mesh, sprite: Sprite, components: IShipComponent[]} | undefined {\r\n        let ship: Mesh | undefined;\r\n        const componentsCount = GetShipComponentsCount(shipData);\r\n        let components;\r\n        let sprite;\r\n        if (this.shipsOnScene.hasOwnProperty(shipData.shipId)\r\n            && this.shipsOnScene[shipData.shipId].components.length === componentsCount)\r\n        {\r\n            const s = this.shipsOnScene[shipData.shipId];\r\n            ship = s.mesh;\r\n            components = s.components;\r\n            sprite = s.sprite;\r\n        } else {\r\n            const result = this.createShip(shipData);\r\n            ship = result?.mesh;\r\n            components = result?.components;\r\n            sprite = result?.sprite;\r\n            if (ship === undefined)\r\n                return undefined;\r\n            this.scene.add(ship);\r\n        }\r\n        if (ship === undefined || components === undefined || sprite === undefined)\r\n            return undefined;\r\n        ship.position.copy(fromGameCoords(shipData.position));\r\n        ship.lookAt(ship.position.clone().add(fromGameCoords(shipData.velocity)));\r\n        return {mesh: ship, sprite: sprite, components: components};\r\n    }\r\n\r\n    private createShip(shipData: IShip): { mesh: Mesh, sprite: Sprite, components: IShipComponent[] } | undefined {\r\n        const components = GetShipComponents(shipData);\r\n        const byTypes : BoxBufferGeometry[][] = [[],[],[],[]];\r\n        const dummy = new Object3D();\r\n        let ship : Mesh | undefined = undefined;\r\n        for (let i=0; i<components.length; i++) {\r\n            const component = components[i];\r\n            const geometry = new BoxBufferGeometry(1 + 0.001 * i, 1 + 0.001 * i, 1 + 0.001 * i);\r\n            const offset = 0.7;\r\n            dummy.position.set(component.position.x * offset, component.position.y * offset, component.position.z * offset);\r\n            dummy.updateMatrix();\r\n            geometry.applyMatrix4(dummy.matrix);\r\n            if (i === 0) {\r\n                ship = new Mesh(geometry, this.shipComponentsMaterials[+component.type].material);\r\n            } else {\r\n                byTypes[+component.type].push(geometry);\r\n            }\r\n        }\r\n        if (ship === undefined)\r\n            return undefined;\r\n        for (let i=0; i<4; i++) {\r\n            const geometries = byTypes[i];\r\n            if (geometries.length === 0)\r\n                continue;\r\n            const mergedGeometry = geometries.length === 1\r\n                ? geometries[0]\r\n                : BufferGeometryUtils.mergeBufferGeometries(geometries);\r\n            const mesh = new Mesh(mergedGeometry, this.shipComponentsMaterials[i].material);\r\n            ship.add(mesh);\r\n        }\r\n        ship.scale.multiplyScalar(this.shipCubeSize);\r\n        const material = this.shipSpriteMaterial.clone();\r\n        material.color.set(this.shipColor(shipData));\r\n        const sprite = new Sprite(material);\r\n        ship.add(sprite);\r\n        sprite.scale.multiplyScalar(0.013);\r\n        return { mesh: ship, sprite: sprite, components: components };\r\n    }\r\n\r\n    private drawCommands(getShootRadius: (power: number, powerDecrease: number) => number): void {\r\n        this.removeOldObjectsFromScene();\r\n\r\n        for (let sap of this.shipsAndCommands) {\r\n            for (let cmd of sap.appliedCommands) {\r\n                if (cmd.type === ApiCommandType.Detonate)\r\n                    this.drawDetonation(sap.ship, cmd);\r\n                else if (cmd.type === ApiCommandType.Shoot)\r\n                    this.drawLaser(sap.ship, cmd, getShootRadius);\r\n            }\r\n        }\r\n        if (this.nextShipsAndCommands !== undefined) {\r\n            for (let sap of this.nextShipsAndCommands) {\r\n                if (this.shipsOnScene[sap.ship.shipId] === undefined)\r\n                    continue;\r\n                for (let cmd of sap.appliedCommands) {\r\n                    if (cmd.type === ApiCommandType.BurnFuel) {\r\n                        this.drawExhaust(sap.ship, cmd);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeOldObjectsFromScene() {\r\n        for (let detonation of this.detonationsOnScene)\r\n            this.scene.remove(detonation.outerSphere);\r\n        this.detonationsOnScene = [];\r\n        for (let laserLine of this.laserLinesOnScene)\r\n            this.scene.remove(laserLine.laser);\r\n        this.laserLinesOnScene = [];\r\n        for (let shootRadius of this.laserShootRadiiOnScene)\r\n            this.scene.remove(shootRadius.shoot);\r\n        this.laserShootRadiiOnScene = [];\r\n        for (let exhaust of this.exhaustsOnScene)\r\n            this.scene.remove(exhaust.mesh);\r\n    }\r\n\r\n    private drawLaser(ship: IShip, laserCommand: ILaserCommand, getShootRadius: (power: number, powerDecrease: number) => number) {\r\n        const target = laserCommand.target;\r\n        const damage = laserCommand.damage;\r\n        const damageDecreaseFactor = laserCommand.damageDecreaseFactor;\r\n\r\n        const laserMaterial = new MeshBasicMaterial({color: new Color(0.8, 0.8, 0.8), transparent: true});\r\n        const from = fromGameCoords(ship.position);\r\n        const to = fromGameCoords(target);\r\n        const geometry = new CylinderGeometry(0.1, 0.1, from.distanceTo(to), 8);\r\n        const laser = new Mesh(geometry, laserMaterial);\r\n\r\n        const glowMaterial = new ShaderMaterial({\r\n            uniforms: {\r\n                \"c\":   { type: \"f\", value: 0.5 } as any,\r\n                \"p\":   { type: \"f\", value: 4.7 } as any,\r\n                glowColor: { type: \"c\", value: new Color(1, 0, 0) } as any,\r\n                viewVector: { type: \"v3\", value: this.camera.position } as any\r\n            },\r\n            vertexShader: vertexShaderGlow,\r\n            fragmentShader: fragmentShaderGlow,\r\n            side: FrontSide,\r\n            blending: AdditiveBlending,\r\n            transparent: true\r\n        });\r\n\r\n        let glowGeom = new CylinderGeometry(0.2, 0.2, from.distanceTo(to), 8);\r\n        let glowMesh = new Mesh(glowGeom, glowMaterial);\r\n\r\n        this.laserLinesOnScene.push({laser: laser, glow: glowMesh, target: to, shipId: ship.shipId});\r\n        laser.add(glowMesh);\r\n        this.scene.add(laser);\r\n\r\n        {\r\n            const opacityKF = new NumberKeyframeTrack('.material.opacity', [0, 1 / 3, 1], [1, 0, 0]);\r\n            const scaleKF = new VectorKeyframeTrack('.scale', [0, 1 / 3, 1], [1, 1, 1, 0, 1, 0, 0, 1, 0]);\r\n            const clip = new AnimationClip('Action', 1, [opacityKF, scaleKF]);\r\n            const mixer = new AnimationMixer(laser);\r\n            const clipAction = mixer.clipAction(clip);\r\n            this.mixers.push(mixer);\r\n            clipAction.play();\r\n        }\r\n\r\n        const shootRadiusMaterial = new MeshBasicMaterial({ color: new Color(1, 0.9, 0.9), opacity:0.1, transparent: true, side: FrontSide });\r\n        const shootRadiusGeometry = new SphereGeometry(getShootRadius(damage, damageDecreaseFactor) * 1.4 /*sqrt(2)*/, 30, 30);\r\n        const shootRadius = new Mesh(shootRadiusGeometry, shootRadiusMaterial);\r\n        shootRadius.position.copy(fromGameCoords(laserCommand.target));\r\n\r\n        const innerSphere = new Mesh(shootRadiusGeometry.clone(), shootRadiusMaterial.clone());\r\n        innerSphere.material.side = BackSide;\r\n        shootRadius.add(innerSphere);\r\n\r\n        this.laserShootRadiiOnScene.push({shoot: shootRadius, innerSphere: innerSphere, glow: new Mesh()});\r\n\r\n        {\r\n            const scaleKF = new VectorKeyframeTrack('.scale', [0, 0.3, 0], [0.2, 0.2, 0.2, 0.9, 0.9, 0.9, 1, 1, 1]);\r\n            const opacityKF = new NumberKeyframeTrack('.material.opacity', [0, 0.1, 0.5, 0.8, 1], [0.01, 0.1, 0.05, 0, 0]);\r\n            const clip = new AnimationClip('Action', 1, [scaleKF, opacityKF]);\r\n            const mixer = new AnimationMixer(shootRadius);\r\n            const clipAction = mixer.clipAction(clip);\r\n            this.mixers.push(mixer);\r\n            clipAction.play();\r\n            const mixerInner = new AnimationMixer(innerSphere);\r\n            const clipActionInner = mixerInner.clipAction(clip);\r\n            this.mixers.push(mixerInner);\r\n            clipActionInner.play();\r\n        }\r\n\r\n        this.scene.add(shootRadius);\r\n    }\r\n\r\n    private drawDetonation(ship: IShip, detonateCommand: IDetonateCommand) {\r\n        const power = detonateCommand.power;\r\n        const powerDecrease = detonateCommand.powerDecreaseStep;\r\n        const r = power / powerDecrease - 1;\r\n        const material = new MeshBasicMaterial({ color: new Color(1, 0.9, 0.9), opacity:0.1, transparent: true, side: FrontSide });\r\n        const geometry = new SphereGeometry(r * 1.4, 30, 30);\r\n        const detonation = new Mesh(geometry, material);\r\n        detonation.position.copy(fromGameCoords(ship.position));\r\n\r\n        const innerSphere = new Mesh(geometry.clone(), material.clone());\r\n        innerSphere.material.side = BackSide;\r\n        detonation.add(innerSphere);\r\n\r\n        this.detonationsOnScene.push({ outerSphere: detonation, innerSphere: innerSphere });\r\n\r\n        {\r\n            const scaleKF = new VectorKeyframeTrack('.scale', [0, 0.3, 0], [0.2, 0.2, 0.2, 0.9, 0.9, 0.9, 1, 1, 1]);\r\n            const opacityKF = new NumberKeyframeTrack('.material.opacity', [0, 0.1, 0.5, 0.8, 1], [0.05, 0.2, 0.1, 0, 0]);\r\n            const clip = new AnimationClip('Action', 1, [scaleKF, opacityKF]);\r\n            const mixer = new AnimationMixer(detonation);\r\n            const clipAction = mixer.clipAction(clip);\r\n            this.mixers.push(mixer);\r\n            clipAction.play();\r\n            const mixerInner = new AnimationMixer(innerSphere);\r\n            const clipActionInner = mixerInner.clipAction(clip);\r\n            this.mixers.push(mixerInner);\r\n            clipActionInner.play();\r\n        }\r\n\r\n        this.scene.add(detonation);\r\n    }\r\n\r\n    private drawExhaust(ship: IShip, burnFuelCommand: IBurnFuelCommand) {\r\n        const shipOnScene = this.shipsOnScene[ship.shipId];\r\n        if (shipOnScene === undefined)\r\n            return;\r\n        const velocity = fromGameCoords(burnFuelCommand.velocity);\r\n        const sizeCoefficient = this.shipCubeSize;\r\n        const heightCoefficient = (Math.abs(velocity.x) > 1 || Math.abs(velocity.y) > 1 ? 2 : 1);\r\n        const glowMaterial = new ShaderMaterial({\r\n            uniforms: {\r\n                \"c\":   { type: \"f\", value: 0.3 } as any,\r\n                \"p\":   { type: \"f\", value: 4 } as any,\r\n                glowColor: { type: \"c\", value: new Color(0, 0, 0) } as any,\r\n                viewVector: { type: \"v3\", value: this.camera.position } as any\r\n            },\r\n            vertexShader: vertexShaderGlow,\r\n            fragmentShader: fragmentShaderGlow,\r\n            side: BackSide,\r\n            blending: AdditiveBlending,\r\n            transparent: true\r\n        });\r\n\r\n        const geometry = new ConeGeometry(sizeCoefficient, sizeCoefficient * 3 * heightCoefficient, 30, 1, true);\r\n        geometry.translate(0, sizeCoefficient * (3 + heightCoefficient - 1), 0);\r\n        if (velocity.x === 0 && velocity.y < 0)\r\n            geometry.rotateZ(MathUtils.degToRad(180));\r\n        else\r\n            geometry.rotateZ(-1 * Math.sign(velocity.x) * new Vector3(0,1, 0).angleTo(velocity.normalize()));\r\n        const glow = new Mesh(geometry, glowMaterial);\r\n        const mesh = new Mesh(geometry.clone(), new MeshBasicMaterial({ color: 0x999999, opacity: 0, transparent: true }));\r\n        mesh.add(glow);\r\n\r\n        mesh.position.copy(shipOnScene.mesh.position);\r\n        this.scene.add(mesh);\r\n        this.exhaustsOnScene.push({mesh: mesh, glow: glow, shipId: ship.shipId});\r\n    }\r\n\r\n    drawPlanet(radius: number): void {\r\n        if (this.planet !== undefined)\r\n            return;\r\n        const material = new MeshPhongMaterial({color: new Color(0.5, 0.5, 0.5), transparent: true, alphaTest: 0.5, side: DoubleSide, alphaMap: this.planetOpacityTex});\r\n        const geometry = new BoxGeometry(1, 1, 1, 2, 2, 2);\r\n        this.planet = new Mesh(geometry, material);\r\n        let size = 2 * radius + 1;\r\n        this.planet.scale.set(size, size, size);\r\n        this.planet.position.set(0, 0, 0);\r\n        const innerPlanetMaterial = new MeshBasicMaterial({ color: new Color(0.02, 0.02, 0.03), opacity: 0.5, transparent: true, side: DoubleSide });\r\n        const innerPlanet = new Mesh(geometry.clone().scale(0.999, 0.999, 0.999), innerPlanetMaterial);\r\n        this.planet.add(innerPlanet);\r\n\r\n        const glowMaterial = new ShaderMaterial({\r\n            uniforms: {\r\n                \"c\":   { type: \"f\", value: 0.9 } as any,\r\n                \"p\":   { type: \"f\", value: 5.6 } as any,\r\n                glowColor: { type: \"c\", value: new Color(0xbbbbbb) } as any,\r\n                viewVector: { type: \"v3\", value: this.camera.position } as any\r\n            },\r\n            vertexShader: vertexShaderGlow,\r\n            fragmentShader: fragmentShaderGlow,\r\n            side: FrontSide,\r\n            blending: AdditiveBlending,\r\n            transparent: true\r\n        });\r\n\r\n        let glowCubeGeom = this.planet.geometry.clone();\r\n\r\n        let glowMesh = new Mesh(glowCubeGeom, glowMaterial);\r\n        glowMesh.scale.multiplyScalar(0.99);\r\n        this.planet.add(glowMesh);\r\n        this.planetGlow = glowMesh;\r\n        this.scene.add(this.planet);\r\n    }\r\n\r\n    drawSafePlace(radius: number): void {\r\n    }\r\n\r\n    drawTrajectories(ships: IShipAndCommands[], showTrajectories: boolean): void {\r\n    }\r\n\r\n    private updateShipsIntermediatePositions() {\r\n        if (this.nextShipsAndCommands === undefined || !this.isAutoPlay)\r\n            return;\r\n        const timeFromTick = +new Date() - this.startTime - this.lastTickTime;\r\n        const fraction = Math.min(timeFromTick / this.timePerTick, 1);\r\n        for (let i = 0; i<this.shipsAndCommands.length; i++) {\r\n            const shipData = this.shipsAndCommands[i].ship;\r\n            const shipId = shipData.shipId;\r\n            const nextShipDataList = this.nextShipsAndCommands.filter(s => s.ship.shipId === shipId);\r\n            if (nextShipDataList.length === 0)\r\n                continue;\r\n            const nextShipData = nextShipDataList[0].ship;\r\n            const ship = this.shipsOnScene[shipId]?.mesh;\r\n            if (ship === undefined)\r\n                continue;\r\n            const gamePos = {\r\n                x: shipData.position.x * (1 - fraction) + nextShipData.position.x * fraction,\r\n                y: shipData.position.y * (1 - fraction) + nextShipData.position.y * fraction\r\n            }\r\n            ship.position.copy(fromGameCoords(gamePos));\r\n            const gameLookAt = {\r\n                x: shipData.velocity.x * (1 - fraction) + nextShipData.velocity.x * fraction,\r\n                y: shipData.velocity.y * (1 - fraction) + nextShipData.velocity.y * fraction\r\n            };\r\n            ship.lookAt(ship.position.clone().add(fromGameCoords(gameLookAt)));\r\n        }\r\n    }\r\n\r\n    private updateLaserPositions() {\r\n        for (let laserData of this.laserLinesOnScene) {\r\n            const laser = laserData.laser;\r\n            const ship = this.shipsOnScene[laserData.shipId];\r\n            if (ship === undefined)\r\n                continue;\r\n            const from = ship.mesh.position;\r\n            const to = laserData.target;\r\n            laser.scale.setY(from.distanceTo(to) / (laser.geometry as CylinderGeometry).parameters.height);\r\n            laser.position.copy(from.clone().add(to).multiplyScalar(0.5));\r\n            laser.lookAt(to);\r\n            laser.rotateOnAxis(new Vector3(1, 0, 0), MathUtils.degToRad(90));\r\n        }\r\n    }\r\n\r\n    setNextShipInView(previous: boolean | undefined = undefined) {\r\n        this.isGeneralView = false;\r\n        const shipsKeys = this.shipsOnScene === undefined ? undefined : Object.keys(this.shipsOnScene);\r\n        if (shipsKeys === undefined || shipsKeys.length === 0)\r\n            return;\r\n        if (this.shipIdInView === undefined) {\r\n            this.shipIdInView = +shipsKeys[0];\r\n            this.updateShipInViewFlyClockwise();\r\n            return;\r\n        }\r\n        let nextShipId = !previous\r\n            // @ts-ignore\r\n            ? shipsKeys.find(k => +k > this.shipIdInView)\r\n            // @ts-ignore\r\n            : shipsKeys.reverse().find(k => +k < this.shipIdInView);\r\n        if (nextShipId === undefined) {\r\n            if (!previous)\r\n                this.shipIdInView = +shipsKeys[0];\r\n            else\r\n                this.shipIdInView = +shipsKeys[shipsKeys.length - 1];\r\n        } else\r\n            this.shipIdInView = +nextShipId;\r\n        this.updateShipInViewFlyClockwise();\r\n    }\r\n\r\n    private updateShipInViewFlyClockwise() {\r\n        if (this.shipIdInView === undefined)\r\n            return;\r\n        let shipDataList = this.shipsAndCommands.filter(s => s.ship.shipId === this.shipIdInView);\r\n        if (shipDataList.length === 0)\r\n            return;\r\n        let shipData = shipDataList[0];\r\n        let position = fromGameCoords(shipData.ship.position);\r\n        let velocity = fromGameCoords(shipData.ship.velocity);\r\n        if (velocity.x === 0 && velocity.y === 0 && this.nextShipsAndCommands !== undefined) {\r\n            shipDataList = this.nextShipsAndCommands.filter(s => s.ship.shipId === this.shipIdInView);\r\n            shipData = shipDataList[0];\r\n            position = fromGameCoords(shipData.ship.position);\r\n            velocity = fromGameCoords(shipData.ship.velocity);\r\n        }\r\n        this.shipInViewFlyClockwise = (position.x < 0 && velocity.y > 0) || (position.x > 0 && velocity.y < 0)\r\n            || (velocity.y === 0 && ((position.y < 0 && velocity.x < 0) || (position.y > 0 && velocity.x > 0)));\r\n    }\r\n\r\n    setPreviousShipInView() {\r\n        this.setNextShipInView(true);\r\n    }\r\n\r\n    switchGeneralView() {\r\n        this.isGeneralView = !this.isGeneralView;\r\n        if (!this.isGeneralView && this.shipIdInView === undefined) {\r\n            this.shipIdInView = +Object.keys(this.shipsOnScene)[0];\r\n            this.updateShipInViewFlyClockwise();\r\n        }\r\n        this.cameraRotationLon = 0;\r\n        this.cameraRotationLat = 0;\r\n    }\r\n\r\n    private setCameraNotRotated() {\r\n        if (this.isGeneralView) {\r\n            this.cameraPosition = new Vector3(25, -75, 35);\r\n            this.lookAt = new Vector3();\r\n        }\r\n        else {\r\n            const shipInView = this.shipIdInView === undefined ? undefined : this.shipsOnScene[this.shipIdInView];\r\n            if (shipInView === undefined) {\r\n                return;\r\n            }\r\n            const normal = shipInView.mesh.position.clone().cross(new Vector3(0, 0, 1)).normalize();\r\n            const sign = this.shipInViewFlyClockwise ? -1 : 1;\r\n            this.cameraPosition = shipInView.mesh.position.clone()\r\n                .add(normal.multiplyScalar(sign * 5))\r\n                .add(shipInView.mesh.position.clone().normalize().multiplyScalar(3));\r\n            this.lookAt = shipInView.mesh.position.clone();\r\n        }\r\n    }\r\n\r\n    private updateCamera() {\r\n        this.setCameraNotRotated();\r\n\r\n        this.cameraRotationLat += this.cameraRotationLatDelta * this.dampingFactor;\r\n        this.cameraRotationLon += this.cameraRotationLonDelta * this.dampingFactor;\r\n        this.cameraRotationLat = Math.max(-89, Math.min(89, this.cameraRotationLat));\r\n        this.cameraRotationLonDelta *= (1 - this.dampingFactor);\r\n        this.cameraRotationLatDelta *= (1 - this.dampingFactor);\r\n\r\n        const zoomFactor = 1.0 - this.zoomDelta * this.zoomDampingFactor;\r\n        this.zoom = Math.min(Math.max(this.zoom * zoomFactor, this.minZoom), this.maxZoom);\r\n        this.zoomDelta += - this.zoomDelta * this.zoomDampingFactor;\r\n\r\n        const cameraToLookAt = this.cameraPosition.clone().sub(this.lookAt);\r\n        const cameraDistance = cameraToLookAt.length() * this.zoom;\r\n        const notRotatedLat = MathUtils.radToDeg(Math.asin(cameraToLookAt.z / cameraDistance));\r\n        const notRotatedLon = MathUtils.radToDeg(Math.atan2(cameraToLookAt.y, cameraToLookAt.x));\r\n\r\n        const cameraLat = Math.max(-89, Math.min(89, this.cameraRotationLat + notRotatedLat));\r\n        const cameraLon = this.cameraRotationLon + notRotatedLon;\r\n\r\n        const latRad = MathUtils.degToRad(cameraLat);\r\n        const lonRad = MathUtils.degToRad(cameraLon);\r\n        this.camera.position.x = this.lookAt.x + cameraDistance * Math.cos(latRad) * Math.cos(lonRad);\r\n        this.camera.position.y = this.lookAt.y + cameraDistance * Math.cos(latRad) * Math.sin(lonRad);\r\n        this.camera.position.z = this.lookAt.z + cameraDistance * Math.sin(latRad);\r\n        this.camera.up = new Vector3(0, 0, 1);\r\n        this.camera.lookAt(this.lookAt);\r\n\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    private updateRenderer() {\r\n        let rendererSize: Vector2 = new Vector2();\r\n        this.renderer.getSize(rendererSize);\r\n        const isFullScreen = document.fullscreenElement !== null;\r\n        const width = (!isFullScreen ? this.canvas.width : window.screen.width);\r\n        const height = (!isFullScreen ? this.canvas.height : window.screen.height);\r\n        if (rendererSize.width !== width || rendererSize.height !== height) {\r\n            this.renderer.setSize(width, height);\r\n            this.bloomComposer.setSize(width, height);\r\n            this.camera.aspect = width / height;\r\n            this.camera.updateProjectionMatrix();\r\n            this.fxaaPass.material.uniforms['resolution'].value.x = 1 / (width);\r\n            this.fxaaPass.material.uniforms['resolution'].value.y = 1 / (height);\r\n        }\r\n    }\r\n\r\n    private updateGlows() {\r\n        const timeFromTick = +new Date() - this.startTime - this.lastTickTime;\r\n        const fraction = Math.min(timeFromTick / this.timePerTick, 1);\r\n        if (this.planetGlow !== undefined) {\r\n            this.updateGlow(this.planetGlow);\r\n        }\r\n        for (const laserData of this.laserLinesOnScene) {\r\n            const glow = laserData.glow;\r\n            this.updateGlow(glow);\r\n            if (this.isAutoPlay) {\r\n                const uniforms = (glow.material as ShaderMaterial).uniforms;\r\n                uniforms.c = {type: \"f\", value: 0.5 * Math.max(1 - fraction * 3, 0)} as any;\r\n            }\r\n        }\r\n    }\r\n\r\n    private updateGlow(glow: Mesh) {\r\n        let worldPosition = new Vector3();\r\n        worldPosition = glow.getWorldPosition(worldPosition);\r\n        (glow.material as ShaderMaterial).uniforms.viewVector.value\r\n            = new Vector3().subVectors(this.camera.position, worldPosition);\r\n    }\r\n\r\n    private updateExhausts() {\r\n        const timeFromTick = +new Date() - this.startTime - this.lastTickTime;\r\n        const fraction = Math.min(timeFromTick / this.timePerTick, 1);\r\n        for (const exhaust of this.exhaustsOnScene) {\r\n            const glow = exhaust.glow;\r\n            this.updateGlow(glow);\r\n            if (this.isAutoPlay) {\r\n                const uniforms = (glow.material as ShaderMaterial).uniforms;\r\n                const delay = 0.6;\r\n                const coef = fraction < delay ? 0 : Math.max(1 - (fraction - delay) / (1 - delay), 0);\r\n                uniforms.glowColor = { type: \"c\", value: new Color(0.6 * coef, 0.5 * coef, 0.5 * coef) } as any;\r\n                (exhaust.mesh.material as MeshBasicMaterial).opacity = 0.25 * coef;\r\n                const ship = this.shipsOnScene[exhaust.shipId];\r\n                if (ship === undefined)\r\n                    continue;\r\n                exhaust.mesh.position.copy(ship.mesh.position);\r\n            }\r\n        }\r\n    }\r\n\r\n    private updateExplosions() {\r\n        if (this.isAutoPlay) {\r\n            const timeFromTick = +new Date() - this.startTime - this.lastTickTime;\r\n            const fraction = Math.min(timeFromTick / this.timePerTick, 1);\r\n            for (const mixer of this.mixers) {\r\n                mixer.setTime(fraction);\r\n            }\r\n        }\r\n    }\r\n\r\n    private fixShootRadiiSphereOpacity() {\r\n        for (const shoot of this.laserShootRadiiOnScene) {\r\n            const outerSphere = shoot.shoot;\r\n            const innerSphere = shoot.innerSphere;\r\n            innerSphere.position.copy(outerSphere.position.clone().sub(this.camera.position).normalize().multiplyScalar(0.01));\r\n        }\r\n        for (const detonation of this.detonationsOnScene) {\r\n            const outerSphere = detonation.outerSphere;\r\n            const innerSphere = detonation.innerSphere;\r\n            innerSphere.position.copy(outerSphere.position.clone().sub(this.camera.position).normalize().multiplyScalar(0.01));\r\n        }\r\n    }\r\n\r\n    private render() {\r\n        this.updateShipsIntermediatePositions();\r\n        this.updateLaserPositions();\r\n        this.updateGlows();\r\n        this.updateExplosions();\r\n        this.updateExhausts();\r\n        if (+new Date() - this.startTime - this.lastTickTime > this.timePerTick) {\r\n            for (let i=0; i<this.mixers.length; i++) {\r\n                this.mixers[i].stopAllAction();\r\n            }\r\n            this.mixers = [];\r\n        }\r\n        this.updateCamera();\r\n        this.fixShootRadiiSphereOpacity();\r\n        this.updateRenderer();\r\n        this.bloomComposer.render();\r\n    }\r\n\r\n    private drawStarsSphere() {\r\n        const material = new MeshBasicMaterial({map: this.skyTex, side: BackSide});\r\n        const geometry = new SphereGeometry(2000, 24, 24);\r\n        const sphere = new Mesh(geometry, material);\r\n        sphere.lookAt(0, 1, 0);\r\n        this.scene.add(sphere);\r\n    }\r\n\r\n    setTimePerTick(timePerTick: number): void {\r\n        this.timePerTick = timePerTick;\r\n    }\r\n\r\n    shipColor(ship: IShip) {\r\n        return ship.role === ApiPlayerRole.Defender ? 0x40FFFD : 0xFFC573;\r\n    }\r\n}\r\n\r\nfunction fromGameCoords(coords: V) : Vector3 {\r\n    return new Vector3(coords.x, -coords.y, 0);\r\n}\r\n\r\nconst vertexShaderGlow = `\r\nuniform vec3 viewVector;\r\nuniform float c;\r\nuniform float p;\r\nvarying float intensity;\r\nvoid main()\r\n{\r\n    vec3 vNormal = normalize( normalMatrix * normal );\r\n    vec3 vNormel = normalize( normalMatrix * viewVector );\r\n    intensity = pow( c - dot(vNormal, vNormel), p );\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}`;\r\nconst fragmentShaderGlow = `\r\nuniform vec3 glowColor;\r\nvarying float intensity;\r\nvoid main()\r\n{\r\n    vec3 glow = glowColor * intensity;\r\n    gl_FragColor = vec4( glow, 1.0 );\r\n}`;","import IRenderer from \"./IRenderer\";\r\nimport {IShipAndCommands} from \"./GameLogModels\";\r\nimport Renderer2d from \"./Renderer2d\";\r\nimport Renderer3d from \"./Renderer3d\";\r\n\r\nexport default class Renderer2dAnd3d implements IRenderer {\r\n    renderer2d: IRenderer;\r\n    renderer3d: IRenderer;\r\n\r\n    constructor(renderer2d: Renderer2d, renderer3d: Renderer3d) {\r\n        this.renderer2d = renderer2d;\r\n        this.renderer3d = renderer3d;\r\n    }\r\n\r\n    setTimePerTick(timePerTick: number): void {\r\n        this.renderer2d.setTimePerTick(timePerTick);\r\n        this.renderer3d.setTimePerTick(timePerTick);\r\n    }\r\n\r\n    adjustScale(ships: IShipAndCommands[]): void {\r\n        this.renderer2d.adjustScale(ships);\r\n        this.renderer3d.adjustScale(ships);\r\n    }\r\n\r\n    clearSpace(): void {\r\n        this.renderer2d.clearSpace();\r\n        this.renderer3d.clearSpace();\r\n    }\r\n\r\n    drawShipsAndCommands(prevShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         shipsAndCommands: IShipAndCommands[],\r\n                         nextShipsAndCommands: IShipAndCommands[] | undefined,\r\n                         isAutoPlay: boolean, getShootRadius: (power: number, powerDecrease: number) => number): void {\r\n        this.renderer2d.drawShipsAndCommands(prevShipsAndCommands, shipsAndCommands, nextShipsAndCommands, isAutoPlay, getShootRadius);\r\n        this.renderer3d.drawShipsAndCommands(prevShipsAndCommands, shipsAndCommands, nextShipsAndCommands, isAutoPlay, getShootRadius);\r\n    }\r\n\r\n    drawPlanet(radius: number): void {\r\n        this.renderer2d.drawPlanet(radius);\r\n        this.renderer3d.drawPlanet(radius);\r\n    }\r\n\r\n    drawSafePlace(radius: number): void {\r\n        this.renderer2d.drawSafePlace(radius);\r\n        this.renderer3d.drawSafePlace(radius);\r\n    }\r\n\r\n    drawTrajectories(ships: IShipAndCommands[], showTrajectories: boolean): void {\r\n        this.renderer2d.drawTrajectories(ships, showTrajectories);\r\n        this.renderer3d.drawTrajectories(ships, showTrajectories);\r\n    }\r\n}","import convertGameLog from './GameLogConverter';\r\nimport Renderer2d from './Renderer2d';\r\nimport Renderer3d from './Renderer3d';\r\nimport Renderer2dAnd3d from './Renderer2dAnd3d';\r\nimport {\r\n    ApiPlayerRole,\r\n    ILogData,\r\n    IShip,\r\n    ITick,\r\n} from \"./GameLogModels\";\r\nimport IRenderer from \"./IRenderer\";\r\n\r\nexport default function run(logData: ILogData, canvasDelta: number, done?: () => void) {\r\n    const canvas2dElement = document.getElementById(\"field2d\");\r\n    const canvas3dElement = document.getElementById(\"field3d\");\r\n    const consoleElement = document.getElementById(\"console\");\r\n\r\n    if (!canvas2dElement || !canvas3dElement || !consoleElement) return;\r\n\r\n    const timePerTick2dDefault = 100;\r\n    const timePerTick3dDefault = 1000;\r\n\r\n    let is2d = true;\r\n    let timePerTick = timePerTick2dDefault;\r\n\r\n    const canvas2d = canvas2dElement as HTMLCanvasElement;\r\n    const maybeCtx2d = canvas2d.getContext('2d');\r\n    if (!maybeCtx2d) return;\r\n    const ctx2d = maybeCtx2d as CanvasRenderingContext2D;\r\n    const renderer2d = new Renderer2d(ctx2d, canvas2d);\r\n\r\n    const canvas3d = canvas3dElement as HTMLCanvasElement;\r\n    const maybeCtx3d = canvas3d.getContext('webgl');\r\n    if (!maybeCtx3d) return;\r\n    const ctx3d = maybeCtx3d as WebGLRenderingContext;\r\n    const renderer3d = new Renderer3d(ctx3d, canvas3d, timePerTick, simulate);\r\n    canvas3d.hidden = true;\r\n\r\n    const renderer = new Renderer2dAnd3d(renderer2d, renderer3d) as IRenderer;\r\n\r\n    let index = 0;\r\n    let log = convertGameLog(logData);\r\n    let factualTicksLength = log.gameLog?.ticks.length === undefined ? 0 : log.gameLog.ticks.length;\r\n    addLastTicks();\r\n    let showTrajectories = true;\r\n    let autoPlayTimerId: number = 0;\r\n    let isAutoPlay = false;\r\n    let lastMouseDownTime : number | null = null;\r\n\r\n    const wheelSpeed = 0.0005;\r\n\r\n    const resizeListener = () => {\r\n        resize();\r\n        update();\r\n    };\r\n    window.addEventListener('resize', resizeListener);\r\n\r\n    document.body.addEventListener('keydown', keydown);\r\n    canvas2d.addEventListener('mousedown', onMouseDown);\r\n    canvas3d.addEventListener('mousedown', onMouseDown);\r\n    canvas2d.addEventListener('mouseup', onMouseUp);\r\n    canvas3d.addEventListener('mouseup', onMouseUp);\r\n    canvas3d.addEventListener('wheel', onWheel);\r\n\r\n    resize();\r\n    update();\r\n    startAutoplay();\r\n\r\n    function addLastTicks() {\r\n        if (!log.gameLog)\r\n            return;\r\n        const count = 5;\r\n        const lastTick = log.gameLog.ticks[factualTicksLength - 1];\r\n        for (let i=0; i<count; i++)\r\n            log.gameLog.ticks.push({tick: factualTicksLength + i, ships: []});\r\n        for (const shipAndCommands of lastTick.ships) {\r\n            const result = simulate(shipAndCommands.ship, count);\r\n            for (let i=0; i<count; i++) {\r\n                const sac = {ship: {...shipAndCommands.ship, position: result[i]}, appliedCommands: []};\r\n                log.gameLog.ticks[factualTicksLength + i].ships.push(sac);\r\n            }\r\n        }\r\n    }\r\n\r\n    function resize() {\r\n        canvas2d.width = window.innerWidth - 64;\r\n        canvas2d.height = window.innerHeight - 260 + canvasDelta;\r\n        canvas3d.width = window.innerWidth - 64;\r\n        canvas3d.height = window.innerHeight - 260 + canvasDelta;\r\n    }\r\n\r\n    function onWheel(ev: WheelEvent) {\r\n        if (!log.gameLog || is2d) return;\r\n        if (ev.deltaY > 0) {\r\n            renderer3d.setZoomDelta(ev.deltaY * wheelSpeed);\r\n        } else {\r\n            renderer3d.setZoomDelta(-1 + 1 / (1 - ev.deltaY * wheelSpeed));\r\n        }\r\n        ev.preventDefault();\r\n        return false;\r\n    }\r\n\r\n    function keydown(ev: KeyboardEvent) {\r\n        if (!log.gameLog) return;\r\n        const code = ev.code;\r\n        if (code === \"ArrowRight\" || code === \"KeyD\") {\r\n            rewind(1, factualTicksLength);\r\n            stopAutoplay();\r\n        } else if (code === \"ArrowLeft\" || code === \"KeyA\") {\r\n            rewind(-1, factualTicksLength);\r\n            stopAutoplay();\r\n        } else if (code === \"Home\" || code === \"KeyQ\") {\r\n            index = 0;\r\n            stopAutoplay();\r\n            if (!is2d) {\r\n                renderer3d.isGeneralView = true;\r\n                renderer3d.cameraRotationLon = 0;\r\n                renderer3d.cameraRotationLat = 0;\r\n            }\r\n        } else if (code === \"End\" || code === \"KeyE\") {\r\n            index = factualTicksLength - 1;\r\n            stopAutoplay();\r\n        } else if (code === \"Equal\") {\r\n            if (is2d)\r\n                renderer2d.cellSize *= 1.2;\r\n            else {\r\n                renderer3d.setZoomDelta(-0.02);\r\n                return;\r\n            }\r\n        } else if (code === \"Minus\") {\r\n            if (is2d) {\r\n                if (renderer2d.cellSize > 0.4)\r\n                    renderer2d.cellSize /= 1.2;\r\n            }\r\n            else {\r\n                renderer3d.setZoomDelta(0.02);\r\n                return;\r\n            }\r\n        }\r\n        else if (code === \"Comma\") {\r\n            timePerTick = Math.min(1000, timePerTick + 10);\r\n            stopAutoplay();\r\n            startAutoplay();\r\n        } else if (code === \"Period\") {\r\n            timePerTick = Math.max(20, timePerTick - 10);\r\n            stopAutoplay();\r\n            startAutoplay();\r\n        } else if (code === \"KeyP\" || code === \"Space\") {\r\n            if (autoPlayTimerId)\r\n                stopAutoplay();\r\n            else\r\n                startAutoplay();\r\n        } else if (code === \"Digit1\") {\r\n            const instruction = document.getElementsByClassName(\"instruction\")[0];\r\n            canvas3d.hidden = !is2d;\r\n            canvas2d.hidden = is2d;\r\n            if (is2d) {\r\n                timePerTick = timePerTick3dDefault;\r\n                instruction.classList.add(\"only3d\");\r\n                renderer3d.notDrawShips = false;\r\n            } else {\r\n                timePerTick = timePerTick2dDefault;\r\n                instruction.classList.remove(\"only3d\");\r\n            }\r\n            is2d = !is2d;\r\n            renderer.setTimePerTick(timePerTick);\r\n            if (isAutoPlay) {\r\n                stopAutoplay();\r\n                startAutoplay();\r\n            }\r\n        } else if (code === \"KeyW\" || code === \"KeyS\" || code === \"KeyZ\") {\r\n            if (is2d)\r\n                return;\r\n            if (code === \"KeyZ\")\r\n                renderer3d.switchGeneralView();\r\n            else if (code === \"KeyW\")\r\n                renderer3d.setNextShipInView();\r\n            else\r\n                renderer3d.setPreviousShipInView();\r\n        } else if (code === \"Enter\" && !is2d) {\r\n            const c = canvas3d as any;\r\n            if (document.fullscreenElement === null) {\r\n                if (canvas3d.requestFullscreen)\r\n                    canvas3d.requestFullscreen();\r\n                else if (c.webkitRequestFullscreen)\r\n                    c.webkitRequestFullscreen();\r\n                else if (c.mozRequestFullscreen)\r\n                    c.mozRequestFullscreen();\r\n            }\r\n        }\r\n        else\r\n            return;\r\n        ev.preventDefault();\r\n        update();\r\n    }\r\n\r\n    function stopAutoplay() {\r\n        clearTimeout(autoPlayTimerId);\r\n        isAutoPlay = false;\r\n        autoPlayTimerId = 0;\r\n    }\r\n\r\n    function startAutoplay() {\r\n        isAutoPlay = true;\r\n        autoPlayTimerId = setInterval(autoplayTick, timePerTick) as any as number;\r\n    }\r\n\r\n    function autoplayTick() {\r\n        if (!log.gameLog)\r\n            return;\r\n        rewind(1, log.gameLog.ticks.length);\r\n        update();\r\n        if (index >= (is2d ? factualTicksLength : log.gameLog.ticks.length - 1)) {\r\n            stopAutoplay();\r\n            if (done) {\r\n                window.removeEventListener('resize', resizeListener);\r\n                document.body.removeEventListener('keydown', keydown);\r\n                canvas2d.removeEventListener('click', click);\r\n                canvas3d.removeEventListener('click', click);\r\n                done();\r\n            }\r\n        }\r\n    }\r\n\r\n    function click() {\r\n        showTrajectories = !showTrajectories;\r\n        update();\r\n    }\r\n\r\n    function onMouseDown() {\r\n        lastMouseDownTime = Date.now();\r\n    }\r\n\r\n    function onMouseUp() {\r\n        if (lastMouseDownTime == null || Date.now() - lastMouseDownTime > 200) // not move\r\n            return;\r\n        lastMouseDownTime = null;\r\n        click();\r\n    }\r\n\r\n    function rewind(dir: 1 | -1, ticksCount: number) {\r\n        if (!log.gameLog) return\r\n        index = Math.min(ticksCount - 1, Math.max(0, index + dir));\r\n    }\r\n\r\n    function update() {\r\n        if (!log.gameLog) return;\r\n        const hasNextTick = index < log.gameLog.ticks.length - 1;\r\n        const hasPrevTick = index > 0;\r\n        drawEvent(hasPrevTick ? log.gameLog.ticks[index - 1] : undefined,\r\n            log.gameLog.ticks[index],\r\n            hasNextTick ? log.gameLog.ticks[index + 1] : undefined, isAutoPlay);\r\n    }\r\n\r\n    function drawEvent(prevTick: ITick | undefined, tick: ITick, nextTick: ITick | undefined, isAutoPlay: boolean) {\r\n        const ships = tick.ships;\r\n\r\n        renderer.adjustScale(ships);\r\n        renderer.clearSpace();\r\n        if (log.gameLog && log.gameLog.planet && log.gameLog.planet.safeRadius >= 0)\r\n            renderer.drawSafePlace(log.gameLog.planet.safeRadius);\r\n        if (log.gameLog && log.gameLog.planet && log.gameLog.planet.radius >= 0)\r\n            renderer.drawPlanet(log.gameLog.planet.radius);\r\n        renderer.drawTrajectories(ships, showTrajectories);\r\n        renderer.drawShipsAndCommands(prevTick?.ships, ships, nextTick?.ships, isAutoPlay, getShootRadius);\r\n        if (index < factualTicksLength) {\r\n            let consoleShips = `${tick.tick}`;\r\n            for (const ship of ships) {\r\n                consoleShips += `<p style=\"color: ${shipColor(ship.ship)}\">${JSON.stringify(ship)}</p>`;\r\n            }\r\n            if (consoleElement) {\r\n                consoleElement.innerHTML = consoleShips;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function simulate(ship: IShip, ticks: number, hasPlanet: boolean = true) {\r\n    const points = [];\r\n    const reversed = Math.sign(ticks);\r\n    const s = {\r\n        position: ship.position,\r\n        velocity: {\r\n            x: ship.velocity.x * reversed,\r\n            y: ship.velocity.y * reversed\r\n        },\r\n    };\r\n    for (let i = 0; i < Math.abs(ticks); i++) {\r\n        const dx = Math.abs(s.position.x);\r\n        const dy = Math.abs(s.position.y);\r\n        const maxD = Math.max(dx, dy);\r\n        const newV = { ...s.velocity };\r\n        if (hasPlanet) {\r\n            if (dx === maxD)\r\n                newV.x -= Math.sign(s.position.x) * reversed;\r\n            if (dy === maxD)\r\n                newV.y -= Math.sign(s.position.y) * reversed;\r\n        }\r\n        s.velocity = newV;\r\n        s.position = { x: s.position.x + s.velocity.x, y: s.position.y + s.velocity.y };\r\n        points.push(s.position);\r\n    }\r\n    return points;\r\n}\r\n\r\nfunction getShootRadius(power: number, powerDecrease: number) {\r\n    let r = 0;\r\n    let p = power;\r\n    while (p !== 0) {\r\n        r++;\r\n        p = Math.floor(p / powerDecrease);\r\n    }\r\n    return r - 1;\r\n}\r\n\r\nfunction shipColor(ship: IShip) {\r\n    return ship.role === ApiPlayerRole.Defender ? 'teal' : 'orange';\r\n}","export default function getQueryParams() {\r\n    return window.location.hash\r\n        .replace(/#\\/[^?]*\\?/, '')\r\n        .split('&')\r\n        .map(i => i.split('='))\r\n        .reduce((acc, item) => {\r\n            acc[item[0].toLowerCase()] = item[1];\r\n            return acc;\r\n        }, {} as { [key: string]: string });\r\n}\r\n","import VisualizerPage from './VisualizerPage';\r\nexport default VisualizerPage;\r\n","import React from 'react';\r\nimport './styles.css';\r\nimport run from './Visualizer';\r\nimport getQueryParams from '../../utils/getQueryParams';\r\nimport {games} from '../../consts/api';\r\nimport createQueryString from '../../utils/createQueryString';\r\nimport GameDto, {GameWinner} from '../../models/GameDto';\r\n\r\ninterface VisualizerPageProps {\r\n    apiKey?: string | null;\r\n}\r\n\r\nexport default class VisualizerPage extends React.Component<VisualizerPageProps> {\r\n    componentDidMount() {\r\n        this.runGame();\r\n    }\r\n\r\n    runGame() {\r\n        const queries = getQueryParams()\r\n        const gameId = queries['game'];\r\n        const playerKey = queries['playerkey'];\r\n        const autoGames = queries['autogames'];\r\n\r\n        if (autoGames) {\r\n            this.runAutoGames();\r\n            return;\r\n        }\r\n        \r\n        if (gameId || playerKey) {\r\n            this.getLog(gameId, playerKey);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const queries = getQueryParams()\r\n        const gameId = queries['game'];\r\n        const gray = { color: 'gray' }\r\n        const autoGames = queries['autogames'];\r\n        return (\r\n            <div id='visualizerWrapper'>\r\n                {!autoGames && <ul className={'instruction'}  >\r\n                    <li><span style={ gray }>Controls:</span> A D Q E <span style={ gray }>/</span> ← → Home End</li>\r\n                    <li><span style={ gray }>Autoplay:</span> Space , . -</li>\r\n                    <li><span style={ gray }>Zoom:</span> + -</li>\r\n                    <li><span style={ gray }>2D/3D:</span> 1</li>\r\n                    <li className={ 'only2dcontrol' }><span style={ gray }>Trajectories:</span> click</li>\r\n                    <li className={ 'only3dcontrol' }><span style={ gray }>3D camera:</span> W S Z</li>\r\n                    <li className={ 'only3dcontrol' }><span style={ gray }>Fullscreen:</span> Enter</li>\r\n                </ul>}\r\n                {gameId && <h3 id='title'>&nbsp;</h3>}\r\n                <canvas id='field2d' width={800} height={500}/>\r\n                <canvas id='field3d' width={800} height={500}/>\r\n                <div id='console'/>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    runAutoGames = async () => {\r\n        const {apiKey} = this.props;\r\n        if (!apiKey) return;\r\n\r\n        const gameIds: string[] = await fetch(`${games}/interesting-games/?${createQueryString({apiKey})}`).then(res => res.json());\r\n        for (let gameId of gameIds) {            \r\n            let promise = new Promise((resolve) => {\r\n                this.getLog(gameId, undefined, () => { resolve() })\r\n            });\r\n            await promise;            \r\n        }        \r\n        this.runAutoGames();\r\n    }\r\n    \r\n    getLog = async (gameId?: string, playerKey?: string, done?: (() => void)) => {\r\n        if (gameId) {\r\n            try {\r\n                const requestUrl = `${games}/log?${createQueryString({gameId})}`;\r\n                const response = await fetch(requestUrl).then(res => res.text());\r\n                const log = response.replace(/\\(/g, '[').replace(/\\)/g, ']');\r\n\r\n                const gameRequestUrl = `${games}/${gameId}?${createQueryString({})}`;\r\n                const gameResponse = await fetch(gameRequestUrl).then(res => res.json());\r\n\r\n                run(JSON.parse(log), done ? 50 : 0, done);\r\n                this.renderTitle(gameResponse);\r\n\r\n            } catch (e) {\r\n                if (done)\r\n                    done();                \r\n            }\r\n\r\n            return\r\n        }\r\n\r\n        if (playerKey) {\r\n            try {\r\n                const requestUrl = `${games}/log?${createQueryString({playerKey})}`;\r\n                const response = await fetch(requestUrl).then(res => res.text());\r\n                const log = response.replace(/\\(/g, '[').replace(/\\)/g, ']');\r\n\r\n                run(JSON.parse(log), done ? 200 : 40, done);\r\n\r\n            } catch (e) {\r\n                if (done)\r\n                    done();\r\n            }\r\n\r\n            return\r\n        }\r\n    }\r\n\r\n    renderTitle(game: GameDto) {\r\n        const title = document.getElementById('title');\r\n        if (!title) return;\r\n\r\n        const attackerName = game.attacker.team.teamName;\r\n        const defenderName = game.defender.team.teamName;\r\n\r\n        const winner = (game.winner && game.winner !== GameWinner.Nobody) ? game.winner : null;\r\n\r\n        const attacker = `<span class=\"attacker ${winner === GameWinner.Defender ? 'streak' : ''}\">${attackerName}</span>`;\r\n        const defender = `<span class=\"defender ${winner === GameWinner.Attacker ? 'streak' : ''}\">${defenderName}</span>`;\r\n        title.innerHTML = `${defender} vs ${attacker}`;\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { HashRouter as Router, Route, Switch } from 'react-router-dom';\r\nimport styles from './styles.module.css';\r\nimport Header from '../Header';\r\nimport Team from '../../models/Team';\r\nimport { API_KEY } from '../../consts/strings';\r\nimport Error from '../Error'\r\nimport AppRouter from './AppRouter';\r\nimport listenEvents, { EventType, IListener } from '../../utils/eventsListener';\r\nimport { ROUTES } from '../../consts/routes';\r\nimport VisualizerPage from '../VisualizerPage';\r\nimport getQueryParams from '../../utils/getQueryParams';\r\n\r\n\r\ninterface AppProps {\r\n    apiKey: string | null;\r\n    team: Team | null;\r\n    error: Error | string | null;\r\n    updateApiKey: (apiKey: string | null) => void;\r\n    updateTeam: (team: Team | null) => void;\r\n    loadTeam: () => void;\r\n    setError: (err: Error | string | null) => void;\r\n    loadSubmissions: () => void;\r\n    loadLightningScoreboard: () => void;\r\n    loadScoreboard: () => void;\r\n    loadNonRatingGames: () => void;\r\n}\r\n\r\ninterface AppState {\r\n    hasApiKey: boolean;\r\n    apiKey?: string | null;\r\n}\r\n\r\nclass App extends React.Component<AppProps, AppState> {\r\n    private listener?: IListener;\r\n\r\n    constructor(props: AppProps) {\r\n        super(props);\r\n\r\n        let apiKey = getApiKey();\r\n        this.state = {\r\n            hasApiKey: Boolean(apiKey),\r\n            apiKey: apiKey,\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let apiKey = getApiKey();\r\n\r\n        if (!apiKey) return;\r\n\r\n        this.props.updateApiKey(apiKey);\r\n        this.props.loadTeam();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.listener && this.listener.close();\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<AppProps>) {\r\n        const addTeam = !prevProps.team && Boolean(this.props.team);\r\n        const delTeam = Boolean(prevProps.team) && !this.props.team;\r\n\r\n        if (delTeam) {\r\n            this.listener && this.listener.close();\r\n        }\r\n        if (addTeam) {\r\n            this.addListeners();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { hasApiKey, apiKey } = this.state;\r\n        const { team, error } = this.props;\r\n\r\n        const loading = hasApiKey && !team;\r\n        return (\r\n            <>\r\n                <Router>\r\n                    <Switch>\r\n                        <Route path={ ROUTES.visualize } children={ () =>\r\n                            <VisualizerPage apiKey={ apiKey }/>\r\n                        }/>\r\n                        <Route>\r\n                            <div className={ styles.container }>\r\n                                <Header team={ team }\r\n                                        isTeamLoading={ loading }\r\n                                        logout={ this.deleteApiKey }/>\r\n                                <div className={ styles.narrowContainer }>\r\n                                    <AppRouter team={ team }\r\n                                               isTeamLoading={ loading }\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </Route>\r\n                    </Switch>\r\n                </Router>\r\n\r\n                { error !== null && <Error error={ error } closeError={ this.closeError }/> }\r\n            </>\r\n        );\r\n    }\r\n\r\n\r\n    deleteApiKey = () => {\r\n        try {\r\n            const storageApiKey = window.localStorage.getItem(API_KEY);\r\n            if (storageApiKey === this.props.apiKey) {\r\n                window.localStorage.removeItem(API_KEY);\r\n            }\r\n        } catch (e) {\r\n            /*...*/\r\n        }\r\n\r\n        this.setState({ hasApiKey: false });\r\n        this.props.updateApiKey(null);\r\n        this.props.updateTeam(null);\r\n    }\r\n\r\n    closeError = () => {\r\n        this.props.setError(null);\r\n    }\r\n\r\n    addListeners() {\r\n        if (!this.props.apiKey) return;\r\n\r\n        this.listener = listenEvents(this.props.apiKey, (eventType, payload) => {\r\n            if (!payload) return;\r\n            switch (eventType) {\r\n                case EventType.Submission:\r\n                    return this.props.loadSubmissions();\r\n                case EventType.Team:\r\n                    return this.props.loadTeam();\r\n                case EventType.LightningScoreboard:\r\n                    return this.props.loadLightningScoreboard();\r\n                case EventType.Scoreboard:\r\n                    return this.props.loadScoreboard();\r\n                case EventType.NonRatingGame:\r\n                    return this.props.loadNonRatingGames();\r\n            }\r\n        })\r\n\r\n        this.listener.subscribe(EventType.Submission);\r\n        this.listener.subscribe(EventType.Team);\r\n        this.listener.subscribe(EventType.LightningScoreboard);\r\n        this.listener.subscribe(EventType.Scoreboard);\r\n        this.listener.subscribe(EventType.NonRatingGame);\r\n    }\r\n}\r\n\r\nexport default App;\r\n\r\nfunction getApiKey() {\r\n    let apiKey;\r\n    try {\r\n        const urlParams = getQueryParams();\r\n        \r\n        if (urlParams['apikey']) {\r\n            apiKey = urlParams['apikey'];\r\n            window.localStorage.setItem(API_KEY, apiKey);\r\n        } else {\r\n            apiKey = window.localStorage.getItem(API_KEY);\r\n        }\r\n    } catch (e) {\r\n        /*...*/\r\n    }\r\n    \r\n    return apiKey;\r\n}\r\n","import App from './App';\r\nexport default App;\r\n","import { connect } from 'react-redux';\r\nimport App from '../components/App';\r\nimport { loadTeam, updateApiKey, updateTeam } from '../actions/team';\r\nimport createEmptyAction from '../utils/createEmptyAction';\r\nimport { ThunkDispatch } from 'redux-thunk';\r\nimport IStore from '../models/store';\r\nimport Team from '../models/Team';\r\nimport { setErrorAction } from '../actions/app';\r\nimport { AnyAction } from 'redux';\r\nimport { loadSubmissions } from '../actions/submissions';\r\nimport { loadLightningScoreboard, loadTotalScoreboard } from '../actions/scoreboard';\r\nimport { loadNonRatingGames } from '../actions/games';\r\n\r\n\r\nconst mapState = (state: IStore) => {\r\n    return {\r\n        apiKey: state.team.apiKey,\r\n        team: state.team.team,\r\n        error: state.app.error,\r\n    }\r\n}\r\n\r\nconst mapDispatch = (dispatch: ThunkDispatch<IStore, unknown, AnyAction>) => {\r\n    return {\r\n        updateApiKey: (apiKey: string | null) => dispatch(updateApiKey(createEmptyAction(apiKey))),\r\n        updateTeam: (team: Team | null) => dispatch(updateTeam(createEmptyAction(team))),\r\n        loadTeam: () => dispatch(loadTeam()),\r\n        setError: (err: string | Error | null) => dispatch(setErrorAction(createEmptyAction(err))),\r\n        loadSubmissions: () => dispatch(loadSubmissions()),\r\n        loadLightningScoreboard: () => dispatch(loadLightningScoreboard()),\r\n        loadScoreboard: () => dispatch(loadTotalScoreboard()),\r\n        loadNonRatingGames: () => dispatch(loadNonRatingGames())\r\n    }\r\n}\r\n\r\nexport default connect(mapState, mapDispatch)(App);\r\n","import IAppStore from '../models/store/app';\r\nimport IAppActions from '../models/actions/app';\r\nimport { SET_ERROR } from '../consts/actions';\r\n\r\nconst defaultStore: IAppStore ={\r\n    error: null,\r\n}\r\n\r\nfunction appReducer(store = defaultStore, action: IAppActions) {\r\n    switch (action.type) {\r\n        case SET_ERROR: \r\n            return {\r\n                ...store,\r\n                error: action.payload,\r\n            }\r\n        default:\r\n            return store;\r\n    }\r\n}\r\n\r\nexport default appReducer;\r\n","import { FINISH, LOAD_TEAM, START, UPDATE_API_KEY, UPDATE_TEAM } from '../consts/actions';\r\nimport ITeamAction from '../models/actions/team';\r\nimport ITeamStore from '../models/store/team';\r\n\r\nconst defaultState: ITeamStore = {\r\n    apiKey: null,\r\n    team: null,\r\n    teamLoading: false,\r\n}\r\n\r\n\r\nfunction teamReducer(state = defaultState, action: ITeamAction) {\r\n    switch (action.type) {\r\n        case UPDATE_API_KEY:\r\n            return {\r\n                ...state,\r\n                apiKey: action.payload,\r\n            };\r\n        case UPDATE_TEAM:\r\n            return {\r\n                ...state,\r\n                team: action.payload,\r\n            };\r\n        case LOAD_TEAM + START:\r\n            return {\r\n                ...state,\r\n                teamLoading: true,\r\n            }\r\n        case LOAD_TEAM + FINISH:\r\n            return {\r\n                ...state,\r\n                teamLoading: false,\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default teamReducer;\r\n","import ISubmissionsStore from '../models/store/submissions';\r\nimport ISubmissionsAction from '../models/actions/submissions';\r\nimport {\r\n    ACTIVATE_SUBMISSION, FINISH,\r\n    LOAD_OTHER_TEAMS_SUBMISSION,\r\n    LOAD_SUBMISSIONS, RUN_NON_RATING_GAME, START, SUCCESS,\r\n    UPDATE_LAST_SEEN_SUBMISSION\r\n} from '../consts/actions';\r\n\r\nconst defaultStore: ISubmissionsStore ={\r\n    submissions: null,\r\n    lastSeen: null,\r\n    otherTeamSubmissions: null,\r\n    running: false,\r\n    justStarted: false,\r\n}\r\n\r\nfunction submissionsReducer(store = defaultStore, action: ISubmissionsAction) {\r\n    switch (action.type) {\r\n        case LOAD_SUBMISSIONS:\r\n            return {\r\n                ...store,\r\n                submissions: action.payload,\r\n            };\r\n        case UPDATE_LAST_SEEN_SUBMISSION:\r\n            return {\r\n                ...store,\r\n                lastSeen: action.payload,\r\n            }\r\n        case ACTIVATE_SUBMISSION:\r\n            return {\r\n                ...store,\r\n                submissions: store.submissions?.map(i => {\r\n                    if (i.submissionId === action.payload) {\r\n                        return {...i, active: true};\r\n                    }\r\n                    if (i.active) {\r\n                        return {...i, active: false};\r\n                    }\r\n                    return  i;\r\n                })\r\n            }\r\n        case LOAD_OTHER_TEAMS_SUBMISSION:\r\n            return {\r\n                ...store,\r\n                otherTeamSubmissions: action.payload,\r\n            }\r\n        case RUN_NON_RATING_GAME + START:\r\n            return {\r\n                ...store,\r\n                running: true,\r\n            }\r\n        case RUN_NON_RATING_GAME + SUCCESS:\r\n            return {\r\n                ...store,\r\n                running: false,\r\n                justStarted: true,\r\n            }\r\n        case RUN_NON_RATING_GAME + FINISH:\r\n            return {\r\n                ...store,\r\n                running: false,\r\n                justStarted: false,\r\n            }\r\n        default:\r\n            return store;\r\n    }\r\n}\r\n\r\nexport default submissionsReducer;\r\n","import IScoreboardStore from '../models/store/scoreboard';\r\nimport IScoreboardAction from '../models/actions/scoreboard';\r\nimport { LOAD_FINAL_SCOREBOARD, LOAD_PROBLEM_SCOREBOARD, LOAD_TOTAL_SCOREBOARD } from '../consts/actions';\r\n\r\nconst defaultStore: IScoreboardStore ={\r\n    lightningScoreboard: null,\r\n    totalScoreboard: null,\r\n    finalScoreboard: null,\r\n}\r\n\r\nfunction scoreboardReducer(store = defaultStore, action: IScoreboardAction) {\r\n    switch (action.type) {\r\n        case LOAD_PROBLEM_SCOREBOARD:\r\n            return {\r\n                ...store,\r\n                lightningScoreboard: action.payload,\r\n            }\r\n        case LOAD_TOTAL_SCOREBOARD:\r\n            return {\r\n                ...store,\r\n                totalScoreboard: action.payload,\r\n            }\r\n        case LOAD_FINAL_SCOREBOARD:\r\n            return {\r\n                ...store,\r\n                finalScoreboard: action.payload,\r\n            }\r\n        default:\r\n            return store;\r\n    }\r\n}\r\n\r\nexport default scoreboardReducer;\r\n","import { LOAD_CURRENT_TOURNAMENT } from '../consts/actions';\r\nimport ITournamentStore from '../models/store/tournaments';\r\nimport ITournamentAction from '../models/actions/tournaments';\r\n\r\nconst defaultStore: ITournamentStore ={\r\n    current: null\r\n}\r\n\r\nfunction tournamentReducer(store = defaultStore, action: ITournamentAction) {\r\n    switch (action.type) {\r\n        case LOAD_CURRENT_TOURNAMENT:\r\n            return {\r\n                ...store,\r\n                current: action.payload,\r\n            }\r\n        default:\r\n            return store;\r\n    }\r\n}\r\n\r\nexport default tournamentReducer;\r\n","import { LOAD_NON_RATING_GAMES, LOAD_RATING_GAMES } from '../consts/actions';\r\nimport IGamesStore from '../models/store/games';\r\nimport IGamesAction from '../models/actions/games';\r\n\r\nconst defaultStore: IGamesStore ={\r\n    rating: null,\r\n    nonRating: null,\r\n}\r\n\r\nfunction gamesReducer(store = defaultStore, action: IGamesAction) {\r\n    switch (action.type) {\r\n        case LOAD_RATING_GAMES:\r\n            return {\r\n                ...store,\r\n                rating: action.payload,\r\n            }\r\n        case LOAD_NON_RATING_GAMES:\r\n            return {\r\n                ...store,\r\n                nonRating: action.payload,\r\n            }\r\n        default:\r\n            return store;\r\n    }\r\n}\r\n\r\nexport default gamesReducer;\r\n","import { combineReducers } from \"redux\";\r\nimport app from './app';\r\nimport team from './team';\r\nimport submissions from './submissions';\r\nimport scoreboard from './scoreboard';\r\nimport tournament from './tournament';\r\nimport games from './games';\r\n\r\nconst rootReducer = combineReducers({\r\n    app,\r\n    team, \r\n    submissions,\r\n    scoreboard,\r\n    tournament,\r\n    games,\r\n})\r\n\r\nexport default rootReducer;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { createStore, applyMiddleware } from 'redux'\r\nimport reduxThunk from 'redux-thunk';\r\nimport { Provider } from 'react-redux';\r\nimport './fonts.css';\r\nimport './index.css';\r\nimport App from './containers/App';\r\nimport rootReducer from './reducers';\r\n\r\nconst store = createStore(rootReducer, applyMiddleware(reduxThunk));\r\n\r\nReactDOM.render(\r\n    <Provider store={ store }>\r\n        <App/>\r\n    </Provider>,\r\n    document.getElementById('root')\r\n);\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"checklist\":\"styles_checklist__1rGwj\",\"table\":\"styles_table__2Vp25\",\"pre\":\"styles_pre__3K4aa\",\"statusFailed\":\"styles_statusFailed__36LYx\",\"logLink\":\"styles_logLink__3p3ZO\",\"branch\":\"styles_branch__3sgQf\",\"help\":\"styles_help__2bCa7\",\"icon\":\"styles_icon__3z_JM\",\"succeeded\":\"styles_succeeded__1X2yG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__1JkhP\",\"table\":\"styles_table__1XQ4I\",\"pre\":\"styles_pre__p2N18\",\"radio\":\"styles_radio__1TATW\",\"buttons\":\"styles_buttons__3beOR\",\"chooseButton\":\"styles_chooseButton__3nCCJ\",\"toastButton\":\"styles_toastButton__2RRtt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__3hwBM\",\"subtitle\":\"styles_subtitle__nJmwC\",\"note\":\"styles_note__36PtB\",\"blink\":\"styles_blink__3zvgy\",\"wide\":\"styles_wide__21zi8\",\"navMenu\":\"styles_navMenu__3JuLZ\",\"navMenuLinks\":\"styles_navMenuLinks__XSf8Q\",\"logoutWrapper\":\"styles_logoutWrapper__2Dvdf\",\"links\":\"styles_links__3NSUc\",\"link\":\"styles_link__3Jnaf\",\"activeLink\":\"styles_activeLink__3bi1c\",\"titleLink\":\"styles_titleLink__Ei4NF\",\"logoutLink\":\"styles_logoutLink__3AZN6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"forms_form__oaypY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__2lyTC\",\"list\":\"styles_list__1XpYp\",\"listItem\":\"styles_listItem__3aJC2\",\"link\":\"styles_link__1qeJO\",\"active\":\"styles_active__3W_Ux\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"table\":\"styles_table__r-73B\",\"alignLeft\":\"styles_alignLeft__1BsFI\",\"alignCenter\":\"styles_alignCenter__12qEa\",\"alignRight\":\"styles_alignRight__2iR_Z\",\"lighten\":\"styles_lighten__1Bo14\",\"problemsHeader\":\"styles_problemsHeader__3gaaq\",\"activeTeam\":\"styles_activeTeam__qucob\",\"problemScore\":\"styles_problemScore__3wjGZ\",\"score\":\"styles_score__2tBs9\",\"sortButton\":\"styles_sortButton__2VVM6\",\"sortDown\":\"styles_sortDown__rEkJV\",\"sortUp\":\"styles_sortUp__O3JFe\",\"details\":\"styles_details__1OTEi\",\"sortDetails\":\"styles_sortDetails__2wL2W\",\"smallRow\":\"styles_smallRow__1_3tv\",\"frozenTitle\":\"styles_frozenTitle__1b3E9\",\"help\":\"styles_help__29g82\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__2e5av\",\"title\":\"styles_title__3uqDB\",\"subtitle\":\"styles_subtitle__35-3U\",\"header\":\"styles_header__3eiV8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"styles_row__1_iO8\",\"buttonRow\":\"styles_buttonRow__1-rdx\",\"blackText\":\"styles_blackText__1-Vtt\",\"error\":\"styles_error__3SDEL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__2bDZj\",\"footer\":\"styles_footer__34sTk\",\"footerItem\":\"styles_footerItem__1_eBY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__NZ5JT\",\"subtitle\":\"styles_subtitle__3aoO8\",\"audiences\":\"styles_audiences__3sF1z\",\"audiences__emoji\":\"styles_audiences__emoji__3VLHn\",\"audiences__scope\":\"styles_audiences__scope__2MkIQ\",\"timer\":\"styles_timer__3tRRV\",\"timer__download\":\"styles_timer__download__3I3m1\",\"section\":\"styles_section__1A0Xa\",\"section__title\":\"styles_section__title__3RWmV\",\"section__cta\":\"styles_section__cta__E0q5O\",\"features\":\"styles_features__3Y_Kr\",\"features__double\":\"styles_features__double__1XJVP\",\"features__emoji\":\"styles_features__emoji__2BsPR\",\"features__title\":\"styles_features__title__16Yu9\",\"features__pro\":\"styles_features__pro__22Eph\",\"demos\":\"styles_demos__2Ky6O\",\"tweet\":\"styles_tweet__3bI6N\",\"videos\":\"styles_videos__29CsR\",\"thanks\":\"styles_thanks__1udAp\",\"thanks__title\":\"styles_thanks__title__hQSUW\",\"thanks__script\":\"styles_thanks__script__3muwd\",\"supporters\":\"styles_supporters__1ix2g\",\"supporters__title\":\"styles_supporters__title__1WhCq\",\"supporters__script\":\"styles_supporters__script__ayPti\",\"video\":\"styles_video__pHwzj\",\"links\":\"styles_links__39rKb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__3FkIw\",\"box\":\"styles_box__34DFY\",\"error\":\"styles_error__3mBo-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"styles_form__2W7zz\",\"row\":\"styles_row__3stW9\",\"buttonRow\":\"styles_buttonRow__2jzvS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"table\":\"styles_table__3vu-g\",\"Win\":\"styles_Win__VM6n9\",\"Lose\":\"styles_Lose__17ilJ\",\"Draw\":\"styles_Draw__2LXKa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__3elAW\",\"narrowContainer\":\"styles_narrowContainer__1JFMh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__WCGxW\",\"disclaimer\":\"styles_disclaimer__2at9I\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"listItem\":\"styles_listItem__2sRyy\",\"root\":\"styles_root__a-GHh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__3uRHK\",\"value\":\"styles_value__2xzu8\",\"form\":\"styles_form__1R5Ws\",\"row\":\"styles_row__1iR-y\",\"buttonRow\":\"styles_buttonRow__1jXUj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"styles_root__PaNdR\",\"delimiter\":\"styles_delimiter__2xJX9\",\"branch\":\"styles_branch__1a3_u\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"style_root__1sD7n\"};"],"sourceRoot":""}